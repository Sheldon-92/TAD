## Learning Entry

- **Date**: 2026-01-20 01:00
- **Agent**: Alex
- **Category**: workflow
- **Status**: pushed

### Discovery

NEXT.md files can grow indefinitely because the global CLAUDE.md configuration only instructs to:
- Mark completed tasks as `[x]`
- Add new tasks

There was **no instruction to archive or clean up old content**, leading to:
- Files exceeding 2000+ lines (84KB)
- Token count exceeding Claude's 25,000 token read limit
- Inability to read the entire file, causing context loss

Example: Menu Snap's NEXT.md grew to 2,083 lines with historical records from 01-16 to 01-20.

### Suggestion

**1. Add size limits to global CLAUDE.md:**
```markdown
### NEXT.md Size Control
- Target: Keep under 500 lines
- Archive completed tasks >7 days old to docs/HISTORY.md
- Trigger cleanup when file exceeds 400 lines or token limit errors occur
```

**2. Add to TAD config.yaml under document_management:**
```yaml
next_md_maintenance:
  size_limits:
    max_lines: 500
    max_tokens: 20000
    warning_threshold: 400
  archive_rules:
    triggers: [">500 lines", "token error", "new week", "user request"]
    destinations:
      completed_tasks: "docs/HISTORY.md"
      milestones: "CHANGELOG.md"
```

**3. Create templates:**
- `.tad/templates/next-md-template.md` - Clean NEXT.md structure
- `.tad/templates/history-md-template.md` - Archive format

### Implementation Reference

- Global config: `~/.claude/CLAUDE.md` - Added "NEXT.md 大小控制" section
- TAD config: `.tad/config.yaml` - Added `next_md_maintenance` under `document_management`
- Templates: `.tad/templates/next-md-template.md`, `.tad/templates/history-md-template.md`

### Source

Menu Snap project NEXT.md exceeded 26,596 tokens, causing read errors. User identified the accumulation pattern and requested a solution that works across TAD installations.

### Impact Assessment

- **Reliability**: Prevents context loss from unreadable files
- **Maintainability**: Clear archive rules keep files organized
- **Portability**: Rules in TAD config apply to new installations

---

> This entry was generated by /tad-learn command
> Pushed to TAD repository on 2026-01-20
