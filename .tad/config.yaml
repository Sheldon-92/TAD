# TAD Configuration v2.1.1 - Simplified Multi-Platform Architecture
method: TAD
version: 2.1.1
description: Triangle Agent Development - Multi-Platform Support + Ralph Loop + è‹æ ¼æ‹‰åº•å¼æé—® + çŸ¥è¯†é©±åŠ¨å¼€å‘
last_updated: 2026-01-26

# ==================== Multi-Platform Configuration (v2.1.1 Simplified) ====================
multi_platform:
  enabled: true
  version: "1.1"
  description: |
    TAD v2.1.1 supports multiple AI coding assistants.
    All conversion logic is in /tad-init command (no separate adapters).
    - Claude Code (primary): Full subagent support
    - Codex CLI (secondary): Self-check mode with native skills
    - Gemini CLI (secondary): Self-check mode with TOML commands

  platforms:
    claude:
      enabled: true
      skill_execution: "subagent"
      config_dir: ".claude"
      commands_dir: ".claude/commands"
      project_instructions: "CLAUDE.md"

    codex:
      enabled: true
      skill_execution: "self-check"
      config_dir: ".codex"
      commands_dir: "~/.codex/prompts"
      command_prefix: "tad_"
      project_instructions: "AGENTS.md"

    gemini:
      enabled: true
      skill_execution: "self-check"
      config_dir: ".gemini"
      commands_dir: ".gemini/commands"
      command_format: "toml"
      project_instructions: "GEMINI.md"

  skills:
    directory: ".tad/skills"
    count: 8
    list:
      - testing
      - code-review
      - security-audit
      - performance
      - ux-review
      - architecture
      - api-design
      - debugging

  # NOTE: adapters directory removed in v2.1.1
  # Conversion logic is now directly in /tad-init command

# ==================== Ralph Loop Configuration Reference ====================
# TAD v2.0 introduces Ralph Loop for Blake's execution phase
ralph_loop:
  enabled: true
  config_file: ".tad/ralph-config/loop-config.yaml"
  criteria_file: ".tad/ralph-config/expert-criteria.yaml"
  schemas:
    loop_config: ".tad/schemas/loop-config.schema.json"
    expert_criteria: ".tad/schemas/expert-criteria.schema.json"
  description: |
    Ralph Loop automates quality checks during Blake's execution:
    - Layer 1: Self-Check (build, test, lint, tsc)
    - Layer 2: Expert Review (code-reviewer, test-runner, security-auditor, performance-optimizer)
    - Circuit Breaker: Prevents infinite loops on same error
    - State Persistence: Supports crash recovery
    - Priority Groups: code-reviewer first, then others in parallel

# ==================== æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ ====================
document_management:
  manifest_file: .tad/manifest.yaml
  naming_convention:
    format: "{timestamp}_{version}_{task_id}_{type}_{status}.md"
    example: "20250128_1430_v1.2_TASK001_design_draft.md"

  structure:
    active:           # å½“å‰æ´»è·ƒä»»åŠ¡
      - tasks         # ä»»åŠ¡è¿½è¸ª
      - designs       # è®¾è®¡æ–‡æ¡£
      - handoffs      # äº¤æ¥æ–‡æ¡£
    archive:          # å·²å®Œæˆå½’æ¡£
      - by_date       # æŒ‰æ—¥æœŸ
      - by_task       # æŒ‰ä»»åŠ¡
      - by_version    # æŒ‰ç‰ˆæœ¬
    context: "é¡¹ç›®é•¿æœŸä¿¡æ¯"
    working: "å·¥ä½œä¸­æ–‡æ¡£"

  version_control:
    enabled: true
    auto_increment: true
    hash_verification: true
    change_tracking: true

  mandatory_sections:
    header:
      - task_id: "TASK-{YYYY}{MM}{DD}-{seq}"
      - version: "v{major}.{minor}.{patch}"
      - status: "draft|review|approved|implemented|archived"
      - owner: "{agent_name}"
      - created: "{timestamp}"
      - modified: "{timestamp}"
      - previous_version: "{link_to_previous}"

    metadata:
      - hash: "{file_hash}"
      - modified_by: "{agent_name}"
      - change_summary: "{summary}"

  # Handoff ç”Ÿå‘½å‘¨æœŸç®¡ç† (æ£€æµ‹è·¨ slug æ›¿ä»£å’Œè¿‡æœŸ handoff)
  handoff_lifecycle:
    stale_age_days: 7                    # Active handoff è¶…è¿‡æ­¤å¤©æ•°æœªå®Œæˆ â†’ æ ‡è®° POTENTIALLY_STALE
    cross_reference_window_days: 30      # æ‰«æ archive ä¸­è¿‘ N å¤©çš„ handoff è¿›è¡Œä¸»é¢˜åŒ¹é…
    topic_match_threshold: 2             # æ ‡é¢˜/æ‘˜è¦ä¸­è‡³å°‘ N ä¸ªå…³é”®è¯é‡å æ‰åˆ¤å®šä¸ºä¸»é¢˜æ›¿ä»£
    common_words_exclude:                # ä¸»é¢˜åŒ¹é…æ—¶æ’é™¤çš„é€šç”¨è¯
      - "tad"
      - "implementation"
      - "design"
      - "handoff"
      - "update"
      - "fix"
      - "feature"

  # NEXT.md ç»´æŠ¤è§„åˆ™ (é˜²æ­¢æ–‡æ¡£æ— é™å¢é•¿)
  next_md_maintenance:
    description: "NEXT.md æ˜¯é¡¹ç›®ä»»åŠ¡è¿½è¸ªæ–‡ä»¶ï¼Œéœ€è¦å®šæœŸæ¸…ç†ä»¥ä¿æŒå¯è¯»æ€§"

    size_limits:
      max_lines: 500
      max_tokens: 20000  # ä¿æŒåœ¨ Claude å¯ä¸€æ¬¡è¯»å–çš„èŒƒå›´å†…
      warning_threshold: 400  # è¶…è¿‡æ­¤è¡Œæ•°æ—¶æé†’æ¸…ç†

    archive_rules:
      # å½’æ¡£è§¦å‘æ¡ä»¶ï¼ˆæ»¡è¶³ä»»ä¸€å³è§¦å‘ï¼‰
      triggers:
        - "æ–‡ä»¶è¶…è¿‡ 500 è¡Œ"
        - "è¯»å–æ—¶å‡ºç° token è¶…é™é”™è¯¯"
        - "å¼€å§‹æ–°çš„å·¥ä½œå‘¨"
        - "ç”¨æˆ·æ˜ç¡®è¦æ±‚"

      # å½’æ¡£ç›®æ ‡
      destinations:
        completed_tasks: "docs/HISTORY.md"      # å·²å®Œæˆä»»åŠ¡çš„å†å²è®°å½•
        milestones: "CHANGELOG.md"              # é‡å¤§é‡Œç¨‹ç¢‘
        technical_details: "docs/"              # è¯¦ç»†æŠ€æœ¯è¯´æ˜

      # ä¿ç•™å†…å®¹
      keep_in_next_md:
        - "å½“å‰è¿›è¡Œä¸­çš„ä»»åŠ¡"
        - "æœ¬å‘¨å¾…åŠä»»åŠ¡"
        - "Blocked ä»»åŠ¡"
        - "æœ€è¿‘ 3 å¤©çš„é‡è¦æ›´æ–°"

    history_md_format: |
      # Project History

      ## Week of YYYY-MM-DD
      ### Completed
      - [x] Task 1 (date)
      - [x] Task 2 (date)

      ### Key Decisions
      - Decision 1: reason

      ### Lessons Learned
      - Learning 1

    cleanup_steps:
      - step: 1
        action: "è¯†åˆ«è¶…è¿‡ 7 å¤©çš„å·²å®Œæˆä»»åŠ¡"
      - step: 2
        action: "å°†å†å²å†…å®¹ç§»åŠ¨åˆ° docs/HISTORY.md"
      - step: 3
        action: "ä¿ç•™å½“å‰è¿›è¡Œä¸­å’Œæœ¬å‘¨å¾…åŠä»»åŠ¡"
      - step: 4
        action: "æ›´æ–° NEXT.md å¤´éƒ¨çš„æ—¥æœŸå’ŒçŠ¶æ€"
      - step: 5
        action: "éªŒè¯æ–‡ä»¶è¡Œæ•°åœ¨ 500 è¡Œä»¥å†…"

    agent_responsibility:
      alex: "å‘ç° NEXT.md è¿‡å¤§æ—¶ï¼Œè§„åˆ’æ¸…ç†æ–¹æ¡ˆ"
      blake: "æ‰§è¡Œæ¸…ç†ï¼Œç§»åŠ¨å†…å®¹åˆ°å½’æ¡£æ–‡ä»¶"

# ==================== Document Maintenance Command ====================
tad_maintain:
  description: "Document health check and synchronization"
  command_file: ".claude/commands/tad-maintain.md"
  modes:
    check:
      description: "Read-only health scan"
      triggers: ["agent_activation", "exit_command"]
    sync:
      description: "Scoped write operations"
      triggers: ["accept_command"]
    full:
      description: "Comprehensive check + sync"
      triggers: ["manual"]
  auto_archive_criteria:
    - "matching_completion_report"
    - "superseded_by_newer_version"
  safety:
    write_strategy: "copy-then-delete"
    idempotent: true
    name_conflict_resolution: "append-timestamp-suffix"

# ==================== Agent æ¿€æ´»åè®® ====================
activation_protocol:
  # å¼ºåˆ¶4æ­¥æ¿€æ´»æµç¨‹ï¼ˆå€Ÿé‰´BMADï¼‰
  mandatory_steps:
    step1:
      name: "èº«ä»½åŠ è½½"
      action: "è¯»å–å®Œæ•´agentå®šä¹‰æ–‡ä»¶"
      verification: "ç¡®è®¤æ–‡ä»¶hashåŒ¹é…"

    step2:
      name: "èº«ä»½ç¡®è®¤"
      action: "é‡‡ç”¨å®šä¹‰çš„persona"
      output: "æˆ‘æ˜¯{agent_name}ï¼Œ{role}"

    step3:
      name: "é…ç½®åŠ è½½"
      action: "åŠ è½½.tad/config-v3.yaml"
      verification: "æ˜¾ç¤ºåŠ è½½çš„é…ç½®ç‰ˆæœ¬"

    step4:
      name: "èƒ½åŠ›å±•ç¤º"
      action: "è‡ªåŠ¨è¿è¡Œ*helpå‘½ä»¤"
      output: "æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤å’Œèƒ½åŠ›"

  violation_detection:
    - "è·³è¿‡ä»»ä½•æ­¥éª¤ â†’ è­¦å‘Šå¹¶é‡æ–°æ¿€æ´»"
    - "èº«ä»½æ··æ·† â†’ ç«‹å³çº æ­£"
    - "æœªæ˜¾ç¤ºhelp â†’ è‡ªåŠ¨è¡¥å……"

# ==================== æ ¸å¿ƒä¸‰è§’æ¨¡å‹ï¼ˆå¢å¼ºç‰ˆï¼‰ ====================
triangle:
  # Terminal éš”ç¦»è§„åˆ™ (v1.8.0 æ–°å¢) âš ï¸ CRITICAL
  terminal_isolation:
    enabled: true
    blocking: true
    description: "Alex å’Œ Blake å¿…é¡»åœ¨ä¸åŒ Terminal è¿è¡Œï¼Œäººç±»æ˜¯å”¯ä¸€çš„ä¿¡æ¯æ¡¥æ¢"

    rule: |
      Alex å†™å®Œ handoff åï¼Œå¿…é¡»åœæ­¢å¹¶ç­‰å¾…äººç±»ä¼ é€’ä¿¡æ¯ç»™ Blake
      ä¸èƒ½åœ¨åŒä¸€ä¸ª terminal è°ƒç”¨ /blake
      äººç±»æ˜¯ Alex å’Œ Blake ä¹‹é—´å”¯ä¸€çš„ä¿¡æ¯æ¡¥æ¢

    workflow:
      terminal_1_alex:
        - "éœ€æ±‚åˆ†æ â†’ è‹æ ¼æ‹‰åº•å¼æé—® â†’ è®¾è®¡ â†’ å†™ handoff"
        - "è¾“å‡º: 'Handoff å·²åˆ›å»ºï¼Œè¯·åœ¨ Terminal 2 æ‰§è¡Œ /blake'"
        - "åœæ­¢ï¼Œç­‰å¾…äººç±»åé¦ˆ"

      human_action:
        - "æ‰“å¼€ Terminal 2"
        - "æ‰§è¡Œ /blake"
        - "å‘Šè¯‰ Blake handoff ä½ç½®"

      terminal_2_blake:
        - "è¯»å– handoff â†’ æ‰§è¡Œå®ç° â†’ Gate 3/4"
        - "è¾“å‡º: 'å®ç°å®Œæˆï¼Œè¯·é€šçŸ¥ Alex è¿›è¡ŒéªŒæ”¶'"
        - "åœæ­¢ï¼Œç­‰å¾…äººç±»åé¦ˆ"

    forbidden_actions:
      - "Alex åœ¨åŒä¸€ä¸ª terminal è°ƒç”¨ /blake"
      - "Alex ç›´æ¥æ‰§è¡Œå®ç°ä»£ç "
      - "Blake åœ¨åŒä¸€ä¸ª terminal è°ƒç”¨ /alex"
      - "ä»»ä½• Agent è¯•å›¾ç»•è¿‡äººç±»ç›´æ¥ä¸å¦ä¸€ä¸ª Agent é€šä¿¡"

    violation:
      detection: "æ£€æµ‹åˆ° Agent è¯•å›¾åœ¨åŒä¸€ terminal è°ƒç”¨å¦ä¸€ä¸ª Agent"
      warning: "âš ï¸ VIOLATION: ç¦æ­¢åœ¨åŒä¸€ terminal è°ƒç”¨ /blake æˆ– /alex"
      action: "ç«‹å³åœæ­¢ï¼Œè¾“å‡º handoff ä½ç½®ï¼Œç­‰å¾…äººç±»æ“ä½œ"

    principle: "Human-in-the-Loopï¼Œäººç±»æŒæ§ä¿¡æ¯æµåŠ¨"

  human:
    role: Value Guardian
    responsibilities:
      - å®šä¹‰ä»·å€¼å’Œéœ€æ±‚
      - éªŒè¯äº¤ä»˜ä»·å€¼
      - åšå…³é”®å†³ç­–
      - åœ¨ Alex å’Œ Blake ä¹‹é—´ä¼ é€’ä¿¡æ¯
    commands:
      - "*status": æŸ¥çœ‹å½“å‰çŠ¶æ€
      - "*task": æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨
      - "*approve": æ‰¹å‡†è®¾è®¡/å®æ–½

  agent_a:
    name: Alex
    role: Solution Lead
    terminal: 1

    # æ–°å¢ï¼šå¼ºåˆ¶èŒè´£
    mandatory_responsibilities:
      - æ·±åº¦éœ€æ±‚æŒ–æ˜ï¼ˆä¸å°‘äº3è½®ç¡®è®¤ï¼‰
      - è®¾è®¡æ–¹æ¡ˆï¼ˆå¿…é¡»è°ƒç”¨ç›¸å…³sub-agentsï¼‰
      - åˆ›å»ºhandoffæ–‡æ¡£
      - è´¨é‡å®¡æŸ¥ï¼ˆä¸èƒ½è·³è¿‡ï¼‰

    # æ–°å¢ï¼šç¦æ­¢è¡Œä¸ºï¼ˆå…³é”®ï¼ï¼‰
    forbidden_actions:
      - "ç›´æ¥ç¼–å†™å®ç°ä»£ç "
      - "æ‰§è¡Œæµ‹è¯•è„šæœ¬"
      - "éƒ¨ç½²æˆ–è¿è¡Œåº”ç”¨"
      - "ä¿®æ”¹Agent Bçš„ä»£ç "
      - "è·³è¿‡éœ€æ±‚ç¡®è®¤"
      - "åœ¨åŒä¸€ä¸ª terminal è°ƒç”¨ /blake"
      - "è¯•å›¾ç»•è¿‡äººç±»ç›´æ¥ä¸ Blake é€šä¿¡"

    # æ–°å¢ï¼šå¼ºåˆ¶äº¤æ¥è§¦å‘è¯
    handoff_triggers:
      keywords: ["å®ç°", "æ‰§è¡Œ", "ç¼–ç ", "éƒ¨ç½²", "æµ‹è¯•è¿è¡Œ"]
      action: |
        æ£€æµ‹åˆ°æ‰§è¡Œç±»å…³é”®è¯ï¼
        ç«‹å³åœæ­¢ï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
        1. å®Œæˆå½“å‰è®¾è®¡æ–‡æ¡£
        2. åˆ›å»ºhandoffæ–‡æ¡£
        3. ç”ŸæˆAgent Bçš„æ‰§è¡Œprompt
        4. æç¤ºç”¨æˆ·è½¬äº¤ç»™Blake

    # æ–°å¢ï¼šå‘½ä»¤ç³»ç»Ÿ
    commands:
      - "*plan <requirement>": "åˆ›å»ºsprintè®¡åˆ’"
      - "*design <feature>": "ç”ŸæˆæŠ€æœ¯è®¾è®¡"
      - "*review <implementation>": "å®¡æŸ¥ä»£ç è´¨é‡"
      - "*handoff": "ç”Ÿæˆäº¤æ¥æ–‡æ¡£"
      - "*status": "æ˜¾ç¤ºå½“å‰çŠ¶æ€"
      - "*help": "æ˜¾ç¤ºæ‰€æœ‰å‘½ä»¤"

  agent_b:
    name: Blake
    role: Execution Master
    terminal: 2

    mandatory_responsibilities:
      - éªŒè¯è®¾è®¡å®Œæ•´æ€§
      - è°ƒç”¨parallel-coordinatorï¼ˆå¤æ‚ä»»åŠ¡å¿…é¡»ï¼‰
      - æ‰§è¡Œæµ‹è¯•éªŒè¯
      - ç”Ÿæˆæ‰§è¡ŒæŠ¥å‘Š

    forbidden_actions:
      - "ä¿®æ”¹éœ€æ±‚æ–‡æ¡£"
      - "æ›´æ”¹æ¶æ„è®¾è®¡"
      - "è·³è¿‡æµ‹è¯•"
      - "å¿½ç•¥è®¾è®¡è§„èŒƒ"
      - "åœ¨åŒä¸€ä¸ª terminal è°ƒç”¨ /alex"
      - "è¯•å›¾ç»•è¿‡äººç±»ç›´æ¥ä¸ Alex é€šä¿¡"

    commands:
      - "*execute <handoff>": "æ‰§è¡Œäº¤æ¥ä»»åŠ¡"
      - "*test": "è¿è¡Œæµ‹è¯•å¥—ä»¶"
      - "*deploy": "éƒ¨ç½²åˆ°ç¯å¢ƒ"
      - "*report": "ç”Ÿæˆæ‰§è¡ŒæŠ¥å‘Š"
      - "*parallel <tasks>": "å¹¶è¡Œæ‰§è¡Œä»»åŠ¡"

# ==================== Sub-agents å¼ºåˆ¶è°ƒç”¨æœºåˆ¶ ====================
subagents_enforcement:
  # å¼ºåˆ¶è°ƒç”¨è§„åˆ™
  mandatory_invocation_rules:
    agent_a:
      éœ€æ±‚åˆ†æ:
        must_call: ["product-expert"]
        violation: "æœªè°ƒç”¨product-expertè¿›è¡Œéœ€æ±‚åˆ†æ"

      æ¶æ„è®¾è®¡:
        must_call: ["backend-architect"]
        violation: "æœªè°ƒç”¨backend-architectè¿›è¡Œæ¶æ„è®¾è®¡"

      è´¨é‡å®¡æŸ¥:
        must_call: ["code-reviewer"]
        violation: "æœªè°ƒç”¨code-reviewerè¿›è¡Œè´¨é‡å®¡æŸ¥"

    agent_b:
      å¤æ‚ä»»åŠ¡:
        condition: "ä»»åŠ¡åŒ…å«3ä¸ªä»¥ä¸Šç»„ä»¶"
        must_call: ["parallel-coordinator"]
        violation: "å¤æ‚ä»»åŠ¡æœªä½¿ç”¨parallel-coordinator"

      é—®é¢˜ä¿®å¤:
        condition: "é‡åˆ°bugæˆ–é”™è¯¯"
        must_call: ["bug-hunter"]
        violation: "æœªè°ƒç”¨bug-hunterè¯Šæ–­é—®é¢˜"

      æµ‹è¯•æ‰§è¡Œ:
        condition: "å®Œæˆå®ç°å"
        must_call: ["test-runner"]
        violation: "æœªè°ƒç”¨test-runneréªŒè¯å®ç°"

  # è°ƒç”¨éªŒè¯æœºåˆ¶
  invocation_verification:
    log_format: "[{timestamp}] {agent} called {subagent} for {task}"
    verification_points:
      - pre_task: "æ£€æŸ¥æ˜¯å¦éœ€è¦sub-agent"
      - during_task: "ç¡®è®¤sub-agentè¢«è°ƒç”¨"
      - post_task: "éªŒè¯sub-agentå®Œæˆå·¥ä½œ"

  # è¿è§„å¤„ç†
  violation_handling:
    detection: "è‡ªåŠ¨æ£€æµ‹æœªè°ƒç”¨å¿…éœ€çš„sub-agents"
    warning: "âš ï¸ VIOLATION: {violation_message}"
    correction: "ç«‹å³è°ƒç”¨ç¼ºå¤±çš„sub-agent"
    prevention: "é˜»æ­¢ç»§ç»­æ‰§è¡Œç›´åˆ°è°ƒç”¨"

# ==================== æ·±åº¦éœ€æ±‚æŒ–æ˜æµç¨‹ï¼ˆå€Ÿé‰´BMADçš„elicitï¼‰ ====================
requirement_elicitation:
  # å¼ºåˆ¶å¤šè½®ç¡®è®¤æœºåˆ¶
  mandatory_rounds:
    minimum: 3
    maximum: 5

  round1_understanding:
    agent_action:
      - "å¤è¿°ç”¨æˆ·éœ€æ±‚"
      - "è¯†åˆ«å…³é”®ä»·å€¼ç‚¹"
      - "åˆ—å‡ºåˆæ­¥å‡è®¾"
    user_interaction:
      format: "1-9é€‰é¡¹æ ¼å¼"
      options:
        1: "ç»§ç»­ä¸‹ä¸€æ­¥"
        2: "æ¾„æ¸…éœ€æ±‚"
        3: "æä¾›æ›´å¤šèƒŒæ™¯"
        4: "çº æ­£ç†è§£åå·®"
        5: "æ·»åŠ çº¦æŸæ¡ä»¶"
        6: "æ˜ç¡®ä¼˜å…ˆçº§"
        7: "æä¾›ç¤ºä¾‹"
        8: "è®¨è®ºæ›¿ä»£æ–¹æ¡ˆ"
        9: "é‡æ–°å¼€å§‹"

  round2_exploration:
    agent_action:
      - "å±•ç¤ºç†è§£çš„éœ€æ±‚"
      - "æå‡ºclarifying questions"
      - "è¯†åˆ«æ½œåœ¨é£é™©"
    must_check:
      - "å†å²ä»£ç æ˜¯å¦å­˜åœ¨"
      - "ç±»ä¼¼åŠŸèƒ½æ˜¯å¦å®ç°è¿‡"
      - "æ˜¯å¦æœ‰å¯å¤ç”¨ç»„ä»¶"

  round3_confirmation:
    agent_action:
      - "å±•ç¤ºå®Œæ•´éœ€æ±‚ç†è§£"
      - "åˆ—å‡ºå…³é”®å†³ç­–ç‚¹"
      - "ç¡®è®¤éªŒæ”¶æ ‡å‡†"
    final_check:
      format: "å¿…é¡»è·å¾—æ˜ç¡®ç¡®è®¤"
      options:
        - "âœ… ç¡®è®¤ï¼Œå¼€å§‹è®¾è®¡"
        - "ğŸ”„ éœ€è¦è°ƒæ•´"
        - "âŒ é‡æ–°åˆ†æ"

  # ==================== Research Phase (v1.4 æ–°å¢) ====================
  # è®¾è®¡åŸåˆ™ï¼šèå…¥ç°æœ‰ Roundï¼ŒæŒ‰éœ€æœç´¢ + æœ€ç»ˆæŠ€æœ¯å›é¡¾
  research_phase:
    enabled: true
    version: "1.4"
    description: "ä¸»åŠ¨æŠ€æœ¯è°ƒç ”ï¼Œç¡®ä¿æŠ€æœ¯é€‰å‹åŸºäºæœ€æ–°ä¿¡æ¯"

    # è¿‡ç¨‹ä¸­æŒ‰éœ€æœç´¢ï¼ˆèå…¥ Round 1-3ï¼‰
    inline_research:
      trigger: "Round ä¸­å‡ºç°æŠ€æœ¯å†³ç­–ç‚¹"
      action: "ç«‹å³è§¦å‘ MQ6 æœç´¢"
      examples:
        - "ç”¨æˆ·æåˆ°æƒ³ç”¨æŸä¸ªæ¡†æ¶ â†’ æœç´¢è¯¥æ¡†æ¶æœ€æ–°ç‰ˆæœ¬å’Œæœ€ä½³å®è·µ"
        - "è®¨è®ºåˆ°çŠ¶æ€ç®¡ç† â†’ æœç´¢å½“å‰ä¸»æµæ–¹æ¡ˆå¯¹æ¯”"
        - "æ¶‰åŠ UI ç»„ä»¶åº“ â†’ æœç´¢æœ€æ–°æ¨è"

    # æœ€ç»ˆæŠ€æœ¯å›é¡¾ï¼ˆRound 3 ä¹‹åï¼Œè®¾è®¡ä¹‹å‰ï¼‰
    final_tech_review:
      timing: "Round 3 ç¡®è®¤åï¼Œæ­£å¼è®¾è®¡å‰"
      name: "æŠ€æœ¯æ ˆæœ€ç»ˆç¡®è®¤"
      mandatory: true

      checklist:
        - item: "æ ¸å¿ƒæ¡†æ¶ç‰ˆæœ¬ç¡®è®¤"
          action: "æœç´¢ç¡®è®¤ä½¿ç”¨çš„æ˜¯æœ€æ–°ç¨³å®šç‰ˆ"
          evidence: "ç‰ˆæœ¬å· + å‘å¸ƒæ—¥æœŸ"

        - item: "å…³é”®ä¾èµ–åº“ç¡®è®¤"
          action: "æœç´¢æ¯ä¸ªå…³é”®åº“çš„æœ€æ–°ç‰ˆæœ¬å’Œæ›¿ä»£æ–¹æ¡ˆ"
          evidence: "åº“å | ç‰ˆæœ¬ | æ›¿ä»£æ–¹æ¡ˆ | é€‰æ‹©ç†ç”±"

        - item: "æ¶æ„æ¨¡å¼ç¡®è®¤"
          action: "æœç´¢å½“å‰æ¨èçš„æ¶æ„æ¨¡å¼"
          evidence: "æ¨¡å¼å | é€‚ç”¨åœºæ™¯ | å‚è€ƒé¡¹ç›®"

        - item: "æ½œåœ¨é—®é¢˜é¢„è­¦"
          action: "æœç´¢è¯¥æŠ€æœ¯æ ˆçš„å¸¸è§å‘ç‚¹"
          evidence: "é—®é¢˜ | è§£å†³æ–¹æ¡ˆ | æ¥æº"

      output_format: |
        ## æŠ€æœ¯æ ˆæœ€ç»ˆç¡®è®¤æŠ¥å‘Š

        ### 1. æ ¸å¿ƒæ¡†æ¶
        | æ¡†æ¶ | ç‰ˆæœ¬ | æœ€æ–°ç‰ˆæœ¬ | æ˜¯å¦éœ€è¦å‡çº§ |
        |-----|------|---------|-------------|

        ### 2. å…³é”®ä¾èµ–
        | åº“å | é€‰æ‹©ç‰ˆæœ¬ | æ›¿ä»£æ–¹æ¡ˆ | é€‰æ‹©ç†ç”± |
        |-----|---------|---------|---------|

        ### 3. æ¶æ„æ¨¡å¼
        | æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | å‚è€ƒé¡¹ç›®/æ–‡ç«  |
        |-----|---------|--------------|

        ### 4. å·²çŸ¥å‘ç‚¹
        | é—®é¢˜ | è§£å†³æ–¹æ¡ˆ | æ¥æº |
        |-----|---------|-----|

        ### 5. è°ƒç ”æ€»ç»“
        - æ€»å…±æœç´¢äº† X ä¸ªæŠ€æœ¯ç‚¹
        - å‘ç° Y ä¸ªéœ€è¦æ³¨æ„çš„é—®é¢˜
        - å»ºè®®ï¼š...

      human_checkpoint:
        question: "æŠ€æœ¯æ ˆç¡®è®¤æŠ¥å‘Šçœ‹èµ·æ¥å®Œæ•´å—ï¼Ÿ"
        options:
          - "âœ… ç¡®è®¤ï¼Œå¼€å§‹è®¾è®¡"
          - "ğŸ”„ éœ€è¦è¡¥å……è°ƒç ”"
          - "â“ æœ‰ç–‘é—®æƒ³è®¨è®º"

  # æµ…å±‚å“åº”æ£€æµ‹
  shallow_response_detection:
    indicators:
      - "ç«‹å³ç”ŸæˆæŠ€æœ¯æ–¹æ¡ˆ"
      - "è·³è¿‡ä»·å€¼ç¡®è®¤"
      - "æ²¡æœ‰æå‡ºé—®é¢˜"
      - "å°‘äº3è½®äº¤äº’"
    action: "å¼ºåˆ¶é‡æ–°è¿›å…¥éœ€æ±‚æŒ–æ˜æµç¨‹"

# ==================== è‹æ ¼æ‹‰åº•å¼æé—®åè®® (v1.8 æ–°å¢) ====================
socratic_inquiry_protocol:
  enabled: true
  version: "1.0"
  description: "å†™ handoff ä¹‹å‰å¿…é¡»ç”¨ AskUserQuestion å·¥å…·è¿›è¡Œè‹æ ¼æ‹‰åº•å¼æé—®"
  blocking: true
  violation: "ä¸è°ƒç”¨ AskUserQuestion ç›´æ¥å†™ handoff = VIOLATION"

  # ç›®æ ‡
  goals:
    - "å‘ç°éœ€æ±‚ç›²ç‚¹"
    - "éªŒè¯å®Œæ•´æ€§"
    - "å¸®åŠ©ç”¨æˆ·åšå‡ºæ›´å¥½å†³ç­–"

  # å¤æ‚åº¦åˆ¤æ–­
  complexity_detection:
    small:
      criteria:
        - "å•æ–‡ä»¶ä¿®æ”¹"
        - "é…ç½®è°ƒæ•´"
        - "ç®€å• UI å˜æ›´"
      question_count: "2-3"
      example: "ä¿®æ”¹æŒ‰é’®é¢œè‰²ã€æ›´æ–°é…ç½®æ–‡ä»¶"

    medium:
      criteria:
        - "å¤šæ–‡ä»¶ä¿®æ”¹"
        - "æ–°åŠŸèƒ½"
        - "API å˜æ›´"
      question_count: "4-5"
      example: "æ·»åŠ æ–°çš„ API ç«¯ç‚¹ã€å®ç°è¡¨å•éªŒè¯"

    large:
      criteria:
        - "æ¶æ„å˜æ›´"
        - "å¤æ‚åŠŸèƒ½"
        - "è·¨æ¨¡å—é‡æ„"
      question_count: "6-8"
      example: "é‡æ„è®¤è¯ç³»ç»Ÿã€æ·»åŠ æ–°çš„æ•°æ®æµ"

  # é—®é¢˜ç»´åº¦
  question_dimensions:
    value_validation:
      description: "éªŒè¯ä»·å€¼"
      example_questions:
        - "è¿™ä¸ªåŠŸèƒ½è§£å†³çš„æ ¸å¿ƒç—›ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"
        - "å¦‚æœä¸åšè¿™ä¸ªåŠŸèƒ½ï¼Œç”¨æˆ·ä¼šæ€æ ·ï¼Ÿ"
        - "è¿™ä¸ªåŠŸèƒ½çš„æˆåŠŸæ ‡å‡†æ˜¯ä»€ä¹ˆï¼Ÿ"

    boundary_clarification:
      description: "è¾¹ç•Œæ¾„æ¸…"
      example_questions:
        - "å“ªäº›åœºæ™¯æ˜ç¡®ä¸éœ€è¦æ”¯æŒï¼Ÿ"
        - "æœ‰ä»€ä¹ˆçº¦æŸæ¡ä»¶æˆ‘åº”è¯¥çŸ¥é“ï¼Ÿ"
        - "æœ€å°å¯è¡Œç‰ˆæœ¬åº”è¯¥åŒ…å«ä»€ä¹ˆï¼Ÿ"

    risk_foresight:
      description: "é£é™©é¢„è§"
      example_questions:
        - "å¦‚æœè¿™ä¸ªåŠŸèƒ½å‡ºé—®é¢˜ï¼Œæœ€åæƒ…å†µæ˜¯ä»€ä¹ˆï¼Ÿ"
        - "æœ‰ä»€ä¹ˆä¾èµ–å¯èƒ½ä¼šå¤±è´¥ï¼Ÿ"
        - "ç”¨æˆ·å¯èƒ½ä¼šæ€ä¹ˆè¯¯ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Ÿ"

    acceptance_criteria:
      description: "éªŒæ”¶æ ‡å‡†"
      example_questions:
        - "æ€æ ·ç®—åšå®Œäº†ï¼Ÿ"
        - "ä½ ä¼šæ€ä¹ˆæµ‹è¯•è¿™ä¸ªåŠŸèƒ½ï¼Ÿ"
        - "ä»€ä¹ˆæƒ…å†µä¸‹ä½ ä¼šè¯´'è¿™ä¸æ˜¯æˆ‘è¦çš„'ï¼Ÿ"

    user_scenarios:
      description: "ç”¨æˆ·åœºæ™¯"
      example_questions:
        - "å…¸å‹ç”¨æˆ·ä¼šæ€ä¹ˆä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Ÿ"
        - "æœ‰æ²¡æœ‰è¾¹ç¼˜ç”¨æˆ·ç¾¤éœ€è¦è€ƒè™‘ï¼Ÿ"
        - "ç”¨æˆ·çš„ä½¿ç”¨é¢‘ç‡å¦‚ä½•ï¼Ÿ"

    technical_constraints:
      description: "æŠ€æœ¯çº¦æŸ"
      example_questions:
        - "æœ‰å“ªäº›ç°æœ‰ç³»ç»Ÿçš„é™åˆ¶éœ€è¦è€ƒè™‘ï¼Ÿ"
        - "æ€§èƒ½è¦æ±‚æ˜¯ä»€ä¹ˆï¼Ÿ"
        - "éœ€è¦å…¼å®¹å“ªäº›å¹³å°/æµè§ˆå™¨ï¼Ÿ"

  # æ‰§è¡Œæµç¨‹
  execution_flow:
    step_1:
      name: "å¤æ‚åº¦è¯„ä¼°"
      action: "æ ¹æ®ä»»åŠ¡æè¿°åˆ¤æ–­å¤æ‚åº¦çº§åˆ«"
      output: "small/medium/large"

    step_2:
      name: "ç»´åº¦é€‰æ‹©"
      action: "æ ¹æ®ä»»åŠ¡ç±»å‹é€‰æ‹© 2-4 ä¸ªæœ€ç›¸å…³çš„é—®é¢˜ç»´åº¦"
      guideline: "ä¼˜å…ˆé€‰æ‹©ï¼švalue_validation, acceptance_criteria"

    step_3:
      name: "é—®é¢˜ç»„ç»‡"
      action: "ä»é€‰ä¸­ç»´åº¦æŒ‘é€‰æœ€ç›¸å…³çš„é—®é¢˜"
      format: "ä½¿ç”¨ AskUserQuestion å·¥å…·"

    step_4:
      name: "ç”¨æˆ·å›ç­”"
      action: "æ”¶é›†ç”¨æˆ·ç­”æ¡ˆ"
      follow_up: "å¯ä»¥è¿›è¡Œè‡ªç”±è®¨è®ºè¡¥å……"

    step_5:
      name: "æ€»ç»“è¾“å‡º"
      action: "ç”Ÿæˆ Inquiry Summary"
      format: |
        ## Socratic Inquiry Summary

        **Task**: {ä»»åŠ¡æè¿°}
        **Complexity**: {small/medium/large}
        **Questions Asked**: {é—®é¢˜æ•°é‡}

        ### Key Insights
        - {æ´å¯Ÿ 1}
        - {æ´å¯Ÿ 2}
        ...

        ### Clarified Requirements
        - {æ¾„æ¸…çš„éœ€æ±‚ 1}
        - {æ¾„æ¸…çš„éœ€æ±‚ 2}
        ...

        ### Risks Identified
        - {è¯†åˆ«çš„é£é™© 1}
        ...

        ### Acceptance Criteria
        - [ ] {éªŒæ”¶æ ‡å‡† 1}
        - [ ] {éªŒæ”¶æ ‡å‡† 2}
        ...

  # ç¦æ­¢è¡Œä¸º
  forbidden_actions:
    - "ä¸ç”¨ AskUserQuestion ç›´æ¥å†™ handoff"
    - "é—®å®Œé—®é¢˜ä¸ç­‰ç”¨æˆ·å›ç­”å°±å¼€å§‹å†™"
    - "è·³è¿‡å¤æ‚åº¦è¯„ä¼°ï¼Œé—®é¢˜æ•°é‡ä¸ä»»åŠ¡ä¸åŒ¹é…"
    - "åªé—®ä¸€ä¸ªç»´åº¦çš„é—®é¢˜"

  # ä¸ handoff çš„é›†æˆ
  handoff_integration:
    prerequisite: "å¿…é¡»å…ˆå®Œæˆ Socratic Inquiry"
    include_in_handoff: "åœ¨ handoff ä¸­åŒ…å« Inquiry Summary"
    verification: "Gate 2 æ£€æŸ¥æ˜¯å¦æœ‰ Inquiry Summary"

# ==================== åœºæ™¯å·¥ä½œæµï¼ˆå¢å¼ºç‰ˆï¼‰ ====================
scenarios:
  # æ¯ä¸ªåœºæ™¯éƒ½æœ‰å¼ºåˆ¶è¦æ±‚
  new_project:
    trigger: "æ²¡æœ‰ä»»ä½•ä»£ç ï¼Œä»é›¶å¼€å§‹"

    agent_a_workflow:
      phase1_requirements:
        mandatory_subagents: ["product-expert"]
        minimum_time: "30 minutes"
        deliverable: ".tad/active/requirements_v{n}.md"
        user_confirmation: required

      phase2_architecture:
        mandatory_subagents: ["backend-architect", "api-designer"]
        deliverable: ".tad/active/architecture_v{n}.md"
        review_required: true

      phase3_handoff:
        content:
          - "å®Œæ•´éœ€æ±‚æ–‡æ¡£"
          - "æ¶æ„è®¾è®¡å›¾"
          - "å®æ–½æ­¥éª¤"
          - "éªŒæ”¶æ ‡å‡†"
        format: ".tad/active/handoffs/project_init_{timestamp}.md"

    agent_b_workflow:
      phase1_validation:
        check: "éªŒè¯handoffå®Œæ•´æ€§"
        missing_info_action: "è¿”å›Agent Aè¡¥å……"

      phase2_execution:
        mandatory_subagents: ["parallel-coordinator", "devops-engineer"]
        parallel_tasks:
          - "é¡¹ç›®ç»“æ„åˆ›å»º"
          - "åŸºç¡€é…ç½®è®¾ç½®"
          - "å¼€å‘ç¯å¢ƒæ­å»º"

      phase3_testing:
        mandatory_subagents: ["test-runner"]
        coverage_requirement: ">80%"

  bug_fix:
    trigger: "å‘ç°é—®é¢˜éœ€è¦ä¿®å¤"

    agent_a_workflow:
      phase1_analysis:
        mandatory_subagents: ["bug-hunter"]
        deliverable: ".tad/active/tasks/bug_analysis_{id}.md"
        must_include:
          - "é—®é¢˜é‡ç°æ­¥éª¤"
          - "æ ¹å› åˆ†æ"
          - "å½±å“èŒƒå›´"
          - "ä¿®å¤æ–¹æ¡ˆ"

    agent_b_workflow:
      phase1_reproduce:
        action: "å¿…é¡»å…ˆé‡ç°é—®é¢˜"
        failure_action: "è¿”å›Agent Aé‡æ–°åˆ†æ"

      phase2_fix:
        mandatory_subagents: ["bug-hunter", "test-runner"]
        regression_test: required

# ==================== è´¨é‡é—¨æ§ï¼ˆQuality Gatesï¼‰ ====================
quality_gates:
  # Agent A è´¨é‡é—¨æ§
  agent_a_gates:
    gate1_requirement:
      name: "éœ€æ±‚å®Œæ•´æ€§"
      checks:
        - "ç”¨æˆ·ä»·å€¼æ˜ç¡®"
        - "éªŒæ”¶æ ‡å‡†æ¸…æ™°"
        - "è‡³å°‘3è½®ç¡®è®¤"
      violation_action: "é˜»æ­¢è¿›å…¥è®¾è®¡é˜¶æ®µ"

    gate2_design:
      name: "è®¾è®¡å®Œæ•´æ€§"
      checks:
        - "æ‰€æœ‰ç»„ä»¶éƒ½æœ‰è®¾è®¡"
        - "æ•°æ®æµå®Œæ•´"
        - "é”™è¯¯å¤„ç†æ˜ç¡®"
      violation_action: "è¿”å›è¡¥å……è®¾è®¡"

    gate3_handoff:
      name: "äº¤æ¥å®Œæ•´æ€§"
      checks:
        - "å®æ–½æ­¥éª¤è¯¦ç»†"
        - "ä¾èµ–å…³ç³»æ¸…æ™°"
        - "æµ‹è¯•ç”¨ä¾‹æä¾›"
      violation_action: "ç¦æ­¢æäº¤ç»™Agent B"

  # Agent B è´¨é‡é—¨æ§
  agent_b_gates:
    gate1_prereq:
      name: "å‰ç½®æ¡ä»¶"
      checks:
        - "handoffæ–‡æ¡£å­˜åœ¨"
        - "è®¾è®¡å·²æ‰¹å‡†"
        - "ç¯å¢ƒå·²å°±ç»ª"
      violation_action: "æ‹’ç»æ‰§è¡Œ"

    gate2_implementation:
      name: "å®ç°è´¨é‡"
      checks:
        - "ä»£ç å¯ç¼–è¯‘"
        - "å‡½æ•°éƒ½å­˜åœ¨"
        - "ç±»å‹æ£€æŸ¥é€šè¿‡"
      violation_action: "ç«‹å³ä¿®å¤"

    gate3_verification:
      name: "éªŒè¯å®Œæ•´æ€§"
      checks:
        - "æµ‹è¯•å…¨éƒ¨é€šè¿‡"
        - "è¦†ç›–ç‡è¾¾æ ‡"
        - "æ€§èƒ½ç¬¦åˆè¦æ±‚"
      violation_action: "ç¦æ­¢äº¤ä»˜"

  # ==================== TAD v2.0 Gate Redefinition ====================
  # Gate 3 and Gate 4 are redefined with Ralph Loop integration
  # Gate 3: Expanded to include all technical quality checks
  # Gate 4: Simplified to pure business acceptance

  gate3_v2_implementation_integration:
    name: "Implementation & Integration Quality"
    version: "2.0"
    owner: "Blake"
    description: "All technical quality checks - Ralph Loop + original Gate 3 + Gate 4 Part A"

    # Ralph Loop Evidence (Required)
    ralph_loop_evidence:
      required: true
      config_file: ".tad/ralph-config/loop-config.yaml"
      checks:
        - "Ralph Loop completed successfully (no abort/escalation)"
        - "State file shows clean completion"
        - "Summary file generated"
      evidence_required:
        - ".tad/evidence/ralph-loops/{task_id}_state.yaml"
        - ".tad/evidence/ralph-loops/{task_id}_summary.md"

    # Expert Evidence (Required)
    expert_evidence:
      required: true
      files:
        - type: "code-review"
          pattern: ".tad/evidence/reviews/{date}-code-review-{task}-final.md"
          required: true
        - type: "testing-review"
          pattern: ".tad/evidence/reviews/{date}-testing-review-{task}-final.md"
          required: true
        - type: "security-review"
          pattern: ".tad/evidence/reviews/{date}-security-review-{task}-*.md"
          required: false  # Only if triggered
        - type: "performance-review"
          pattern: ".tad/evidence/reviews/{date}-performance-review-{task}-*.md"
          required: false  # Only if triggered

    # Original Gate 3 Checks
    implementation_quality:
      checks:
        - "Code compiles without errors"
        - "All functions referenced in handoff exist"
        - "Type checking passes"
        - "No linting errors"

    # Moved from Gate 4 Part A
    integration_verification:
      checks:
        - "All tests pass (unit + integration)"
        - "Coverage meets threshold"
        - "No regression in existing functionality"

    # Knowledge Assessment (MANDATORY)
    knowledge_assessment:
      required: true
      blocking: true
      questions:
        - "New discoveries during implementation? (Yes/No)"
        - "Category (if yes)"
        - "Brief summary"
      output_location: ".tad/project-knowledge/{category}.md"

    human_trigger:
      command: "/gate 3"
      description: "Blake completes Ralph Loop, Human triggers Gate 3 to confirm"

  gate4_v2_acceptance_archive:
    name: "Acceptance & Archive"
    version: "2.0"
    owner: "Alex"
    description: "Pure business validation - technical quality already verified by Gate 3"

    # Pre-condition
    prerequisite:
      - "Gate 3 v2 passed"
      - "Blake's completion report received"

    # Business Acceptance (Focus)
    acceptance:
      checks:
        - "Business value delivered matches handoff intent"
        - "User requirements satisfied"
        - "No unexpected side effects on user experience"

      # Review evidence only - no re-run needed
      evidence_review:
        description: "Review Blake's Gate 3 evidence (not re-execute)"
        files:
          - "{task_id}_summary.md"
          - "Final code-review report"
          - "Final testing-review report"

      # Optional subagent calls (business focus)
      optional_experts:
        - name: "ux-expert-reviewer"
          when: "UI/UX changes involved"
        - name: "product-expert"
          when: "Complex business logic"

    # Archive
    archive:
      actions:
        - "Move handoff to .tad/archive/by_task/"
        - "Move evidence to .tad/archive/evidence/"
        - "Update NEXT.md with completion status"

    # Knowledge Assessment (MANDATORY)
    knowledge_assessment:
      required: true
      blocking: true
      questions:
        - "New discoveries during acceptance? (Yes/No)"
        - "Category (if yes)"
        - "Brief summary"
      output_location: ".tad/project-knowledge/{category}.md"

    human_trigger:
      command: "/gate 4"
      description: "Alex reviews completion report and triggers Gate 4"

  # Gate Responsibility Matrix (TAD v2.0)
  gate_responsibility_matrix:
    description: "Clear separation of Gate 3 and Gate 4 responsibilities"
    version: "2.0"

    matrix:
      test-runner:
        gate3: "Required (Layer 2)"
        gate4: "N/A"
        notes: "Already verified by Blake"

      code-reviewer:
        gate3: "Required (Layer 2)"
        gate4: "Optional (second opinion)"
        notes: "Alex can re-run if concerned"

      security-auditor:
        gate3: "Conditional (Layer 2)"
        gate4: "Optional (verification)"
        notes: "Alex reviews evidence only"

      performance-optimizer:
        gate3: "Conditional (Layer 2)"
        gate4: "Optional (verification)"
        notes: "Alex reviews evidence only"

      ux-expert-reviewer:
        gate3: "N/A"
        gate4: "Optional (if UI involved)"
        notes: "Business/UX focus"

      product-expert:
        gate3: "N/A"
        gate4: "Optional (business logic)"
        notes: "Business focus"

    principles:
      - "Gate 3 (Blake): Technical quality verification - MANDATORY technical experts"
      - "Gate 4 (Alex): Business value acceptance - OPTIONAL business experts, technical experts only review evidence"

# ==================== äº¤äº’åè®® ====================
interaction_protocol:
  # ç”¨æˆ·äº¤äº’æ ¼å¼ï¼ˆå€Ÿé‰´BMADï¼‰
  user_interaction_format:
    standard: "1-9æ•°å­—é€‰é¡¹"
    example: |
      è¯·é€‰æ‹©ï¼š
      1. ç»§ç»­ä¸‹ä¸€æ­¥
      2. æä¾›æ›´å¤šä¿¡æ¯
      3. ä¿®æ”¹å½“å‰å†…å®¹
      4. æŸ¥çœ‹å…¶ä»–é€‰é¡¹
      5. æ·±å…¥è®¨è®º
      6. è¿”å›ä¸Šä¸€æ­¥
      7. ä¿å­˜å¹¶æš‚åœ
      8. æŸ¥çœ‹å¸®åŠ©
      9. é€€å‡º

  # Agenté—´äº¤äº’åè®®
  agent_handoff_protocol:
    format: "æ ‡å‡†åŒ–markdownæ–‡æ¡£"
    required_sections:
      - "## ä»»åŠ¡æ¦‚è¿°"
      - "## èƒŒæ™¯ä¸Šä¸‹æ–‡"
      - "## å…·ä½“è¦æ±‚"
      - "## è®¾è®¡è§„èŒƒ"
      - "## å®æ–½æ­¥éª¤"
      - "## éªŒæ”¶æ ‡å‡†"
      - "## æ³¨æ„äº‹é¡¹"

  # è¿è§„æç¤º
  violation_alerts:
    format: |
      âš ï¸ VIOLATION DETECTED âš ï¸
      Type: {violation_type}
      Agent: {agent_name}
      Action: {forbidden_action}
      Correction: {required_correction}

# ==================== ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ ====================
task_management:
  task_id_format: "TASK-{YYYY}{MM}{DD}-{3ä½åºå·}"

  task_states:
    - "pending": "å¾…å¼€å§‹"
    - "in_progress": "è¿›è¡Œä¸­"
    - "blocked": "è¢«é˜»å¡"
    - "review": "å®¡æŸ¥ä¸­"
    - "completed": "å·²å®Œæˆ"
    - "archived": "å·²å½’æ¡£"

  task_tracking:
    location: ".tad/active/tasks/"
    format: "{task_id}_tracking.yaml"
    required_fields:
      - task_id
      - title
      - status
      - owner
      - created
      - updated
      - dependencies
      - blockers
      - deliverables

  dependency_management:
    check_before_start: true
    block_if_unmet: true
    alert_on_circular: true

# ==================== ç›‘æ§ä¸æŠ¥å‘Š ====================
monitoring:
  violation_log:
    location: ".tad/logs/violations.log"
    format: "[{timestamp}] {agent} - {violation} - {action_taken}"

  subagent_usage_log:
    location: ".tad/logs/subagent_usage.log"
    format: "[{timestamp}] {agent} â†’ {subagent} for {task}"

  performance_metrics:
    track:
      - "éœ€æ±‚ç¡®è®¤è½®æ¬¡"
      - "è®¾è®¡è¿­ä»£æ¬¡æ•°"
      - "sub-agentè°ƒç”¨ç‡"
      - "è¿è§„æ¬¡æ•°"
      - "è¿”å·¥ç‡"

  daily_report:
    generate: true
    location: ".tad/reports/daily_{date}.md"
    include:
      - "ä»»åŠ¡å®Œæˆæƒ…å†µ"
      - "è¿è§„ç»Ÿè®¡"
      - "sub-agentä½¿ç”¨ç»Ÿè®¡"
      - "è´¨é‡é—¨æ§é€šè¿‡ç‡"

# ==================== å‘½ä»¤ç³»ç»Ÿ ====================
command_system:
  prefix: "*"

  global_commands:
    - "*help": "æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤"
    - "*status": "æ˜¾ç¤ºå½“å‰çŠ¶æ€"
    - "*tasks": "æ˜¾ç¤ºä»»åŠ¡åˆ—è¡¨"
    - "*history": "æ˜¾ç¤ºå†å²è®°å½•"
    - "*config": "æ˜¾ç¤ºå½“å‰é…ç½®"

  agent_specific_commands:
    agent_a:
      - "*analyze <requirement>": "æ·±åº¦éœ€æ±‚åˆ†æ"
      - "*design <feature>": "åˆ›å»ºæŠ€æœ¯è®¾è®¡"
      - "*review <code>": "ä»£ç å®¡æŸ¥"
      - "*handoff": "ç”Ÿæˆäº¤æ¥æ–‡æ¡£"
      - "*call <subagent>": "è°ƒç”¨sub-agent"

    agent_b:
      - "*execute <handoff>": "æ‰§è¡Œäº¤æ¥ä»»åŠ¡"
      - "*parallel <tasks>": "å¹¶è¡Œæ‰§è¡Œ"
      - "*test": "è¿è¡Œæµ‹è¯•"
      - "*deploy": "éƒ¨ç½²åº”ç”¨"
      - "*report": "ç”ŸæˆæŠ¥å‘Š"

# ==================== MCP å·¥å…·é›†æˆ (v1.2 æ–°å¢) ====================
mcp_tools:
  enabled: true
  version: "1.2"
  registry_file: ".tad/mcp-registry.yaml"
  description: "MCP tools enhance TAD agents but are NOT required for core functionality"

  # Agent A (Alex) - Solution Lead MCP é…ç½®
  agent_a_tools:
    core_layer:
      tools: ["context7", "sequential-thinking", "memory-bank", "brave-search"]
      description: "æ ¸å¿ƒå±‚å·¥å…·,å¢å¼ºéœ€æ±‚åˆ†æå’Œè®¾è®¡èƒ½åŠ›"

    auto_trigger:
      context7:
        description: "æ£€æµ‹åˆ°æ¡†æ¶/åº“å…³é”®è¯æ—¶è‡ªåŠ¨è°ƒç”¨æœ€æ–°æ–‡æ¡£"
        keywords:
          - "Next.js"
          - "React"
          - "Vue"
          - "Tailwind"
          - "TypeScript"
          - "Supabase"
          - "æ¡†æ¶"
          - "åº“"
        action: "auto_call"
        timing: "Round 1-2 ä¹‹é—´"

      memory-bank:
        description: "éœ€æ±‚åˆ†æå¼€å§‹å‰æ¨èè°ƒç”¨é¡¹ç›®å†å²"
        action: "recommend"
        timing:
          - "Round 0 (éœ€æ±‚åˆ†æå¼€å§‹)"
          - "è®¾è®¡é˜¶æ®µå¼€å§‹"
          - "å›é¡¾å†å²å†³ç­–æ—¶"

      sequential-thinking:
        description: "å¤æ‚é—®é¢˜åˆ†è§£æ—¶å»ºè®®ä½¿ç”¨"
        keywords: ["å¤æ‚", "æ¶æ„", "ç³»ç»Ÿè®¾è®¡", "ç®—æ³•"]
        action: "suggest"

      brave-search:
        description: "æŠ€æœ¯ä¸ç¡®å®šæ—¶å»ºè®®è°ƒç ”"
        action: "suggest"
        timing: ["Round 2 æŠ€æœ¯ç ”ç©¶"]

    workflow_integration:
      requirement_analysis:
        - "Round 0: RECOMMEND memory-bank"
        - "Round 1-2: AUTO-TRIGGER context7 on framework mention"
        - "Round 2: SUGGEST brave-search if technical uncertainty"
        - "Round 2.5: AUTO-DETECT project type and recommend Project MCPs"

      design_phase:
        - "USE context7 for latest best practices"
        - "USE sequential-thinking for complex architecture"
        - "USE memory-bank to review past decisions"

      handoff_creation:
        - "INCLUDE MCP tools used in handoff document"
        - "RECOMMEND Blake which Project MCPs to use"

    forbidden_mcp_tools:
      description: "Alex ä¸åº”ä½¿ç”¨çš„ MCP (Blake's domain)"
      list:
        - "filesystem"  # Blake çš„æ–‡ä»¶æ“ä½œ
        - "git"         # Blake çš„ç‰ˆæœ¬æ§åˆ¶
        - "docker"      # Blake çš„å®¹å™¨ç®¡ç†
        - "kubernetes"  # Blake çš„éƒ¨ç½²
        - "terminal"    # Blake çš„å‘½ä»¤æ‰§è¡Œ

  # Agent B (Blake) - Execution Master MCP é…ç½®
  agent_b_tools:
    core_layer:
      tools: ["filesystem", "git", "github"]
      required: ["filesystem", "git"]
      description: "æ ¸å¿ƒå±‚å·¥å…·,å®ç°å¼€å‘å¿…å¤‡"

    project_layer:
      description: "æ ¹æ® Alex åœ¨ Round 2.5 æ¨èçš„é¡¹ç›®ç±»å‹å·¥å…·"
      examples:
        web_fullstack: ["supabase", "playwright", "vercel", "react-mcp"]
        data_science: ["jupyter", "pandas-mcp", "antv-chart", "postgres-mcp-pro"]
        machine_learning: ["jupyter", "optuna", "huggingface", "zenml"]
        devops: ["kubernetes", "docker", "aws", "terminal"]
        creative: ["figma", "video-audio-mcp", "adobe-mcp"]

    auto_use:
      filesystem:
        description: "æ‰€æœ‰æ–‡ä»¶åˆ›å»ºã€è¯»å–ã€ä¿®æ”¹æ“ä½œè‡ªåŠ¨ä½¿ç”¨"
        operations: ["create", "read", "update", "delete", "list"]

      git:
        description: "æ‰€æœ‰ç‰ˆæœ¬æ§åˆ¶æ“ä½œè‡ªåŠ¨ä½¿ç”¨"
        operations: ["commit", "branch", "merge", "status"]

      context7:
        description: "å®ç°æ¡†æ¶ä»£ç æ—¶è‡ªåŠ¨è§¦å‘"
        trigger: "when implementing framework-specific code"

    workflow_integration:
      pre_implementation:
        - "VERIFY filesystem MCP is active"
        - "VERIFY git MCP is active"
        - "CHECK project MCPs from handoff recommendation"
        - "HALT if required MCPs unavailable"

      during_implementation:
        - "AUTO-USE filesystem for all file operations"
        - "AUTO-USE git for version control"
        - "AUTO-TRIGGER context7 when implementing framework code"
        - "USE project MCPs as recommended by Alex"

      testing_phase:
        - "USE playwright MCP for E2E tests (if available)"
        - "USE terminal MCP for test execution"

      deployment:
        - "USE vercel/aws MCP for deployment (if configured)"
        - "USE kubernetes/docker MCP for container deployment"

    pre_flight_checks:
      description: "Run before *develop command"
      checklist:
        - check: "filesystem MCP active"
          action_if_fail: "HALT - Cannot proceed without filesystem access"
          severity: "blocking"

        - check: "git MCP active"
          action_if_fail: "HALT - Cannot proceed without version control"
          severity: "blocking"

        - check: "handoff document exists"
          action_if_fail: "HALT - Cannot start without handoff from Alex"
          severity: "blocking"

        - check: "project MCPs availability"
          action_if_fail: "WARN - Suggest installing recommended MCPs"
          severity: "warning"

  # MCP ä½¿ç”¨å¼ºåˆ¶æœºåˆ¶
  enforcement:
    mode: "recommend"
    description: "æ¨èæ¨¡å¼ - MCP æ˜¯å¢å¼º,ä¸æ˜¯å¿…éœ€"

    violation_detection:
      enabled: true
      checks:
        - "Blake å°è¯•å¼€å§‹ *develop ä½† filesystem MCP ä¸å¯ç”¨"
        - "Blake å°è¯•å¼€å§‹ *develop ä½† git MCP ä¸å¯ç”¨"
        - "Alex è°ƒç”¨äº† filesystem/git MCP (violation - Blake's domain)"

    violation_action: "warn"
    violation_format: |
      âš ï¸ MCP VIOLATION âš ï¸
      Agent: {agent_name}
      Issue: {violation_description}
      Action: {required_correction}

    non_blocking:
      description: "MCP å·¥å…·ä¸å¯ç”¨æ—¶ä¸é˜»å¡åŸæœ‰ TAD å·¥ä½œæµ"
      fallback: "ä½¿ç”¨ Claude Code å†…ç½®èƒ½åŠ›ç»§ç»­æ‰§è¡Œ"
      log: "è®°å½• MCP ä¸å¯ç”¨æƒ…å†µä¾›åç»­æ”¹è¿›"

  # MCP å®‰å…¨é…ç½®
  security:
    auto_approve_readonly: true
    description: "åªè¯»æ“ä½œè‡ªåŠ¨æ‰¹å‡†,å±é™©æ“ä½œéœ€ç¡®è®¤"

    auto_approve_safe:
      - "git status"
      - "git diff"
      - "git log"
      - "filesystem read operations"
      - "context7 documentation queries"
      - "memory-bank history queries"

    always_confirm:
      - "git push"
      - "git push --force"
      - "rm -rf"
      - "filesystem delete operations"
      - "docker rm"
      - "kubectl delete"
      - "vercel deploy --prod"
      - "aws operations"

  # Project Type Detection Integration
  project_detection:
    enabled: true
    timing: "Round 2.5 (after tech stack confirmed)"
    confidence_threshold:
      web_fullstack: 0.7
      data_science: 0.6
      machine_learning: 0.8
      devops: 0.7
      creative: 0.7

    detection_method:
      - "Keywords in user responses"
      - "File patterns in existing codebase"
      - "Tech stack preferences"

    action_on_detection:
      - "Display project type and confidence"
      - "Show recommended Project-Layer MCPs"
      - "Offer installation options (0-2)"
      - "Record user decision"
      - "Continue to Round 3 regardless of choice"

  # MCP æ•ˆç‡æå‡è¿½è¸ª
  efficiency_tracking:
    enabled: true
    metrics:
      - "MCP tools used per task"
      - "Time saved estimates"
      - "Documentation accuracy improvements"
      - "Code quality improvements"

    reporting:
      location: ".tad/logs/mcp_usage.log"
      format: "[{timestamp}] {agent} used {mcp_tool} for {task} - Estimated time saved: {minutes}m"

  # é‡è¦æé†’
  important_notes:
    - "MCP å·¥å…·æ˜¯ ENHANCEMENTS,ä¸æ˜¯ REQUIREMENTS"
    - "æ‰€æœ‰åŸæœ‰ TAD å·¥ä½œæµåœ¨æ²¡æœ‰ MCP çš„æƒ…å†µä¸‹ä»å®Œå…¨å¯ç”¨"
    - "MCP å·¥å…·å¤±è´¥æ—¶ä¸åº”é˜»æ­¢è¿›åº¦"
    - "å§‹ç»ˆé€šçŸ¥ç”¨æˆ·æ­£åœ¨ä½¿ç”¨å“ªäº› MCP å·¥å…·"
    - "MCP æ•…éšœåº”è®°å½•ä½†ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½"
    - "filesystem å’Œ git æ˜¯ Blake çš„å¿…éœ€ MCP,å…¶ä»–éƒ½æ˜¯å¯é€‰"

# ==================== YOLOæ¨¡å¼ï¼ˆå¯é€‰ï¼‰ ====================
yolo_mode:
  enabled: false
  activation: "#yolo"
  warning: "âš ï¸ YOLOæ¨¡å¼ä¼šè·³è¿‡éƒ¨åˆ†éªŒè¯æ­¥éª¤ï¼Œä»…åœ¨ç´§æ€¥æƒ…å†µä½¿ç”¨"
  restrictions:
    - "ä»éœ€éµå®ˆè§’è‰²è¾¹ç•Œ"
    - "ä¸èƒ½è·³è¿‡å…³é”®è´¨é‡é—¨æ§"
    - "å¿…é¡»è®°å½•åŸå› "

# ==================== ç‰ˆæœ¬å‘å¸ƒç®¡ç† (v1.5 æ–°å¢) ====================
release_management:
  enabled: true
  version: "1.0"
  description: "å¤šå¹³å°ç‰ˆæœ¬å‘å¸ƒç®¡ç†è§„åˆ™"

  # æ ¸å¿ƒæ–‡æ¡£
  documents:
    changelog: "CHANGELOG.md"
    release_sop: "RELEASE.md"
    api_versioning: "docs/API-VERSIONING.md"
    release_handoff_template: ".tad/templates/release-handoff.md"

  # ç‰ˆæœ¬ç­–ç•¥
  versioning:
    scheme: "semver"  # Semantic Versioning
    source_of_truth: "package.json"
    format: "MAJOR.MINOR.PATCH"

    rules:
      patch: "Bugä¿®å¤ï¼Œæ— æ–°åŠŸèƒ½ï¼Œå®Œå…¨å‘åå…¼å®¹"
      minor: "æ–°åŠŸèƒ½ï¼Œå‘åå…¼å®¹"
      major: "ç ´åæ€§å˜æ›´ï¼Œä¸å‘åå…¼å®¹"

  # å‘å¸ƒç±»å‹å’Œåˆ†å·¥
  release_types:
    routine_release:
      description: "å¸¸è§„å‘å¸ƒ (patch/minor)"
      trigger_keywords: ["å‘å¸ƒç‰ˆæœ¬", "release", "éƒ¨ç½²æ–°ç‰ˆæœ¬"]
      workflow: "Blake æŒ‰ RELEASE.md SOP æ‰§è¡Œ"
      needs_handoff: false
      gates_required: ["gate3", "gate4"]

    major_release:
      description: "é‡å¤§å‘å¸ƒ (major/breaking)"
      trigger_keywords: ["ç ´åæ€§å˜æ›´", "breaking change", "å¤§ç‰ˆæœ¬", "major"]
      workflow: "Alex åˆ›å»º release-handoff â†’ Blake æ‰§è¡Œ"
      needs_handoff: true
      gates_required: ["gate2", "gate3", "gate4"]

    ios_release:
      description: "iOS App Store å‘å¸ƒ"
      trigger_keywords: ["å‘å¸ƒiOS", "App Store", "iOS release"]
      workflow: "Blake æ‰§è¡Œ npm run release:ios + Xcode æäº¤"
      needs_handoff: false
      gates_required: ["gate3", "gate4"]
      extra_steps:
        - "npm run version:sync"
        - "npm run build:ios"
        - "Open Xcode and Archive"
        - "Submit to App Store Connect"

  # Agent åˆ†å·¥
  agent_responsibilities:
    alex:
      tasks:
        - "ç‰ˆæœ¬ç­–ç•¥åˆ¶å®š (SemVer è§„åˆ™)"
        - "API å¥‘çº¦è®¾è®¡"
        - "ç ´åæ€§å˜æ›´å½±å“åˆ†æ"
        - "é‡å¤§å‘å¸ƒå†³ç­–"
        - "åˆ›å»º release-handoff (ä»… major)"
      forbidden:
        - "ç›´æ¥æ‰§è¡Œå‘å¸ƒå‘½ä»¤"
        - "ä¿®æ”¹ CHANGELOG"
        - "è¿è¡Œæ„å»ºè„šæœ¬"

    blake:
      tasks:
        - "æ—¥å¸¸ç‰ˆæœ¬å‘å¸ƒæ‰§è¡Œ"
        - "æ›´æ–° CHANGELOG.md"
        - "è¿è¡Œ npm run release:ios"
        - "æ‰§è¡Œæ„å»ºå’Œéƒ¨ç½²"
        - "ç‰ˆæœ¬å·åŒæ­¥ (npm version)"
      forbidden:
        - "ç‹¬ç«‹å†³å®šç ´åæ€§å˜æ›´"
        - "è·³è¿‡ Gate 3/4 éªŒè¯"

  # å‘å¸ƒæ£€æŸ¥æ¸…å•
  release_checklist:
    pre_release:
      - check: "æ‰€æœ‰æµ‹è¯•é€šè¿‡"
        command: "npm test"
        blocking: true
      - check: "æ„å»ºæˆåŠŸ"
        command: "npm run build"
        blocking: true
      - check: "CHANGELOG å·²æ›´æ–°"
        file: "CHANGELOG.md"
        blocking: true
      - check: "ç‰ˆæœ¬å·å·²æ›´æ–°"
        file: "package.json"
        blocking: true

    deploy:
      - action: "æ¨é€åˆ° main"
        command: "git push origin main"
        platforms: ["web"]
      - action: "Vercel è‡ªåŠ¨éƒ¨ç½²"
        platforms: ["web"]
      - action: "æ„å»º iOS"
        command: "npm run release:ios"
        platforms: ["ios"]

    post_release:
      - check: "ç”Ÿäº§ç¯å¢ƒå¯è®¿é—®"
        blocking: true
      - check: "æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸"
        blocking: true
      - check: "é”™è¯¯ç‡æ— å¼‚å¸¸ (24h)"
        blocking: false

  # å¤šå¹³å°å½±å“çŸ©é˜µ
  platform_impact_matrix:
    change_types:
      ui_only:
        description: "çº¯ UI å˜æ›´"
        web_impact: "å³æ—¶ç”Ÿæ•ˆ"
        ios_impact: "éœ€è¦é‡æ–°æ„å»º"
        action: "Web è‡ªåŠ¨ï¼ŒiOS æŒ‰éœ€å‘å¸ƒ"

      api_compatible:
        description: "API å˜æ›´ (å‘åå…¼å®¹)"
        web_impact: "å³æ—¶ç”Ÿæ•ˆ"
        ios_impact: "å³æ—¶ç”Ÿæ•ˆ"
        action: "éƒ¨ç½² Vercel å³å¯"

      api_breaking:
        description: "API å˜æ›´ (ç ´åæ€§)"
        web_impact: "å³æ—¶ç”Ÿæ•ˆ"
        ios_impact: "âš ï¸ æ—§ç‰ˆæœ¬ä¼šå´©æºƒ"
        action: "å¿…é¡» API ç‰ˆæœ¬åŒ– + åŒæ­¥å‘å¸ƒæ‰€æœ‰å®¢æˆ·ç«¯"

  # API ç‰ˆæœ¬ç®¡ç†
  api_versioning:
    strategy: "url_path"  # /api/v1/*
    current_version: "v1"

    backward_compatibility_rules:
      - "NEVER åˆ é™¤å·²æœ‰å­—æ®µ"
      - "NEVER ä¿®æ”¹å­—æ®µç±»å‹"
      - "NEVER é‡å‘½åç«¯ç‚¹"
      - "ALWAYS åªæ·»åŠ æ–°å­—æ®µ/ç«¯ç‚¹"
      - "DEPRECATE éœ€è¦ 30+ å¤©è¿‡æ¸¡æœŸ"

    migration_process:
      step1: "åˆ›å»ºæ–°ç‰ˆæœ¬ API ä¿æŒæ—§ç‰ˆæœ¬è¿è¡Œ"
      step2: "æ›´æ–°æ‰€æœ‰å®¢æˆ·ç«¯ä½¿ç”¨æ–° API"
      step3: "ç›‘æ§æ—§ API ä½¿ç”¨é‡"
      step4: "90%+ è¿ç§»åå¯åˆ é™¤æ—§ API"

  # å¿«é€Ÿå‘½ä»¤å‚è€ƒ
  quick_commands:
    version_bump:
      patch: "npm version patch"
      minor: "npm version minor"
      major: "npm version major"
    sync_ios: "npm run version:sync"
    build_ios: "npm run release:ios"
    check_version: "node -p \"require('./package.json').version\""

# ==================== TAD v1.3 å¢å¼ºé…ç½® ====================
# åˆ›å»ºæ—¥æœŸ: 2025-11-25
# åŸºäº: MenuSnapé¡¹ç›®å®è¯åˆ†æ + ä¸‰ä»½æ ¸å¿ƒæ–‡æ¡£
# ç›®æ ‡: è¯æ®å¼è´¨é‡ä¿è¯ + Humanå¯è§†åŒ–èµ‹èƒ½ + æŒç»­å­¦ä¹ 

tad_version: 1.3.0
enhancement_date: 2025-11-25
philosophy: "Evidence-Based Triangle Development with Continuous Learning"

# ==================== è¯æ®å¼éªŒè¯ç³»ç»Ÿ ====================
evidence_based_verification:
  enabled: true
  description: "æ‰€æœ‰å…³é”®æ£€æŸ¥ç‚¹éƒ½éœ€è¦æä¾›å¯éªŒè¯çš„è¯æ®"

  required_evidence_types:
    # è¯æ®ç±»å‹1ï¼šæœç´¢ç»“æœ
    search_result:
      format: "å‘½ä»¤ + ç»“æœæˆªå›¾æˆ–æ–‡æœ¬è¾“å‡º"
      purpose: "è¯æ˜ç¡®å®æœç´¢äº†å†å²ä»£ç "
      example: |
        ```bash
        # æœç´¢å‘½ä»¤
        grep -r "calculateScore" src/

        # ç»“æœ
        src/lib/utils.ts:42: export function calculateScoreAndReasons(...)
        ```
      human_validation: "èƒ½çœ‹åˆ°æœç´¢å‘½ä»¤å’Œç»“æœ"
      mandatory_for: ["MQ1"]

    # è¯æ®ç±»å‹2ï¼šä»£ç ä½ç½®è¯æ˜
    code_location:
      format: "Markdownè¡¨æ ¼ï¼šå‡½æ•°å | æ–‡ä»¶ä½ç½® | è¡Œå· | ä»£ç ç‰‡æ®µ | éªŒè¯çŠ¶æ€"
      purpose: "è¯æ˜å‡½æ•°/ç»„ä»¶ç¡®å®å­˜åœ¨"
      example: |
        | å‡½æ•°å | ä½ç½® | è¡Œå· | ä»£ç ç‰‡æ®µ | éªŒè¯ |
        |--------|------|------|---------|------|
        | calculateScore | src/lib/utils.ts | 42 | `export function calculateScore(...)` | âœ… |
      human_validation: "èƒ½çœ‹åˆ°å…·ä½“ä½ç½®å’Œä»£ç ï¼Œæ¯ä¸ªéƒ½æ ‡è®°âœ…"
      mandatory_for: ["MQ2"]

    # è¯æ®ç±»å‹3ï¼šæ•°æ®æµå›¾
    data_flow_diagram:
      format: "Mermaidå›¾ + Markdownå¯¹ç…§è¡¨"
      purpose: "å±•ç¤ºæ•°æ®ä»åç«¯åˆ°å‰ç«¯çš„å®Œæ•´æµåŠ¨"
      example: |
        ```mermaid
        graph LR
          A[Backend API] -->|è®¡ç®—| B[score, reasons, warnings]
          B -->|ä¼ é€’| C[Frontend]
          C -->|æ˜¾ç¤º| D[ScoreDisplay]
          C -->|æ˜¾ç¤º| E[ReasonList]
          C -->|æ˜¾ç¤º| F[WarningAlert]
        ```

        | åç«¯å­—æ®µ | å‰ç«¯ç»„ä»¶ | æ˜¯å¦æ˜¾ç¤º | ä¸æ˜¾ç¤ºåŸå›  |
        |---------|---------|---------|-----------|
        | score | ScoreDisplay | âœ… | - |
        | matchReasons | ReasonList | âœ… | - |
      human_validation: "èƒ½çœ‹åˆ°æ¯ä¸ªå­—æ®µéƒ½æœ‰å¯¹åº”çš„æ˜¾ç¤ºç»„ä»¶ï¼Œæˆ–æœ‰åˆç†çš„ä¸æ˜¾ç¤ºåŸå› "
      mandatory_for: ["MQ3"]

    # è¯æ®ç±»å‹4ï¼šçŠ¶æ€æµå›¾
    state_flow_diagram:
      format: "ASCIIå›¾æˆ–MermaidçŠ¶æ€å›¾"
      purpose: "å±•ç¤ºçŠ¶æ€çš„æ¥æºã€å­˜å‚¨ä½ç½®ã€åŒæ­¥æ—¶æœº"
      example: |
        [ç”¨æˆ·è¾“å…¥] â†’ preferences.allergens (ä¸»çŠ¶æ€ï¼ŒSource of Truth)
                      â†“ åŒæ­¥æ—¶æœºï¼šonSubmitäº‹ä»¶
                   dietaryRestrictions.allergies (å¤‡ä»½çŠ¶æ€)
      human_validation: "èƒ½çœ‹åˆ°æ˜¯å¦æœ‰å¤šå¤„å­˜å‚¨ã€è°æ˜¯ä¸»çŠ¶æ€ã€ä½•æ—¶åŒæ­¥"
      mandatory_for: ["MQ5"]

    # è¯æ®ç±»å‹5ï¼šUIæˆªå›¾
    ui_screenshot:
      format: "æµè§ˆå™¨æˆªå›¾æˆ–UI mockup"
      purpose: "è¯æ˜åŠŸèƒ½çš„è§†è§‰æ•ˆæœ"
      example: "æµè§ˆå™¨æˆªå›¾æ˜¾ç¤ºæ¨èç†ç”±å’Œè­¦å‘Šçš„è§†è§‰å±‚çº§"
      human_validation: "èƒ½çœ‹åˆ°å®é™…æ˜¾ç¤ºæ•ˆæœï¼Œè§†è§‰å±‚çº§æ¸…æ™°"
      mandatory_for: ["MQ4", "Phaseå®ŒæˆæŠ¥å‘Š"]

    # è¯æ®ç±»å‹6ï¼šæµ‹è¯•ç»“æœ
    test_result:
      format: "æµ‹è¯•è¿è¡Œæˆªå›¾æˆ–æ—¥å¿—è¾“å‡º"
      purpose: "è¯æ˜ä»£ç èƒ½è¿è¡Œã€æµ‹è¯•é€šè¿‡"
      example: |
        ```
        âœ“ 42 tests passing
        âœ“ Coverage: 87%
        ```
      human_validation: "èƒ½çœ‹åˆ°æµ‹è¯•é€šè¿‡ï¼ˆpassed/ç»¿è‰²âœ“ï¼‰ï¼Œè¦†ç›–ç‡è¾¾æ ‡"
      mandatory_for: ["Phaseå®ŒæˆæŠ¥å‘Š"]

# ==================== å¼ºåˆ¶å›ç­”é—®é¢˜ç³»ç»Ÿ ====================
mandatory_questions:
  enabled: true
  blocking: true
  auto_sync: true
  source: ".tad/archive/evidence/patterns/failure-patterns.md"
  description: "ä»å†å²å¤±è´¥ä¸­æç‚¼çš„å¿…é¡»å›ç­”çš„é—®é¢˜"

  # é—®é¢˜åº“
  questions:
    MQ1_historical_code:
      id: "MQ1"
      pattern_source: "Failure Pattern 2: Creating Instead of Searching"
      trigger_keywords: ["ä¹‹å‰çš„", "åŸæ¥çš„", "æˆ‘ä»¬çš„æ–¹æ¡ˆ", "previous", "original", "existing"]
      trigger_condition: "ç”¨æˆ·æè¿°ä¸­æåˆ°å†å²æ–¹æ¡ˆæˆ–ç°æœ‰åŠŸèƒ½"

      question: "ç”¨æˆ·æåˆ°äº†å†å²æ–¹æ¡ˆï¼Œä½ æ‰¾åˆ°ç›¸å…³ä»£ç äº†å—ï¼Ÿ"
      sub_questions:
        - "æœç´¢äº†å“ªäº›å…³é”®è¯ï¼Ÿ"
        - "æ‰¾åˆ°äº†ä»€ä¹ˆï¼Ÿåœ¨å“ªé‡Œï¼Ÿ"
        - "ä¸ºä»€ä¹ˆå†³å®šå¤ç”¨/ä¸å¤ç”¨ï¼Ÿ"

      required_evidence: "search_result"
      evidence_format: "æœç´¢å‘½ä»¤ + å®Œæ•´è¾“å‡º + å†³ç­–è¯´æ˜"
      blocking: true

      human_validation_question: "èƒ½çœ‹åˆ°æœç´¢ç¡®å®æ‰§è¡Œäº†å—ï¼Ÿå†³ç­–ç†ç”±åˆç†å—ï¼Ÿ"

    MQ2_function_existence:
      id: "MQ2"
      pattern_source: "Failure Pattern 3: Function Assumption Errors"
      trigger_condition: "è®¾è®¡ä¸­åŒ…å«å‡½æ•°è°ƒç”¨æˆ–ç»„ä»¶å¼•ç”¨"

      question: "è®¾è®¡ä¸­è°ƒç”¨äº†å“ªäº›å‡½æ•°/ç»„ä»¶ï¼Ÿå®ƒä»¬éƒ½å­˜åœ¨å—ï¼Ÿ"
      sub_questions:
        - "åˆ—å‡ºæ‰€æœ‰å°†è°ƒç”¨çš„å‡½æ•°/ç»„ä»¶"
        - "æ¯ä¸ªå‡½æ•°åœ¨å“ªä¸ªæ–‡ä»¶çš„ç¬¬å‡ è¡Œï¼Ÿ"
        - "è¯·æä¾›å‡½æ•°å®šä¹‰çš„ä»£ç ç‰‡æ®µ"

      required_evidence: "code_location"
      evidence_format: "Markdownè¡¨æ ¼ï¼Œæ¯ä¸ªå‡½æ•°/ç»„ä»¶éƒ½æœ‰ä½ç½®è¯æ˜"
      blocking: true

      human_validation_question: "æ¯ä¸ªå‡½æ•°éƒ½æœ‰âœ…å­˜åœ¨æ ‡è®°å’Œå…·ä½“ä½ç½®å—ï¼Ÿ"

    MQ3_data_flow:
      id: "MQ3"
      pattern_source: "Failure Pattern 4: Incomplete Data Flow"
      trigger_condition: "åç«¯è®¡ç®—æˆ–è¿”å›æ•°æ®ç»™å‰ç«¯"

      question: "åç«¯è®¡ç®—/è¿”å›äº†å“ªäº›å­—æ®µï¼Ÿå‰ç«¯éƒ½æ˜¾ç¤ºäº†å—ï¼Ÿ"
      sub_questions:
        - "åç«¯è¿”å›çš„å®Œæ•´å­—æ®µåˆ—è¡¨"
        - "æ¯ä¸ªå­—æ®µåœ¨å‰ç«¯çš„å“ªä¸ªç»„ä»¶æ˜¾ç¤ºï¼Ÿ"
        - "æœ‰æ²¡æœ‰å­—æ®µä¸æ˜¾ç¤ºï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"

      required_evidence: "data_flow_diagram"
      evidence_format: "æ•°æ®æµå›¾ï¼ˆMermaidï¼‰+ å¯¹ç…§è¡¨"
      blocking: true

      human_validation_question: |
        - åç«¯æ¯ä¸ªå­—æ®µéƒ½æœ‰å¯¹åº”çš„å‰ç«¯ç»„ä»¶å—ï¼Ÿ
        - "âŒä¸æ˜¾ç¤º"çš„å­—æ®µæœ‰åˆç†åŸå› å—ï¼Ÿ

    MQ4_visual_hierarchy:
      id: "MQ4"
      pattern_source: "Failure Pattern 5: Visual Uniformity Disease"
      trigger_condition: "åŠŸèƒ½æœ‰å¤šä¸ªçŠ¶æ€ã€ç±»å‹æˆ–ä¼˜å…ˆçº§"

      question: "è¿™ä¸ªåŠŸèƒ½æœ‰ä¸åŒçš„çŠ¶æ€/ç±»å‹å—ï¼Ÿç”¨æˆ·å¦‚ä½•è§†è§‰ä¸ŠåŒºåˆ†ï¼Ÿ"
      sub_questions:
        - "æœ‰å“ªäº›ä¸åŒçš„çŠ¶æ€ï¼Ÿï¼ˆå¦‚ï¼šæ¨è/ä¸æ¨èï¼ŒæˆåŠŸ/å¤±è´¥ï¼‰"
        - "æ¯ä¸ªçŠ¶æ€çš„è§†è§‰è¡¨ç°æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆé¢œè‰²ã€å›¾æ ‡ã€æ–‡å­—ï¼‰"
        - "ç”¨æˆ·èƒ½ä¸€çœ¼çœ‹å‡ºåŒºåˆ«å—ï¼Ÿ"

      required_evidence: "ui_screenshot"
      evidence_format: "UIçŠ¶æ€å¯¹æ¯”è¡¨ + æˆªå›¾/mockup"
      blocking: false  # è­¦å‘Šä½†ä¸é˜»å¡

      human_validation_question: "ä»æˆªå›¾èƒ½çœ‹å‡ºä¸åŒçŠ¶æ€çš„æ˜æ˜¾åŒºåˆ«å—ï¼Ÿ"

    MQ5_state_sync:
      id: "MQ5"
      pattern_source: "Real Issue: Dual State Sync Problem"
      trigger_condition: "æ¶‰åŠç”¨æˆ·è¾“å…¥ã€çŠ¶æ€ç®¡ç†æˆ–å‰åç«¯æ•°æ®ä¼ é€’"

      question: "æ•°æ®å­˜åœ¨å‡ ä¸ªåœ°æ–¹ï¼Ÿå®ƒä»¬ä»€ä¹ˆæ—¶å€™åŒæ­¥ï¼Ÿ"
      sub_questions:
        - "åˆ—å‡ºæ‰€æœ‰å­˜å‚¨è¿™ä¸ªæ•°æ®çš„åœ°æ–¹ï¼ˆå‰ç«¯state/localStorage/åç«¯session/databaseï¼‰"
        - "å“ªä¸ªæ˜¯ä¸»çŠ¶æ€ï¼ˆSource of Truthï¼‰ï¼Ÿ"
        - "å…¶ä»–çŠ¶æ€ä»€ä¹ˆæ—¶å€™åŒæ­¥ï¼Ÿç”¨ä»€ä¹ˆè§¦å‘ï¼Ÿ"
        - "å¦‚æœå¿˜è®°åŒæ­¥ä¼šæ€æ ·ï¼Ÿç”¨æˆ·ä¼šçœ‹åˆ°ä»€ä¹ˆï¼Ÿ"

      required_evidence: "state_flow_diagram"
      evidence_format: "çŠ¶æ€æµå›¾ï¼Œæ ‡æ³¨ä¸»çŠ¶æ€ã€åŒæ­¥æ—¶æœºå’Œè§¦å‘æ¡ä»¶"
      blocking: true

      human_validation_question: |
        - æ¸…æ¥šæ ‡æ³¨å“ªä¸ªæ˜¯ä¸»çŠ¶æ€äº†å—ï¼Ÿ
        - åŒæ­¥æ—¶æœºæ˜ç¡®å—ï¼Ÿ
        - æˆ–ç¡®è®¤åªæœ‰å•ä¸€çŠ¶æ€ï¼Ÿ

    MQ6_technical_research:
      id: "MQ6"
      pattern_source: "v1.4 Enhancement: Proactive Technical Research"
      trigger_condition: "ä»»ä½•æŠ€æœ¯å†³ç­–ï¼ˆæ¡†æ¶é€‰æ‹©ã€åº“ä½¿ç”¨ã€æ¶æ„æ¨¡å¼ã€å®ç°æ–¹æ¡ˆï¼‰"

      question: "è¿™ä¸ªæŠ€æœ¯å†³ç­–ï¼Œä½ æœç´¢è¿‡æœ€æ–°æ–¹æ¡ˆäº†å—ï¼Ÿ"
      sub_questions:
        - "æœç´¢äº†å“ªäº›å…³é”®è¯ï¼Ÿ"
        - "æ‰¾åˆ°äº†å“ªäº›å€™é€‰æ–¹æ¡ˆï¼Ÿ"
        - "ä¸ºä»€ä¹ˆé€‰æ‹©å½“å‰æ–¹æ¡ˆè€Œéå…¶ä»–ï¼Ÿ"
        - "æœ‰æ²¡æœ‰æ›´æ–°çš„æ›¿ä»£æ–¹æ¡ˆï¼Ÿ"

      required_evidence: "technical_research_result"
      evidence_format: |
        ## æŠ€æœ¯è°ƒç ”è®°å½•
        | æœç´¢å…³é”®è¯ | å‘ç°çš„æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ˜¯å¦é‡‡ç”¨ |
        |-----------|-----------|------|------|---------|
        | xxx | æ–¹æ¡ˆA | ... | ... | âœ…/âŒ |
      blocking: true

      human_validation_question: |
        - æœç´¢èŒƒå›´å¤Ÿå¹¿å—ï¼Ÿ
        - å€™é€‰æ–¹æ¡ˆå¯¹æ¯”åˆç†å—ï¼Ÿ
        - é€‰æ‹©ç†ç”±æ¸…æ™°å—ï¼Ÿ

      # MQ6 æ·±åº¦è‡ªåŠ¨åˆ¤æ–­æœºåˆ¶
      depth_auto_detection:
        principle: "å®å¯å¤šæœï¼Œä¸è¦æ¼æœ"

        quick_scan:
          trigger: "ç®€å•é…ç½®ã€å¸¸è§ç”¨æ³•ã€æˆç†ŸæŠ€æœ¯"
          action: "å¿«é€Ÿç¡®è®¤æœ€ä½³å®è·µ"
          time: "1-2åˆ†é’Ÿ"
          example: "React useState ç”¨æ³•"

        standard_search:
          trigger: "æŠ€æœ¯é€‰å‹ã€åº“å¯¹æ¯”ã€æ¶æ„æ¨¡å¼"
          action: "æœç´¢2-3ä¸ªæ–¹æ¡ˆå¯¹æ¯”"
          time: "5-10åˆ†é’Ÿ"
          example: "çŠ¶æ€ç®¡ç†é€‰å‹ Redux vs Zustand vs Jotai"

        deep_research:
          trigger: "æ ¸å¿ƒæ¶æ„ã€åˆ›æ–°æ–¹æ¡ˆã€ç”¨æˆ·æ˜ç¡®è¦æ±‚"
          action: "æ·±åº¦è°ƒç ”ï¼ŒæŸ¥æ‰¾GitHubé¡¹ç›®ã€æœ€æ–°æ–‡ç« "
          time: "15-30åˆ†é’Ÿ"
          example: "AIé©±åŠ¨çš„èœå•æ¨èç³»ç»Ÿæ¶æ„"

        auto_escalation:
          - "æœç´¢ç»“æœä¸ç¡®å®š â†’ å‡çº§åˆ°ä¸‹ä¸€æ¡£"
          - "å‘ç°æ–°æŠ€æœ¯è¶‹åŠ¿ â†’ ä¸»åŠ¨æ·±å…¥"
          - "Humanè¡¨ç¤ºå…³æ³¨ â†’ è‡ªåŠ¨æ·±åº¦è°ƒç ”"

  # æ‰§è¡Œæœºåˆ¶
  enforcement:
    when: "Gate 2 (Design Completeness)"
    how: "Alexå¿…é¡»åœ¨handoffä¸­åŒ…å«'å¼ºåˆ¶é—®é¢˜å›ç­”'ç« èŠ‚"
    validation: "Humanæ£€æŸ¥æ¯ä¸ªè§¦å‘çš„MQæ˜¯å¦éƒ½æœ‰å›ç­”+è¯æ®"
    consequence_missing: "è¯æ®ä¸å®Œæ•´ â†’ é˜»æ­¢æäº¤handoffï¼Œè¦æ±‚è¡¥å……"
    consequence_incomplete: "è¯æ®è´¨é‡ä½ â†’ Humanè¦æ±‚é‡æ–°æä¾›"

  # è‡ªåŠ¨æ›´æ–°æœºåˆ¶
  auto_update_pipeline:
    trigger: "Humançº æ­£äº†AIçš„é”™è¯¯æˆ–å‘ç°æ–°çš„å¤±è´¥æ¨¡å¼"
    process: |
      1. æ•è·é”™è¯¯ç±»å‹å’Œæ ¹å› ï¼ˆåˆ›å»ºFailure Learning Entryï¼‰
      2. åˆ¤æ–­ï¼šè¿™ä¸ªé”™è¯¯åº”è¯¥ç”±å“ªä¸ªMQæ‹¦æˆªï¼Ÿ
      3. å¦‚æœç°æœ‰MQæœªè¦†ç›–ï¼š
         - ç”Ÿæˆæ–°MQå»ºè®®ï¼ˆMQ6ã€MQ7...ï¼‰
         - æäº¤Humanå®¡æ ¸
         - å®¡æ ¸é€šè¿‡åè‡ªåŠ¨æ·»åŠ åˆ°config.yaml
      4. å¦‚æœç°æœ‰MQåº”è¯¥æ‹¦æˆªä½†æ²¡æ‹¦ï¼š
         - åˆ†æä¸ºä»€ä¹ˆæ²¡æ‹¦ä½ï¼ˆtriggeræ¡ä»¶ä¸å¤Ÿï¼Ÿevidenceä¸å¤Ÿï¼Ÿï¼‰
         - ä¼˜åŒ–MQçš„triggeræ¡ä»¶æˆ–evidenceè¦æ±‚
         - æ›´æ–°config.yaml
    output_location: ".tad/archive/evidence/failures/[timestamp]_mq_update.yaml"

# ==================== æ¸è¿›å¼éªŒè¯ç³»ç»Ÿ ====================
progressive_validation:
  enabled: true
  description: "å°†å¤§ä»»åŠ¡åˆ†è§£ä¸ºPhaseï¼Œæ¯ä¸ªPhaseåHumanéªŒè¯"

  phase_structure:
    definition: |
      Phaseæ˜¯åŠŸèƒ½çš„é€»è¾‘ç»„æˆéƒ¨åˆ†ï¼Œæ¯ä¸ªPhaseï¼š
      - æœ‰æ˜ç¡®çš„äº¤ä»˜ç‰©ï¼ˆä»£ç ã€æ–‡æ¡£ã€æµ‹è¯•ï¼‰
      - æœ‰ç‹¬ç«‹çš„éªŒè¯æ ‡å‡†
      - å®Œæˆåéœ€è¦Humanå®¡æŸ¥æ‰èƒ½ç»§ç»­

    size_guideline:
      small_task: "1ä¸ªPhaseï¼Œ1-2å°æ—¶å®Œæˆ"
      medium_task: "2-3ä¸ªPhaseï¼Œæ¯ä¸ªPhase 2-3å°æ—¶"
      large_task: "4-6ä¸ªPhaseï¼Œæ¯ä¸ªPhaseä¸è¶…è¿‡4å°æ—¶"

    mandatory_checkpoint: "æ¯ä¸ªPhaseå®Œæˆæ—¶Blakeå¿…é¡»æä¾›è¯æ®ï¼ŒHumanå¿…é¡»å®¡æŸ¥"

  phase_evidence_requirements:
    every_phase_must_provide:
      - code_screenshot: "å…³é”®å‡½æ•°/ç»„ä»¶çš„ä»£ç æˆªå›¾"
      - test_result: "è¯¥Phaseç›¸å…³çš„æµ‹è¯•ç»“æœ"
      - ui_screenshot: "å¦‚æœæœ‰UIå˜åŒ–ï¼Œæä¾›æµè§ˆå™¨æˆªå›¾"
      - progress_notes: "é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ³•"

    human_checkpoint_questions:
      - "è¿™æ˜¯æˆ‘æœŸæœ›çš„æ–¹å‘å—ï¼Ÿ"
      - "æµ‹è¯•é€šè¿‡äº†å—ï¼Ÿï¼ˆçœ‹åˆ°passed/ç»¿è‰²âœ“ï¼‰"
      - "éœ€è¦è°ƒæ•´ä»€ä¹ˆå—ï¼Ÿ"

    continue_criteria: "Humanç¡®è®¤æ–¹å‘æ­£ç¡®"
    adjustment_process: "å¦‚æœéœ€è¦è°ƒæ•´ï¼ŒBlakeä¿®æ”¹æœ¬Phaseåé‡æ–°æäº¤è¯æ®"

  gate_phase_binding:
    description: "å°†Quality Gatesç»‘å®šåˆ°Phase"

    gate2_design_phases:
      phase: "è®¾è®¡é˜¶æ®µå„Phaseï¼ˆå¦‚æœè®¾è®¡åˆ†å¤šä¸ªPhaseï¼‰"
      checkpoint_type: "design_evidence"
      timing: "æ¯å®Œæˆä¸€ä¸ªè®¾è®¡æ¨¡å—"
      human_action: "å®¡æŸ¥è®¾è®¡å›¾è¡¨å’Œè¯æ®"

    gate3_implementation_phases:
      phase: "å®ç°é˜¶æ®µå„Phase"
      checkpoint_type: "implementation_evidence"
      timing: "æ¯å®Œæˆä¸€ä¸ªPhase"
      human_action: "å®¡æŸ¥ä»£ç æˆªå›¾ã€æµ‹è¯•ç»“æœã€UIæ•ˆæœ"
      continue_criteria: "Humanç¡®è®¤æ–¹å‘æ­£ç¡®æ‰èƒ½ç»§ç»­ä¸‹ä¸ªPhase"

# ==================== Humanè§’è‰²å¢å¼º ====================
human_role_v13:
  role_name: "Value Guardian + Checkpoint Validator"

  role_evolution:
    from: "è¢«åŠ¨éªŒæ”¶è€…ï¼ˆåªåœ¨æœ€åéªŒæ”¶ï¼‰"
    to: "ä¸»åŠ¨éªŒè¯è€…ï¼ˆå‚ä¸è®¾è®¡å®¡æŸ¥å’Œæ¸è¿›æ£€æŸ¥ï¼‰+ å­¦ä¹ è€…ï¼ˆæ¯ä¸ªé¡¹ç›®éƒ½åœ¨æˆé•¿ï¼‰"

  responsibilities:
    value_guardian:
      tasks:
        - "å®šä¹‰ä¸šåŠ¡ä»·å€¼å’Œéœ€æ±‚"
        - "éªŒè¯æœ€ç»ˆäº¤ä»˜çš„ä»·å€¼"
        - "åšå…³é”®ä¸šåŠ¡å†³ç­–"
      time_investment: "éœ€æ±‚é˜¶æ®µï¼š30-60åˆ†é’Ÿ"

    checkpoint_validator:
      tasks:
        - "å®¡æŸ¥è®¾è®¡é˜¶æ®µçš„è¯æ®ï¼ˆå›¾è¡¨ã€è¡¨æ ¼ï¼‰"
        - "å®¡æŸ¥å®ç°é˜¶æ®µçš„è¯æ®ï¼ˆæˆªå›¾ã€æµ‹è¯•ç»“æœï¼‰"
        - "ç¡®è®¤æ¯ä¸ªPhaseæ–¹å‘æ­£ç¡®"
      time_investment: "æ¯ä¸ªPhaseï¼š5-15åˆ†é’Ÿ"
      skill_required: "ä¸éœ€è¦æŠ€æœ¯çŸ¥è¯†ï¼Œåªéœ€çœ‹å›¾åˆ¤æ–­"

    learner:
      tasks:
        - "ç†è§£æŠ€æœ¯å†³ç­–çš„æƒè¡¡ï¼ˆDecision Rationaleï¼‰"
        - "æ€è€ƒå‡è®¾åœºæ™¯ï¼ˆWhat-If Scenariosï¼‰"
        - "ä»å¤±è´¥ä¸­å­¦ä¹ ï¼ˆFailure Learning Entryï¼‰"
      time_investment: "æ¯ä¸ªåŠŸèƒ½ï¼š20-30åˆ†é’Ÿï¼ˆå¯é€‰ï¼‰"
      skill_acquired: "æŠ€æœ¯å†³ç­–ç›´è§‰ã€ç³»ç»Ÿæ€§æ€ç»´ã€è´¨é‡æ„è¯†"

  participation_points:
    gate1_requirements:
      when: "éœ€æ±‚ç¡®è®¤å®Œæˆ"
      human_action: "ç¡®è®¤éœ€æ±‚ç†è§£æ­£ç¡®"
      evidence_to_review: "éœ€æ±‚æ–‡æ¡£"
      decision: "æ‰¹å‡†è¿›å…¥è®¾è®¡/è¦æ±‚ä¿®æ”¹"
      time_budget: "0åˆ†é’Ÿï¼ˆåŸæœ‰æµç¨‹ï¼‰"

    gate2_design:
      when: "è®¾è®¡å®Œæˆï¼Œåˆ›å»ºhandoffå‰"
      human_action: "å®¡æŸ¥è®¾è®¡è¯æ®"
      evidence_to_review:
        - "å¼ºåˆ¶é—®é¢˜ï¼ˆMQ1-5ï¼‰çš„å›ç­”+è¯æ®"
        - "æ•°æ®æµå›¾å’Œå¯¹ç…§è¡¨"
        - "çŠ¶æ€æµå›¾"
        - "å‡½æ•°ä½ç½®è¯æ˜è¡¨"
      questions_to_answer:
        - "è¯æ®å®Œæ•´å—ï¼Ÿæœ‰æ²¡æœ‰ç©ºç€çš„ï¼Ÿ"
        - "æ•°æ®æµå›¾æ˜¾ç¤ºåç«¯å­—æ®µéƒ½ä¼ åˆ°å‰ç«¯äº†å—ï¼Ÿ"
        - "çŠ¶æ€æµå›¾æ˜¾ç¤ºæ•°æ®åªå­˜ä¸€ä¸ªåœ°æ–¹ï¼Œæˆ–åŒæ­¥æœºåˆ¶æ¸…æ™°å—ï¼Ÿ"
        - "æ–¹å‘çœ‹èµ·æ¥æ­£ç¡®å—ï¼Ÿ"
      decision: "é€šè¿‡â†’ç»§ç»­ / ä¸é€šè¿‡â†’Alexè¡¥å……è¯æ®"
      time_budget: "10-15åˆ†é’Ÿ"

    phase_checkpoints:
      when: "Blakeå®Œæˆæ¯ä¸ªPhase"
      human_action: "å¿«é€Ÿå®¡æŸ¥Phaseäº¤ä»˜ç‰©"
      evidence_to_review:
        - "ä»£ç æˆªå›¾ï¼ˆå…³é”®å‡½æ•°ï¼‰"
        - "æµ‹è¯•ç»“æœæˆªå›¾"
        - "UIæˆªå›¾ï¼ˆå¦‚æœæœ‰UIï¼‰"
      questions_to_answer:
        - "è¿™æ˜¯æˆ‘æœŸæœ›çš„æ–¹å‘å—ï¼Ÿ"
        - "æµ‹è¯•é€šè¿‡äº†å—ï¼Ÿ"
        - "UIæ˜¾ç¤ºæ­£ç¡®å—ï¼Ÿ"
      decision: "ç»§ç»­â†’ä¸‹ä¸ªPhase / è°ƒæ•´â†’ä¿®æ”¹æœ¬Phase"
      time_budget: "5-10åˆ†é’Ÿ/Phase"

    gate3_implementation:
      when: "æ‰€æœ‰Phaseå®Œæˆ"
      human_action: "æœ€ç»ˆéªŒè¯"
      evidence_to_review:
        - "å®Œæ•´çš„æµ‹è¯•æŠ¥å‘Š"
        - "å®Œæ•´çš„UIæˆªå›¾"
        - "æ€§èƒ½æµ‹è¯•ç»“æœï¼ˆå¦‚éœ€è¦ï¼‰"
      decision: "é€šè¿‡â†’äº¤ä»˜ / é—®é¢˜â†’ä¿®å¤"
      time_budget: "10-15åˆ†é’Ÿ"

  total_time_investment:
    per_feature:
      gate2: "10-15åˆ†é’Ÿ"
      phase_checkpoints: "5-10åˆ†é’Ÿ Ã— Phaseæ•°é‡"
      gate3: "10-15åˆ†é’Ÿ"
      learning_optional: "20-30åˆ†é’Ÿ"
      total_example: "å°åŠŸèƒ½çº¦30åˆ†é’Ÿï¼Œä¸­åŠŸèƒ½çº¦60åˆ†é’Ÿï¼Œå¤§åŠŸèƒ½çº¦90åˆ†é’Ÿ"

    value_proposition: |
      æŠ•å…¥30-60åˆ†é’Ÿçš„å®¡æŸ¥+å­¦ä¹ ï¼Œå¯ä»¥ï¼š
      - æå‰å‘ç°æ–¹å‘é”™è¯¯ï¼ˆèŠ‚çœ3-6å°æ—¶è¿”å·¥ï¼‰
      - å‡å°‘æœ€åé˜¶æ®µçš„å¤§é‡ä¿®æ”¹
      - ç¡®ä¿å®ç°ç¬¦åˆçœŸæ­£æ„å›¾ï¼Œä¸æ˜¯å­—é¢æ„æ€
      - å»ºç«‹æŠ€æœ¯å†³ç­–ç›´è§‰ï¼Œé•¿æœŸå—ç›Š

# ==================== å­¦ä¹ æœºåˆ¶ç³»ç»Ÿ ====================
learning_mechanisms:
  enabled: true
  description: "TADä¸ä»…å¸®åŠ©Humanæ‰§è¡Œé¡¹ç›®ï¼Œæ›´å¸®åŠ©Humanå»ºç«‹ç³»ç»Ÿæ€§æ€ç»´å’Œå†³ç­–ç›´è§‰"

  philosophy: |
    ä¼ ç»ŸåŸ¹è®­ï¼šè¯»ä¹¦ â†’ ç†è§£æ¦‚å¿µ â†’ åº”ç”¨ï¼ˆæ–­å±‚ï¼‰
    TADå­¦ä¹ ï¼šçœŸå®å†³ç­– â†’ çœ‹åˆ°åæœ â†’ å»ºç«‹ç›´è§‰ â†’ è‡ªç„¶åº”ç”¨

  learning_dimensions:
    dimension1_technical_tradeoffs:
      name: "æŠ€æœ¯å†³ç­–æƒè¡¡æ€ç»´"
      goal: "å»ºç«‹'æ²¡æœ‰å®Œç¾æ–¹æ¡ˆï¼Œåªæœ‰æƒè¡¡'çš„æ€ç»´"
      levels:
        - "Level 1: çŸ¥é“æœ‰å¤šä¸ªæ–¹æ¡ˆå¯é€‰"
        - "Level 2: ç†è§£æ¯ä¸ªæ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹"
        - "Level 3: èƒ½åˆ¤æ–­åœ¨å½“å‰åœºæ™¯ä¸‹å“ªä¸ªæ›´åˆé€‚"
        - "Level 4: èƒ½é¢„è§æœªæ¥åœºæ™¯å˜åŒ–æ—¶éœ€è¦åˆ‡æ¢æ–¹æ¡ˆ"
      mechanisms: ["Decision Rationale", "Interactive Challenge"]

    dimension2_systemic_thinking:
      name: "ç³»ç»Ÿæ€§æ€ç»´"
      goal: "çœ‹åˆ°'å±€éƒ¨æ”¹åŠ¨'å¦‚ä½•å½±å“'æ•´ä¸ªç³»ç»Ÿ'"
      levels:
        - "Level 1: çŸ¥é“'æ”¹Aä¼šå½±å“B'"
        - "Level 2: èƒ½ç”»å‡ºå½±å“é“¾è·¯ï¼ˆA â†’ B â†’ Cï¼‰"
        - "Level 3: èƒ½é¢„è§ç¬¬äºŒå±‚å½±å“"
        - "Level 4: èƒ½è®¾è®¡'æ”¹Aä½†ä¸å½±å“B'çš„éš”ç¦»æœºåˆ¶"
      mechanisms: ["Impact Visualization", "What-If Scenarios"]

    dimension3_product_ux:
      name: "äº§å“/UXç›´è§‰"
      goal: "ç†è§£'ç”¨æˆ·çœ‹åˆ°ä»€ä¹ˆ'å’Œ'ç”¨æˆ·æ„Ÿå—åˆ°ä»€ä¹ˆ'"
      levels:
        - "Level 1: çŸ¥é“UIè¦å¥½çœ‹"
        - "Level 2: ç†è§£ä¸åŒè§†è§‰è®¾è®¡ä¼ è¾¾ä¸åŒä¿¡æ¯"
        - "Level 3: èƒ½åˆ¤æ–­å“ªä¸ªè®¾è®¡æ›´ç¬¦åˆç”¨æˆ·ä»»åŠ¡"
        - "Level 4: èƒ½ä»ç”¨æˆ·è¡Œä¸ºæ•°æ®æ¨æ–­UIé—®é¢˜"
      mechanisms: ["What-If Scenarios", "Decision Rationale"]

    dimension4_quality_awareness:
      name: "è´¨é‡æ„è¯†å’Œé£é™©é¢„è§"
      goal: "ç†è§£'ä»€ä¹ˆåœ°æ–¹å®¹æ˜“å‡ºé”™'å’Œ'å¦‚ä½•æå‰é˜²å¾¡'"
      levels:
        - "Level 1: çŸ¥é“è¦æµ‹è¯•"
        - "Level 2: çŸ¥é“æµ‹è¯•ä»€ä¹ˆï¼ˆè¾¹ç•Œæƒ…å†µã€é”™è¯¯è·¯å¾„ï¼‰"
        - "Level 3: èƒ½é¢„è§'æ”¹è¿™é‡Œå¯èƒ½å½±å“é‚£é‡Œ'"
        - "Level 4: èƒ½è®¾è®¡'é˜²å¾¡æ€§æ¶æ„'ï¼ˆå‡ºé”™äº†ä¹Ÿä¸ä¼šé›ªå´©ï¼‰"
      mechanisms: ["Failure Learning Entry", "What-If Scenarios"]

  mechanisms:
    mechanism1_decision_rationale:
      name: "Decision Rationaleï¼ˆå†³ç­–ç†ç”±ï¼‰"
      goal: "ç†è§£ä¸ºä»€ä¹ˆé€‰Aä¸é€‰Bï¼Œå»ºç«‹æƒè¡¡æ€ç»´"
      timing: "æ¯ä¸ªé‡è¦æŠ€æœ¯å†³ç­–"
      format: "å¯¹æ¯”è¡¨æ ¼ + æƒè¡¡åˆ†æ + æœªæ¥åˆ‡æ¢æ¡ä»¶"
      time_cost: "+5åˆ†é’Ÿ"
      learning_dimensions: ["æŠ€æœ¯å†³ç­–", "ç³»ç»Ÿæ€ç»´"]

    mechanism2_interactive_challenge:
      name: "Interactive Challengeï¼ˆäº’åŠ¨æŒ‘æˆ˜ï¼‰"
      goal: "è®©Humanä¸»åŠ¨æ€è€ƒï¼Œè€Œéè¢«åŠ¨æ¥å—ç­”æ¡ˆ"
      timing: "å…³é”®å†³ç­–ç‚¹ï¼Œåœ¨Alexç»™å‡ºæ–¹æ¡ˆä¹‹å‰"
      format: "åœºæ™¯æè¿° + å¤‡é€‰æ–¹æ¡ˆ + æ€è€ƒé—®é¢˜ â†’ Alexåˆ†æ"
      time_cost: "+3åˆ†é’Ÿ"
      learning_dimensions: ["æ‰€æœ‰ç»´åº¦"]

    mechanism3_impact_visualization:
      name: "Impact Visualizationï¼ˆå½±å“å¯è§†åŒ–ï¼‰"
      goal: "çœ‹åˆ°æ”¹åŠ¨çš„è¿é”ååº”"
      timing: "æ¶æ„è®¾è®¡æˆ–æ•°æ®æµå˜æ›´"
      format: "å½±å“é“¾è·¯å›¾ï¼ˆMermaidï¼‰+ å½±å“æ¸…å•ï¼ˆ3å±‚ï¼‰"
      time_cost: "+2åˆ†é’Ÿ"
      learning_dimensions: ["ç³»ç»Ÿæ€ç»´"]

    mechanism4_what_if_scenarios:
      name: "What-If Scenariosï¼ˆå‡è®¾åœºæ™¯ï¼‰"
      goal: "é€šè¿‡å¯¹æ¯”ç†è§£ä¸ºä»€ä¹ˆè¿™æ ·åš"
      timing: "æ¯ä¸ªPhaseå®Œæˆ"
      format: "å®é™…æ–¹æ¡ˆ vs æ›¿ä»£æ–¹æ¡ˆçš„æ•ˆæœå¯¹æ¯”"
      time_cost: "+3åˆ†é’Ÿ"
      learning_dimensions: ["æ‰€æœ‰ç»´åº¦"]

    mechanism5_failure_learning:
      name: "Failure Learning Entryï¼ˆå¤±è´¥å­¦ä¹ ï¼‰"
      goal: "æ¯æ¬¡å‡ºé”™éƒ½æ˜¯å­¦ä¹ æœºä¼šï¼Œé¿å…é‡å¤çŠ¯é”™"
      timing: "Humanå‘ç°é—®é¢˜ã€æµ‹è¯•å¤±è´¥ã€ç”¨æˆ·æŠ¥å‘ŠBug"
      format: "æ ¹å› åˆ†æ + æç‚¼åŸåˆ™ + æ›´æ–°æ£€æŸ¥ç‚¹"
      time_cost: "+10åˆ†é’Ÿï¼ˆä½†é¿å…æœªæ¥é‡å¤ï¼‰"
      learning_dimensions: ["è´¨é‡æ„è¯†"]

  learning_metrics:
    short_term:
      participation_rate:
        gate2_review_completion: ">90%"
        interactive_challenge_response: ">80%"

      understanding:
        decision_rationale_understanding: "èƒ½è¯´å‡º2+ä¸ªæƒè¡¡ç»´åº¦"
        gate2_issue_detection: "æ¯ä¸ªåŠŸèƒ½è‡³å°‘å‘ç°1ä¸ªé—®é¢˜"

    mid_term:
      knowledge_reuse:
        checklist_application: "ä¸»åŠ¨ä½¿ç”¨ä¸Šä¸ªé¡¹ç›®çš„æ£€æŸ¥æ¸…å•"
        principle_recall: "èƒ½ä¸¾ä¾‹ä¹‹å‰å­¦åˆ°çš„åŸåˆ™"

      independent_judgment:
        level: "Humanå¼€å§‹åœ¨Alexæå‡ºå‰å°±æœ‰åˆ¤æ–­"

    long_term:
      systemic_thinking:
        impact_chain_length: "èƒ½é¢„è§1å±‚/2å±‚/3å±‚å½±å“"
        failure_pattern_recognition: "èƒ½è¯†åˆ«3+ç§å¤±è´¥æ¨¡å¼"

      quality_awareness:
        edge_case_consideration: "ä¸»åŠ¨æå‡ºè¾¹ç•Œæƒ…å†µ"

  learning_loop_completion:
    signal: |
      é¡¹ç›®1 â†’ å­¦åˆ°"å•ä¸€æ•°æ®æºåŸåˆ™" â†’ æ›´æ–°MQ5
             â†“
      é¡¹ç›®2 â†’ Humanä¸»åŠ¨é—®"æ•°æ®å­˜å‡ ä¸ªåœ°æ–¹ï¼Ÿ"
             â†’ è®¾è®¡æ—¶å°±é¿å…äº†é—®é¢˜ âœ…

# ==================== Sub-Agentå¼ºåˆ¶ä½¿ç”¨ ====================
subagent_enforcement_v13:
  enabled: true
  description: "ä»å»ºè®®å˜æˆå¼ºåˆ¶ï¼Œå¸¦è¯æ®éªŒè¯"

  agent_a_mandatory:
    product_expert:
      when: "éœ€æ±‚åˆ†æé˜¶æ®µï¼ˆRound 1åï¼‰"
      must_call: true
      evidence_required: "åœ¨éœ€æ±‚æ–‡æ¡£ä¸­åŒ…å«product-expertçš„åˆ†æç»“æœ"
      evidence_format: "ç”¨æˆ·ç”»åƒã€ç”¨ä¾‹åˆ†æã€ä¸šåŠ¡ä»·å€¼è¯„ä¼°"
      violation_action: "é˜»æ­¢è¿›å…¥è®¾è®¡é˜¶æ®µ"

    backend_architect:
      when: "è®¾è®¡ç³»ç»Ÿæ¶æ„ï¼ˆæ¶‰åŠAPI/æ•°æ®åº“/å¾®æœåŠ¡ç­‰ï¼‰"
      must_call: true
      evidence_required: "åœ¨è®¾è®¡æ–‡æ¡£ä¸­åŒ…å«backend-architectçš„å»ºè®®"
      evidence_format: "æ¶æ„å›¾ã€æŠ€æœ¯é€‰å‹ã€æ‰©å±•æ€§åˆ†æ"
      violation_action: "é˜»æ­¢åˆ›å»ºhandoff"

    code_reviewer:
      when: "å®¡æŸ¥Blakeçš„å®ç°"
      must_call: true
      evidence_required: "åœ¨å®¡æŸ¥æŠ¥å‘Šä¸­åŒ…å«code-reviewerçš„å‘ç°"
      evidence_format: "ä»£ç è´¨é‡è¯„åˆ†ã€é—®é¢˜åˆ—è¡¨ã€æ”¹è¿›å»ºè®®"
      violation_action: "é˜»æ­¢æ ‡è®°ä¸ºå®Œæˆ"

  agent_b_mandatory:
    parallel_coordinator:
      when: "ä»»åŠ¡åŒ…å«3ä¸ªä»¥ä¸Šç‹¬ç«‹ç»„ä»¶"
      must_call: true
      detection: "è‡ªåŠ¨æ£€æµ‹handoffä¸­çš„Phaseæ•°é‡â‰¥3"
      evidence_required: "åœ¨å®ŒæˆæŠ¥å‘Šä¸­è¯´æ˜å¦‚ä½•ä½¿ç”¨parallel-coordinator"
      evidence_format: "ä»»åŠ¡åˆ†è§£ã€å¹¶è¡Œæ‰§è¡Œè®¡åˆ’ã€åè°ƒæœºåˆ¶"
      violation_action: "è­¦å‘Šå¹¶è¦æ±‚è¯´æ˜ä¸ºä»€ä¹ˆä¸ç”¨"

    bug_hunter:
      when: "å‡ºç°é”™è¯¯æˆ–æµ‹è¯•å¤±è´¥"
      must_call: true
      detection: "è‡ªåŠ¨æ£€æµ‹é”™è¯¯æ—¥å¿—æˆ–æµ‹è¯•å¤±è´¥"
      evidence_required: "åœ¨ä¿®å¤æŠ¥å‘Šä¸­åŒ…å«bug-hunterçš„è¯Šæ–­"
      evidence_format: "æ ¹å› åˆ†æã€ä¿®å¤æ–¹æ¡ˆã€é¢„é˜²æªæ–½"
      violation_action: "é˜»æ­¢æ ‡è®°ä¸ºä¿®å¤å®Œæˆ"

    test_runner:
      when: "å®Œæˆå®ç°"
      must_call: true
      detection: "Phaseå®Œæˆæ—¶"
      evidence_required: "æµ‹è¯•ç»“æœæˆªå›¾æˆ–æŠ¥å‘Š"
      evidence_format: "æµ‹è¯•é€šè¿‡ç‡ã€è¦†ç›–ç‡ã€å¤±è´¥case"
      violation_action: "é˜»æ­¢è¿›å…¥ä¸‹ä¸ªPhase"

  evidence_format:
    subagent_usage_log: |
      ## Sub-Agentä½¿ç”¨è®°å½•

      | Sub-Agent | æ˜¯å¦è°ƒç”¨ | è°ƒç”¨æ—¶æœº | è¾“å‡ºæ‘˜è¦ | è¯æ®é“¾æ¥ |
      |-----------|---------|---------|---------|---------|
      | product-expert | âœ… | Round 1å | è¯†åˆ«äº†3ä¸ªå…³é”®ç”¨ä¾‹ | [é“¾æ¥åˆ°åˆ†ææ–‡æ¡£] |
      | backend-architect | âœ… | è®¾è®¡é˜¶æ®µ | å»ºè®®ä½¿ç”¨Two-phaseæ¶æ„ | [é“¾æ¥åˆ°æ¶æ„å›¾] |
      | parallel-coordinator | âŒ | N/A | ä»»åŠ¡åªæœ‰2ä¸ªç»„ä»¶ï¼Œä¸éœ€è¦ | N/A |

  human_verification:
    what_to_check: "Sub-Agentä½¿ç”¨è®°å½•è¡¨æ˜¯å¦å®Œæ•´"
    red_flags:
      - "åº”è¯¥è°ƒç”¨ä½†æ ‡è®°ä¸º'âŒ'ä¸”æ— åˆç†åŸå› "
      - "è°ƒç”¨äº†ä½†'è¾“å‡ºæ‘˜è¦'ä¸ºç©º"
      - "'è¯æ®é“¾æ¥'éƒ½æ˜¯N/A"

# ==================== æ—¶é—´ä¼°ç®—æ”¹è¿› ====================
time_estimation_v13:
  principle: "ä¼°ç®—å®ç°æ—¶é—´ Ã— 2 = å®é™…é¢„ç®—æ—¶é—´"
  reason: "è€ƒè™‘å®¡æŸ¥ã€è¿­ä»£ã€æ„å¤–é—®é¢˜ã€æ–‡æ¡£"

  buffer_allocation:
    implementation: 0.40  # çº¯ç¼–ç æ—¶é—´
    review_iteration: 0.30  # Humanå®¡æŸ¥å’Œè¿”å·¥
    unexpected_issues: 0.20  # æ„å¤–é—®é¢˜å¤„ç†
    documentation: 0.10  # æ–‡æ¡£å’ŒæŠ¥å‘Š

  checkpoint_timing:
    rule: "åœ¨50%ä¼°ç®—æ—¶é—´æ—¶ï¼Œå¼ºåˆ¶Humanå®¡æŸ¥"
    purpose: "åŠæ—©å‘ç°æ–¹å‘åå·®ï¼Œé¿å…å…¨éƒ¨è¿”å·¥"
    example: |
      ä¼°ç®—ï¼š8å°æ—¶
      å®é™…é¢„ç®—ï¼š16å°æ—¶
      å¼ºåˆ¶æ£€æŸ¥ç‚¹ï¼š4å°æ—¶å’Œ12å°æ—¶

      åœ¨4å°æ—¶æ—¶ï¼š
      - Blakeå±•ç¤ºå·²å®Œæˆçš„éƒ¨åˆ†
      - Humanç¡®è®¤æ–¹å‘æ­£ç¡®
      - å¦‚æœæ–¹å‘é”™è¯¯ï¼Œåªæµªè´¹äº†4å°æ—¶ï¼Œä¸æ˜¯16å°æ—¶

  tracking:
    record:
      - estimated_time: "ä¼°ç®—æ—¶é—´"
      - actual_time: "å®é™…èŠ±è´¹"
      - deviation_reason: "åå·®åŸå› åˆ†ç±»"
    improve:
      - "åˆ†æåå·®åŸå› "
      - "è°ƒæ•´æœªæ¥ä¼°ç®—ç³»æ•°"
      - "è¯†åˆ«å¸¸è§å»¶è¯¯å› ç´ "

# ==================== å¤±è´¥å­¦ä¹ é—­ç¯ ====================
failure_learning_loop:
  enabled: true
  description: "æ¯æ¬¡å¤±è´¥è‡ªåŠ¨è½¬åŒ–ä¸ºæœªæ¥çš„æ£€æŸ¥ç‚¹"

  trigger: "Humançº æ­£AIé”™è¯¯ï¼Œæˆ–å‘ç°Bugï¼Œæˆ–æµ‹è¯•å¤±è´¥"

  pipeline_steps:
    step1_capture:
      trigger: "Humanè¯´'ä¸å¯¹'ã€'é”™äº†'ã€'è¿™ä¸ªæœ‰é—®é¢˜'"
      action: "åˆ›å»ºFailure Learning Entry"
      data_to_capture:
        - error_type: "æŠ€æœ¯é—®é¢˜ç±»å‹"
        - root_cause: "ä¸ºä»€ä¹ˆå‘ç”Ÿ"
        - should_be_caught_by: "åº”è¯¥ç”±å“ªä¸ªGate/MQæ‹¦æˆª"
        - actual_outcome: "å®é™…ä¸Šæ”¾è¡Œäº†"
        - user_impact: "ç»™ç”¨æˆ·é€ æˆçš„å½±å“"
      output_file: ".tad/archive/evidence/failures/[timestamp]_failure.yaml"

    step2_analyze:
      action: "åˆ†æåº”è¯¥å¢åŠ ä»€ä¹ˆæ£€æŸ¥ç‚¹"
      analysis_questions:
        - "è¿™ä¸ªé—®é¢˜å±äºå“ªä¸ªé˜¶æ®µï¼Ÿï¼ˆéœ€æ±‚/è®¾è®¡/å®ç°ï¼‰"
        - "ç°æœ‰çš„MQèƒ½æ‹¦æˆªå—ï¼Ÿå¦‚æœä¸èƒ½ï¼Œä¸ºä»€ä¹ˆï¼Ÿ"
        - "éœ€è¦ä»€ä¹ˆè¯æ®æ‰èƒ½æå‰å‘ç°ï¼Ÿ"
        - "Humanéœ€è¦çœ‹ä»€ä¹ˆæ‰èƒ½åˆ¤æ–­ï¼Ÿ"
      output_file: ".tad/archive/evidence/failures/[timestamp]_analysis.yaml"

    step3_propose:
      action: "ç”Ÿæˆé…ç½®æ›´æ–°å»ºè®®"
      proposal_content:
        new_mq:
          id: "MQ[X]"
          question: "[ç”Ÿæˆçš„é—®é¢˜]"
          required_evidence: "[è¯æ®ç±»å‹]"
          human_validation_point: "[Humançœ‹ä»€ä¹ˆ]"
        or_mq_update:
          existing_mq: "MQ[Y]"
          enhancement: "[å¦‚ä½•å¢å¼º]"
          new_trigger: "[æ›´å‡†ç¡®çš„è§¦å‘æ¡ä»¶]"
      output_file: ".tad/archive/evidence/failures/[timestamp]_proposal.yaml"

    step4_review:
      action: "Humanå®¡æ ¸ææ¡ˆ"
      human_questions:
        - "è¿™ä¸ªæ–°æ£€æŸ¥ç‚¹åˆç†å—ï¼Ÿ"
        - "ä¼šä¸ä¼šäº§ç”Ÿå¤ªå¤šè¯¯æŠ¥ï¼Ÿ"
        - "æˆ‘èƒ½çœ‹æ‡‚è¿™ä¸ªè¯æ®å—ï¼Ÿ"
      decision:
        approve: "è‡ªåŠ¨æ›´æ–°config.yaml"
        reject: "è®°å½•åŸå› ï¼Œä¸æ›´æ–°"
        modify: "Humanä¿®æ”¹åæ›´æ–°"

    step5_implement:
      action: "è‡ªåŠ¨æ›´æ–°é…ç½®æ–‡ä»¶"
      files_to_update:
        - ".tad/config.yaml"  # æ·»åŠ /æ›´æ–°MQ
        - ".tad/templates/handoff-a-to-b.md"  # æ›´æ–°æ¨¡æ¿
        - ".tad/archive/evidence/patterns/failure-patterns.md"  # æ›´æ–°è®°å½•
      notification: "é…ç½®å·²è‡ªåŠ¨æ›´æ–°ï¼Œä¸‹ä¸ªé¡¹ç›®ç”Ÿæ•ˆ"
      changelog: "è®°å½•åœ¨.tad/CHANGELOG.md"

  metrics_tracking:
    track:
      - "failure_count": "æ€»å¤±è´¥æ¬¡æ•°"
      - "failures_prevented": "æ–°MQæ‹¦æˆªçš„å¤±è´¥"
      - "false_positive_rate": "è¯¯æŠ¥ç‡"
      - "mq_effectiveness": "æ¯ä¸ªMQçš„æœ‰æ•ˆæ€§"
    report_location: ".tad/archive/evidence/metrics/learning-effectiveness.md"

# ==================== é…ç½®ç”Ÿæ•ˆæ—¶é—´ ====================
rollout_plan:
  phase1_immediate:
    description: "å¯ä»¥ç«‹å³å¯ç”¨çš„å¢å¼º"
    items:
      - "mandatory_questions"
      - "evidence_based_verification"
      - "human_role_v13"
    risk: "ä½"
    time: "1-2å¤©"

  phase2_gradual:
    description: "éœ€è¦é€æ­¥æ¨è¿›çš„å¢å¼º"
    items:
      - "progressive_validation"
      - "learning_mechanisms"
      - "subagent_enforcement_v13"
    risk: "ä¸­"
    time: "1-2å‘¨"

  phase3_advanced:
    description: "éœ€è¦å·¥å…·æ”¯æŒçš„å¢å¼º"
    items:
      - "failure_learning_loop"
      - "time_estimation_v13"
    risk: "ä½ï¼ˆå¯é€‰ï¼‰"
    time: "1ä¸ªæœˆ"

# ==================== ç‰ˆæœ¬æ§åˆ¶ ====================
version_history:
  v2.0.0:
    date: "2026-01-26"
    changes:
      - "æ–°å¢ Ralph Loop è‡ªåŠ¨åŒ–è´¨é‡å¾ªç¯ï¼ˆBlake æ‰§è¡Œé˜¶æ®µï¼‰"
      - "æ–°å¢ Layer 1 è‡ªæ£€ï¼ˆbuild/test/lint/tscï¼‰"
      - "æ–°å¢ Layer 2 ä¸“å®¶å®¡æ ¸ï¼ˆcode-reviewer, test-runner, security-auditor, performance-optimizerï¼‰"
      - "æ–°å¢æ–­è·¯å™¨æœºåˆ¶ï¼ˆè¿ç»­ç›¸åŒé”™è¯¯è§¦å‘äººå·¥ä»‹å…¥ï¼‰"
      - "æ–°å¢çŠ¶æ€æŒä¹…åŒ–ï¼ˆæ”¯æŒå´©æºƒæ¢å¤ï¼‰"
      - "æ–°å¢ä¼˜å…ˆçº§ç»„æ‰§è¡Œï¼ˆcode-reviewer å…ˆè¡Œï¼Œå…¶ä»–å¹¶è¡Œï¼‰"
      - "Gate 3 æ‰©å±•ä¸ºåŒ…å«æ‰€æœ‰æŠ€æœ¯è´¨é‡æ£€æŸ¥"
      - "Gate 4 ç®€åŒ–ä¸ºçº¯ä¸šåŠ¡éªŒæ”¶ + å½’æ¡£"
      - "æ–°å¢ Gate èŒè´£çŸ©é˜µï¼ˆæ¸…æ™°åˆ’åˆ†æŠ€æœ¯/ä¸šåŠ¡æ£€æŸ¥ï¼‰"
      - "æ–°å¢ .tad/ralph-config/ é…ç½®ç›®å½•"
      - "æ–°å¢ .tad/schemas/ JSON Schema éªŒè¯"
    based_on: "Ralph Wiggum å¾ªç¯æŠ€æœ¯ + ä¸“å®¶å®¡æŸ¥åé¦ˆæ•´åˆ"
    compatibility: "100%å‘åå…¼å®¹v1.8ï¼Œå¯é€‰æ‹©æ€§å¯ç”¨Ralph Loop"
    breaking_changes: "æ— "

  v1.8.0:
    date: "2026-01-23"
    changes:
      - "æ–°å¢è‹æ ¼æ‹‰åº•å¼æé—®åè®®ï¼ˆSocratic Inquiry Protocolï¼‰"
      - "Alex å†™ handoff å‰å¿…é¡»ç”¨ AskUserQuestion å·¥å…·è¿›è¡Œè‹æ ¼æ‹‰åº•å¼æé—®"
      - "åŸºäºä»»åŠ¡å¤æ‚åº¦è‡ªåŠ¨è°ƒæ•´é—®é¢˜æ•°é‡ï¼ˆsmall: 2-3, medium: 4-5, large: 6-8ï¼‰"
      - "6 ä¸ªé—®é¢˜ç»´åº¦ï¼šä»·å€¼éªŒè¯ã€è¾¹ç•Œæ¾„æ¸…ã€é£é™©é¢„è§ã€éªŒæ”¶æ ‡å‡†ã€ç”¨æˆ·åœºæ™¯ã€æŠ€æœ¯çº¦æŸ"
      - "Inquiry Summary å¿…é¡»åŒ…å«åœ¨ handoff æ–‡æ¡£ä¸­"
    based_on: "ç”¨æˆ·åé¦ˆï¼šéœ€è¦æ›´ä¸»åŠ¨çš„éœ€æ±‚æŒ–æ˜ï¼Œå¸®åŠ©ç”¨æˆ·å‘ç°ç›²ç‚¹"
    compatibility: "100%å‘åå…¼å®¹v1.7"

  v1.4.0:
    date: "2026-01-06"
    changes:
      - "æ–°å¢ MQ6 å¼ºåˆ¶æŠ€æœ¯æœç´¢ï¼ˆæ‰€æœ‰æŠ€æœ¯å†³ç­–è§¦å‘æœç´¢ï¼‰"
      - "æ–°å¢ Research Phaseï¼ˆè¿‡ç¨‹ä¸­æŒ‰éœ€æœç´¢ + æœ€ç»ˆæŠ€æœ¯å›é¡¾ï¼‰"
      - "æ–°å¢ Skills çŸ¥è¯†åº“ç³»ç»Ÿï¼ˆ.claude/skills/ è‡ªåŠ¨å‘ç°ï¼‰"
      - "æ–°å¢ Learn è®°å¿†ç³»ç»Ÿï¼ˆæ¡†æ¶çº§å»ºè®®è®°å½• + æ¨é€åˆ° TAD ä»“åº“ï¼‰"
      - "æ–°å¢ /tad-learn å‘½ä»¤"
      - "å†…ç½® ui-design.md å’Œ skill-creator.md Skills"
    based_on: "ç”¨æˆ·ç—›ç‚¹åˆ†æï¼šæŠ€æœ¯é€‰å‹è¢«åŠ¨ã€çŸ¥è¯†ä¸æ›´æ–°ã€Agent ä¸æˆé•¿"
    compatibility: "100%å‘åå…¼å®¹v1.3"

  v1.3.0:
    date: "2025-11-25"
    changes:
      - "æ–°å¢è¯æ®å¼éªŒè¯ç³»ç»Ÿï¼ˆ5ç§è¯æ®ç±»å‹ï¼‰"
      - "æ–°å¢å¼ºåˆ¶é—®é¢˜ç³»ç»Ÿï¼ˆMQ1-5ï¼‰"
      - "æ–°å¢æ¸è¿›å¼éªŒè¯ï¼ˆPhaseæ£€æŸ¥ç‚¹ï¼‰"
      - "æ–°å¢Humanè§’è‰²å¢å¼ºï¼ˆCheckpoint Validatorï¼‰"
      - "æ–°å¢å­¦ä¹ æœºåˆ¶ç³»ç»Ÿï¼ˆ5ç§æœºåˆ¶ï¼‰"
      - "æ–°å¢å¤±è´¥å­¦ä¹ é—­ç¯"
    based_on: "MenuSnapé¡¹ç›®å®è¯åˆ†æ + ä¸‰ä»½æ ¸å¿ƒæ–‡æ¡£"
    compatibility: "100%å‘åå…¼å®¹v1.2"

  v1.2:
    date: "2024-XX-XX"
    description: "åŸºç¡€TADæ–¹æ³•è®º"

# ==================== å…¼å®¹æ€§è¯´æ˜ ====================
backward_compatibility:
  v12_projects:
    compatibility: "100%å…¼å®¹"
    explanation: "v1.3æ˜¯å¢é‡æ›´æ–°ï¼Œä¸ç ´åv1.2çš„ä»»ä½•åŠŸèƒ½"
    migration: "å¯ä»¥é€‰æ‹©æ€§å¯ç”¨v1.3ç‰¹æ€§"

  rollback_support:
    enabled: true
    method: "æ¢å¤å¤‡ä»½çš„.tad/config.yaml.v1.2"
    data_preservation: "v1.3åˆ›å»ºçš„è¯æ®æ–‡æ¡£ä¿ç•™ï¼Œä¸å½±å“å›æ»š"


# ==================== Template Trigger System (v1.0) ====================
template_triggers:
  version: "1.0"
  enabled: true
  description: "æ¨¡æ¿è§¦å‘å’Œå­˜å‚¨ç³»ç»Ÿ - ç¡®ä¿ subagent è¾“å‡ºæ ¼å¼ä¸€è‡´å¹¶ç•™å­˜è¯æ®"

  storage:
    base_path: ".tad/evidence/reviews/"
    naming: "{date}-{type}-{brief}.md"
    date_format: "YYYY-MM-DD"

  # MANDATORY: Subagent å¿…é¡»è¾“å‡ºï¼ŒGate æ£€æŸ¥æ–‡ä»¶å­˜åœ¨
  mandatory:
    gate_3:
      subagent: test-runner
      template: testing-review-format
      template_path: ".tad/templates/output-formats/testing-review-format.md"
      evidence_path: ".tad/evidence/reviews/{date}-testing-review-{task}.md"
      blocking: true
      description: "Gate 3 é€šè¿‡å‰å¿…é¡»æœ‰æµ‹è¯•å®¡æŸ¥è¯æ®"

    gate_4:
      subagents:
        - subagent: security-auditor
          template: security-review-format
          template_path: ".tad/templates/output-formats/security-review-format.md"
          evidence_path: ".tad/evidence/reviews/{date}-security-review-{task}.md"
        - subagent: performance-optimizer
          template: performance-review-format
          template_path: ".tad/templates/output-formats/performance-review-format.md"
          evidence_path: ".tad/evidence/reviews/{date}-performance-review-{task}.md"
      blocking: true
      description: "Gate 4 é€šè¿‡å‰å¿…é¡»æœ‰å®‰å…¨å’Œæ€§èƒ½å®¡æŸ¥è¯æ®"

  # RECOMMENDED: Subagent åº”è¯¥è¾“å‡ºï¼Œä½†ä¸é˜»å¡
  recommended:
    code_review:
      subagent: code-reviewer
      templates:
        - git-workflow-format
        - refactoring-review-format
      trigger: "*review å‘½ä»¤"
      blocking: false
      description: "ä»£ç å®¡æŸ¥æ—¶æ¨èä½¿ç”¨çš„æ¨¡æ¿"

    refactoring:
      subagent: refactor-specialist
      template: refactoring-review-format
      trigger: "é‡æ„ä»»åŠ¡"
      blocking: false
      description: "é‡æ„ä»»åŠ¡æ—¶æ¨èä½¿ç”¨çš„æ¨¡æ¿"

  # SELF-USE: Agent è‡ªç”¨ï¼Œçº¯å‚è€ƒ
  self_use:
    alex_design:
      templates:
        - api-review-format
        - architecture-review-format
        - database-review-format
        - ui-review-format
        - ux-research-format
      trigger: "*design æˆ– *analyze å‘½ä»¤ï¼ŒAlex æ ¹æ®ä»»åŠ¡ç±»å‹é€‰ç”¨"
      description: "Alex è®¾è®¡é˜¶æ®µå¯å‚è€ƒçš„æ¨¡æ¿"

    blake_implement:
      templates:
        - debugging-format
        - error-handling-format
      trigger: "*debug æˆ– *implement å‘½ä»¤ï¼ŒBlake æ ¹æ®éœ€è¦é€‰ç”¨"
      description: "Blake å®ç°é˜¶æ®µå¯å‚è€ƒçš„æ¨¡æ¿"

  # Enforcement rules
  enforcement:
    gate_3_check:
      description: "Gate 3 é€šè¿‡æ¡ä»¶"
      requirements:
        - "COMPLETION-*.md exists in .tad/active/handoffs/"
        - "test-runner subagent was called"
        - "testing-review evidence file exists in .tad/evidence/reviews/"
      blocking: true

    gate_4_check:
      description: "Gate 4 é€šè¿‡æ¡ä»¶"
      requirements:
        - "security-auditor subagent was called"
        - "performance-optimizer subagent was called"
        - "security-review evidence file exists in .tad/evidence/reviews/"
        - "performance-review evidence file exists in .tad/evidence/reviews/"
      blocking: true

# ==================== å¤–éƒ¨é…ç½®å¼•ç”¨ ====================
# Skills ç³»ç»Ÿé…ç½®å·²ç§»è‡³ç‹¬ç«‹æ–‡ä»¶ä»¥ä¼˜åŒ–æ€§èƒ½
external_configs:
  skills_config:
    file: ".tad/skills-config.yaml"
    description: "Skills çŸ¥è¯†åº“ç³»ç»Ÿå’Œè‡ªåŠ¨åŒ¹é…é…ç½®"
    when_to_load: "éœ€è¦ Skills æ¨èæˆ–è‡ªåŠ¨åŒ¹é…æ—¶"
