# Handoff Document: Blake + Ralph Loop Fusion
## TAD v2.0 - Autonomous Quality-Driven Development

**From:** Alex (Agent A - Solution Lead)
**To:** Blake (Agent B - Execution Master)
**Date:** 2026-01-26
**Project:** TAD Framework
**Task ID:** TASK-20260126-001
**Handoff Version:** 1.2.0 (Expert Timeout Optimized)

---

## ğŸ”´ Gate 2: Design Completeness (Alex å·²å®Œæˆ)

**æ‰§è¡Œæ—¶é—´**: 2026-01-26 00:43
**ä¸“å®¶å®¡æŸ¥æ—¶é—´**: 2026-01-26 01:00

### Gate 2 æ£€æŸ¥ç»“æœ

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| Architecture Complete | âœ… | ä¸‰å±‚å¾ªç¯æ¶æ„å®Œæ•´å®šä¹‰ + ä¸“å®¶å®¡æŸ¥åé¦ˆæ•´åˆ |
| Components Specified | âœ… | Ralph Loopã€Expert Criteriaã€Gate é‡å®šä¹‰å‡å·²è§„æ ¼åŒ– |
| Functions Verified | âœ… | åŸºäºç°æœ‰ TAD é…ç½®ç»“æ„ï¼Œæ— éœ€è°ƒç”¨ä¸å­˜åœ¨çš„å‡½æ•° |
| Data Flow Mapped | âœ… | Blake â†’ Layer 1 â†’ Layer 2 â†’ Gate 3 â†’ Alex Gate 4 å®Œæ•´æ˜ å°„ |
| Expert Review | âœ… | code-reviewer + backend-architect å®¡æŸ¥å®Œæˆ |

**Gate 2 ç»“æœ**: âœ… PASS

### Expert Review Summary

| ä¸“å®¶ | å‘ç°çš„ P0 é—®é¢˜ | å¤„ç†çŠ¶æ€ |
|------|---------------|----------|
| code-reviewer | 3 ä¸ª P0 (è¿­ä»£è®¡æ•°ã€å‡çº§é˜ˆå€¼ã€Gate èŒè´£) | âœ… å·²æ•´åˆ |
| backend-architect | 3 ä¸ª P0 (çŠ¶æ€æŒä¹…åŒ–ã€è¶…æ—¶ã€æ–­è·¯å™¨) | âœ… å·²æ•´åˆ |
| Human (ç”¨æˆ·) | 1 ä¸ª (ä¸“å®¶è¶…æ—¶ 5min è¿‡çŸ­) | âœ… å·²è°ƒæ•´ä¸ºåˆ†å±‚è¶…æ—¶ |

**Alexç¡®è®¤**: æˆ‘å·²éªŒè¯æ‰€æœ‰è®¾è®¡è¦ç´ å¹¶æ•´åˆä¸“å®¶åé¦ˆï¼ŒBlakeå¯ä»¥ç‹¬ç«‹æ ¹æ®æœ¬æ–‡æ¡£å®Œæˆå®ç°ã€‚

---

## ğŸ“‹ Handoff Checklist (Blakeå¿…è¯»)

Blakeåœ¨å¼€å§‹å®ç°å‰ï¼Œè¯·ç¡®è®¤ï¼š
- [ ] é˜…è¯»äº†æ‰€æœ‰ç« èŠ‚
- [ ] ç†è§£äº† Ralph Loop çš„æ ¸å¿ƒåŸç†ï¼ˆè¿­ä»£ç›´åˆ°ä¸“å®¶é€šè¿‡ï¼‰
- [ ] ç†è§£äº†æ–°å¢çš„ **æ–­è·¯å™¨** å’Œ **çŠ¶æ€æŒä¹…åŒ–** æœºåˆ¶
- [ ] æ‰€æœ‰é…ç½®æ–‡ä»¶çš„ä¿®æ”¹ä½ç½®éƒ½æ¸…æ¥š
- [ ] ç†è§£äº†çœŸæ­£æ„å›¾ï¼ˆè‡ªåŠ¨åŒ–è´¨é‡ä¿è¯ï¼Œè€Œéå–æ¶ˆäººç±»å‚ä¸ï¼‰
- [ ] æ¯ä¸ª Phase çš„äº¤ä»˜ç‰©å’Œè¯æ®è¦æ±‚éƒ½æ¸…æ¥š
- [ ] ç¡®è®¤å¯ä»¥ç‹¬ç«‹ä½¿ç”¨æœ¬æ–‡æ¡£å®Œæˆå®ç°

âŒ å¦‚æœä»»ä½•éƒ¨åˆ†ä¸æ¸…æ¥šï¼Œ**ç«‹å³è¿”å› Alex è¦æ±‚æ¾„æ¸…**ï¼Œä¸è¦å¼€å§‹å®ç°ã€‚

---

## 1. Task Overview

### 1.1 What We're Building

å°† **Ralph Wiggum å¾ªç¯æŠ€æœ¯** èåˆè¿› TAD æ¡†æ¶çš„ Blake æ‰§è¡Œé˜¶æ®µï¼š
- Blake æ‰§è¡Œæ—¶è‡ªåŠ¨è¿›å…¥ Ralph Loop
- Expert Agentsï¼ˆcode-reviewer, test-runner, security-auditor, performance-optimizerï¼‰çš„å®¡æ ¸é€šè¿‡ä½œä¸ºé€€å‡ºæ¡ä»¶
- æ‰©å±• Gate 3 åŒ…å«æ‰€æœ‰æŠ€æœ¯æ£€æŸ¥
- ç®€åŒ– Gate 4 ä¸ºçº¯ Alex éªŒæ”¶ + å½’æ¡£

### 1.2 Why We're Building It

**ä¸šåŠ¡ä»·å€¼**ï¼š
- å‡å°‘ Blake çš„ã€Œè™šå‡å®Œæˆã€é—®é¢˜ï¼ˆAI è‡ªè®¤ä¸ºå®Œæˆä½†å®é™…æœ‰é—®é¢˜ï¼‰
- è‡ªåŠ¨åŒ–è´¨é‡ä¿è¯æµç¨‹ï¼Œé™ä½äººå·¥å®¡æ ¸è´Ÿæ‹…
- ä¿æŒ Human-in-the-Loop æ§åˆ¶æƒçš„åŒæ—¶æå‡æ•ˆç‡

**ç”¨æˆ·å—ç›Š**ï¼š
- Blake æäº¤ç»™ Alex çš„ä»£ç å·²ç»è¿‡å¤šè½®è‡ªåŠ¨å®¡æ ¸
- å‡å°‘ Alex éªŒæ”¶æ—¶å‘ç°ä½çº§é—®é¢˜çš„æ¦‚ç‡
- æ¸…æ™°çš„è´£ä»»åˆ’åˆ†ï¼šBlake = æŠ€æœ¯å®Œæ•´æ€§ï¼ŒAlex = ä¸šåŠ¡éªŒæ”¶

**æˆåŠŸçš„æ ·å­**ï¼š
- Blake å®Œæˆå®ç°åï¼Œä»£ç å·²é€šè¿‡ Layer 1 è‡ªæ£€ï¼ˆbuild/test/lintï¼‰
- ä»£ç å·²é€šè¿‡ Layer 2 ä¸“å®¶å®¡æ ¸ï¼ˆcode-reviewer æ—  P0/P1ï¼‰
- Alex åªéœ€å…³æ³¨ä¸šåŠ¡ä»·å€¼éªŒæ”¶ï¼Œä¸å†é‡å¤æ£€æŸ¥æŠ€æœ¯è´¨é‡

### 1.3 Intent Statementï¼ˆæ„å›¾å£°æ˜ï¼‰

**çœŸæ­£è¦è§£å†³çš„é—®é¢˜**ï¼š
AI å®¹æ˜“ã€Œè‡ªè®¤ä¸ºå®Œæˆã€ï¼Œä½†å®é™…ä¸Šä»£ç æœ‰é—®é¢˜ã€‚é€šè¿‡å¼•å…¥å¤–éƒ¨ä¸“å®¶æ£€æŸ¥ä½œä¸ºå®¢è§‚é€€å‡ºæ¡ä»¶ï¼Œç¡®ä¿ä»£ç è´¨é‡æœ‰ä¿è¯ã€‚

**ä¸æ˜¯è¦åšçš„ï¼ˆé¿å…è¯¯è§£ï¼‰**ï¼š
- âŒ ä¸æ˜¯å–æ¶ˆäººç±»å‚ä¸ï¼ˆHuman ä»ç„¶è§¦å‘ Gate 3/4ï¼‰
- âŒ ä¸æ˜¯è®© AI æ— é™å¾ªç¯ï¼ˆæœ‰æœ€å¤§è¿­ä»£æ¬¡æ•°é™åˆ¶ + æ–­è·¯å™¨ï¼‰
- âŒ ä¸æ˜¯å¢åŠ æµç¨‹å¤æ‚åº¦ï¼ˆå®é™…ä¸Šç®€åŒ–äº† Gate 4ï¼‰

**Blakeè¯·ç¡®è®¤ç†è§£**ï¼š
```
åœ¨å¼€å§‹å®ç°å‰ï¼Œè¯·ç”¨ä½ è‡ªå·±çš„è¯å›ç­”ï¼š
1. Ralph Loop çš„æ ¸å¿ƒç†å¿µæ˜¯ä»€ä¹ˆï¼Ÿ
2. Layer 1 å’Œ Layer 2 çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ
3. æ–­è·¯å™¨ï¼ˆCircuit Breakerï¼‰ä»€ä¹ˆæ—¶å€™è§¦å‘ï¼Ÿ
4. ä¸ºä»€ä¹ˆ Gate 4 å˜ç®€å•äº†ï¼Ÿ

åªæœ‰Humanç¡®è®¤ä½ çš„ç†è§£æ­£ç¡®åï¼Œæ‰èƒ½å¼€å§‹å®ç°ã€‚
```

---

## ğŸ“š Project Knowledgeï¼ˆBlake å¿…è¯»ï¼‰

### æ­¥éª¤ 1ï¼šè¯†åˆ«ç›¸å…³ç±»åˆ«

æœ¬æ¬¡ä»»åŠ¡æ¶‰åŠçš„é¢†åŸŸï¼š
- [x] code-quality - ä»£ç æ¨¡å¼/åæ¨¡å¼
- [x] architecture - æ¶æ„å†³ç­–
- [ ] security - å®‰å…¨é—®é¢˜
- [ ] ux - ç”¨æˆ·ä½“éªŒå†³ç­–
- [ ] performance - æ€§èƒ½ä¼˜åŒ–
- [x] testing - æµ‹è¯•æ¨¡å¼/è¾¹ç•Œæƒ…å†µ
- [ ] api-integration - å¤–éƒ¨ API é›†æˆ
- [ ] mobile-platform - iOS/Android ç‰¹å®šé—®é¢˜

### æ­¥éª¤ 2ï¼šå†å²ç»éªŒæ‘˜å½•

**å·²è¯»å–çš„ project-knowledge æ–‡ä»¶**ï¼š

| æ–‡ä»¶ | ç›¸å…³è®°å½•æ•° | å…³é”®æé†’ |
|------|-----------|----------|
| architecture.md | å¾…åˆ›å»º | è¿™æ˜¯æ¶æ„å˜æ›´ï¼Œéœ€è¦è®°å½•å†³ç­–ç†ç”± |

**âš ï¸ Blake å¿…é¡»æ³¨æ„çš„å†å²æ•™è®­**ï¼š

âœ… å·²æ£€æŸ¥ï¼Œè¿™æ˜¯æ–°åŠŸèƒ½ï¼Œæ— ç›´æ¥ç›¸å…³çš„å†å²è®°å½•ã€‚ä½†éœ€æ³¨æ„ï¼š
- TAD çš„ Terminal éš”ç¦»è§„åˆ™ä»ç„¶æœ‰æ•ˆ
- é…ç½®æ–‡ä»¶ä¿®æ”¹éœ€è¦ä¿æŒå‘åå…¼å®¹

---

## 2. Background Context

### 2.1 Ralph Wiggum æŠ€æœ¯åŸç†

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š`while :; do cat PROMPT.md | claude-code ; done`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Ralph Loop                            â”‚
â”‚                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚  Start   â”‚â”€â”€â–¶â”‚  Execute â”‚â”€â”€â–¶â”‚  Check   â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                        â–²              â”‚                 â”‚
â”‚                        â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚                        â”‚    â”‚  Pass Criteria? â”‚        â”‚
â”‚                        â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                        â”‚             â”‚                 â”‚
â”‚                   No   â”‚      Yes    â”‚                 â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”           â”‚
â”‚                   â”‚  Retry  â”‚   â”‚  Exit   â”‚           â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®æ´å¯Ÿ**ï¼š
- Ralph åŸç‰ˆç”¨ `<promise>COMPLETE</promise>` ä½œä¸ºé€€å‡ºæ¡ä»¶
- é—®é¢˜ï¼šAI è‡ªåˆ¤æ–­ã€Œå®Œæˆã€å®¹æ˜“å‡ºé”™
- è§£å†³ï¼šç”¨ **ä¸“å®¶ Agent çš„å®¢è§‚å®¡æ ¸** ä½œä¸ºé€€å‡ºæ¡ä»¶

### 2.2 Current TAD Gate Structure

**å½“å‰ç»“æ„**ï¼š
- Gate 1: éœ€æ±‚å®Œæ•´æ€§ (Alex)
- Gate 2: è®¾è®¡å®Œæ•´æ€§ (Alex)
- Gate 3: å®ç°è´¨é‡ (Blake)
- Gate 4: é›†æˆéªŒè¯ (Blake Part A + Alex Part B)

**é—®é¢˜**ï¼šGate 4 èŒè´£ä¸æ¸…æ™°ï¼ŒBlake å’Œ Alex éƒ½æœ‰éƒ¨åˆ†å·¥ä½œ

### 2.3 Target Structure

**æ–°ç»“æ„**ï¼š
- Gate 1: éœ€æ±‚å®Œæ•´æ€§ (Alex) - ä¸å˜
- Gate 2: è®¾è®¡å®Œæ•´æ€§ (Alex) - ä¸å˜
- Gate 3: **å®ç° + é›†æˆè´¨é‡** (Blake) - æ‰©å±•ï¼ŒåŒ…å« Ralph Loop
- Gate 4: **éªŒæ”¶ + å½’æ¡£** (Alex) - ç®€åŒ–ï¼Œçº¯ä¸šåŠ¡éªŒæ”¶

---

## 3. Requirements

### 3.1 Functional Requirements

- **FR1**: Blake åœ¨æ‰§è¡Œ handoff æ—¶è‡ªåŠ¨è¿›å…¥ Ralph Loop
- **FR2**: Ralph Loop åŒ…å«ä¸¤å±‚æ£€æŸ¥
  - Layer 1: è‡ªæ£€ï¼ˆbuild/test/lint/tscï¼‰
  - Layer 2: ä¸“å®¶å®¡æ ¸ï¼ˆcode-reviewer, test-runner, security-auditor, performance-optimizerï¼‰
- **FR3**: ä¸“å®¶å®¡æ ¸é€šè¿‡å®šä¹‰ï¼ˆæœºå™¨å¯è§£æï¼‰
  - code-reviewer: severity_threshold = P2 (P0/P1 é˜»å¡)
  - test-runner: pass_rate = 100%, coverage >= 70%
  - security-auditor: no critical/high (æ¡ä»¶è§¦å‘)
  - performance-optimizer: no blocking patterns (æ¡ä»¶è§¦å‘)
- **FR4**: å¾ªç¯æœ‰æœ€å¤§æ¬¡æ•°é™åˆ¶ + **æ–­è·¯å™¨æœºåˆ¶**
- **FR5**: Gate 3 æ‰©å±•ä¸ºåŒ…å«åŸ Gate 4 Part A çš„æŠ€æœ¯æ£€æŸ¥
- **FR6**: Gate 4 ç®€åŒ–ä¸º Alex çš„ä¸šåŠ¡éªŒæ”¶ + å½’æ¡£
- **FR7**: (NEW) å¾ªç¯çŠ¶æ€æŒä¹…åŒ–ï¼Œæ”¯æŒå´©æºƒæ¢å¤
- **FR8**: (NEW) ä¸“å®¶è°ƒç”¨æœ‰ç‹¬ç«‹è¶…æ—¶æ§åˆ¶

### 3.2 Non-Functional Requirements

- **NFR1**: å‘åå…¼å®¹ - ä¸ç ´åç°æœ‰ TAD å·¥ä½œæµ
- **NFR2**: é…ç½®åŒ– - å¾ªç¯å‚æ•°å¯é€šè¿‡ config.yaml è°ƒæ•´
- **NFR3**: å¯è¿½æº¯ - æ¯è½®å¾ªç¯ç»“æœéƒ½è¦è®°å½•
- **NFR4**: æˆæœ¬æ§åˆ¶ - Layer 1 ä¾¿å®œæ£€æŸ¥å…ˆæ‰§è¡Œï¼Œé€šè¿‡åæ‰æ‰§è¡Œ Layer 2 ä¸“å®¶å®¡æ ¸
- **NFR5**: (NEW) é²æ£’æ€§ - æ–­è·¯å™¨é˜²æ­¢èµ„æºæµªè´¹
- **NFR6**: (NEW) å¯æ¢å¤æ€§ - çŠ¶æ€æŒä¹…åŒ–æ”¯æŒæ–­ç‚¹ç»­ä¼ 

---

## 4. Technical Design

### 4.1 Architecture Overview (Updated with Expert Feedback)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Blake Execution Flow (with Ralph Loop v1.1)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚ Read Handoffâ”‚                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚         â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    RALPH LOOP (with State Persistence)           â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  [State File: .tad/evidence/ralph-loops/{task}_state.yaml]      â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ LAYER 1: Self-Check (Fast, Cheap)                        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ â”‚  build â”‚ â”‚  test  â”‚ â”‚  lint  â”‚ â”‚  tsc   â”‚             â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                          â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ CIRCUIT BREAKER: 3 consecutive same errors      â”‚    â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ â†’ Escalate to Human, don't keep retrying        â”‚    â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                          â”‚   â”‚   â”‚
â”‚  â”‚  â”‚              All Pass? Yes â†“  No â†’ Fix & Retry           â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                         â”‚                                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ LAYER 2: Expert Review (Priority Groups)                  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  Priority Group 1 (Blocking):                             â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚code-reviewer â”‚ â”€â”€â”€â”€ Must pass before Group 2          â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     Timeout: 5 min                     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  Priority Group 2 (Parallel, after Group 1 passes):       â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ test-runner  â”‚ â”‚security-auditâ”‚ â”‚perf-optimizerâ”‚      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  (required)  â”‚ â”‚ (conditional)â”‚ â”‚ (conditional)â”‚      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  Timeout: 5 min each                                      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ ESCALATION: 3 failed Layer 2 rounds on same     â”‚     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ category â†’ Escalate to Alex for re-design       â”‚     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚           All Experts Pass? Yes â†“  No â†’ Fix & Retry       â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ GATE 3 (Expanded): Implementation & Integration Quality          â”‚   â”‚
â”‚  â”‚ - All Loop iterations documented                                 â”‚   â”‚
â”‚  â”‚ - Expert review evidence attached                                â”‚   â”‚
â”‚  â”‚ - Knowledge Assessment completed                                 â”‚   â”‚
â”‚  â”‚ - Human confirms to proceed                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Output: Completion Report â†’ Alex (Terminal 1)                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Component Specifications

#### 4.2.1 Ralph Loop Configuration (Updated with P0 Fixes)

**æ–‡ä»¶**: `.tad/ralph-config/loop-config.yaml`

```yaml
# Ralph Loop Configuration v1.1
# TAD v2.0 - Blake Autonomous Execution
# Updated with Expert Review Feedback

$schema: ".tad/schemas/loop-config.schema.json"  # Schema validation

ralph_loop:
  enabled: true
  version: "1.1.0"

  # ==================== Layer 1: Self-Check ====================
  layer1:
    name: "Self-Check"
    description: "Fast local checks before expert review"

    commands:
      - name: "build"
        command: "npm run build"
        timeout: 120000  # 2 minutes
        required: true
      - name: "test"
        command: "npm test"
        timeout: 300000  # 5 minutes
        required: true
      - name: "lint"
        command: "npm run lint"
        timeout: 60000   # 1 minute
        required: true
      - name: "typecheck"
        command: "npx tsc --noEmit"
        timeout: 120000  # 2 minutes
        required: true

    # NEW: Iteration limits (clear semantics)
    limits:
      max_retries: 15  # Max Layer 1 retry count

    # NEW: Circuit Breaker
    circuit_breaker:
      enabled: true
      consecutive_same_error: 3  # Same error 3 times â†’ human intervention
      action: "escalate_to_human"
      message: "Layer 1 circuit breaker triggered. Same error occurred {count} times. Human intervention required."

  # ==================== Layer 2: Expert Review ====================
  layer2:
    name: "Expert Review"
    description: "Priority-grouped expert agent review"

    # NEW: Priority Groups (code-reviewer first, then others in parallel)
    priority_groups:
      group1:
        name: "Code Quality Gate"
        description: "Must pass before other experts run"
        parallel: false
        experts:
          - name: "code-reviewer"
            subagent_type: "code-reviewer"
            # Tiered timeout based on change size (v1.2 update)
            timeout:
              default: 600000      # 10 minutes - standard
              small_change: 180000 # 3 minutes - single file fix
              large_change: 900000 # 15 minutes - 50+ files
            timeout_selection: "auto"  # auto-detect based on file count
            pass_criteria:
              severity_threshold: "P2"  # P0 and P1 are blocking
              max_issues:
                P0: 0
                P1: 0
                P2: 10  # Allow up to 10 P2 issues
                P3: -1  # Unlimited
            evidence_file: "{date}-code-review-{task}-iter{n}.md"

      group2:
        name: "Verification Experts"
        description: "Run in parallel after Group 1 passes"
        parallel: true
        experts:
          - name: "test-runner"
            subagent_type: "test-runner"
            # Tiered timeout based on test type (v1.2 update)
            timeout:
              default: 600000       # 10 minutes - standard
              unit_only: 180000     # 3 minutes - unit tests only
              with_integration: 600000  # 10 minutes - unit + integration
              with_e2e: 1200000     # 20 minutes - includes E2E tests
            timeout_selection: "auto"  # auto-detect based on test config
            required: true
            pass_criteria:
              test_pass_rate: 100
              coverage_minimum: 70
            evidence_file: "{date}-testing-review-{task}-iter{n}.md"

          - name: "security-auditor"
            subagent_type: "security-auditor"
            timeout: 300000  # 5 minutes - sufficient for pattern scanning
            required: false  # Conditional
            trigger_pattern: "auth|token|password|credential|api.*key|encrypt|decrypt|session|cookie|sql|query|upload|file|exec|eval"
            pass_criteria:
              severity_threshold: "medium"  # critical and high are blocking
            evidence_file: "{date}-security-review-{task}-iter{n}.md"

          - name: "performance-optimizer"
            subagent_type: "performance-optimizer"
            timeout: 300000  # 5 minutes - sufficient for complexity analysis
            required: false  # Conditional
            trigger_pattern: "database|query|cache|batch|loop|sort|search|O\\(n"
            pass_criteria:
              blocking_patterns:
                - "O(nÂ³) without justification"
                - "O(nÂ²) in hot path without justification"
                - "Unbounded recursion"
                - "Obvious memory leak"
            evidence_file: "{date}-performance-review-{task}-iter{n}.md"

    # NEW: Layer 2 specific limits
    limits:
      max_rounds: 5  # Max Layer 2 retry count

    # NEW: Escalation threshold
    escalation:
      enabled: true
      threshold: 3  # 3 failed rounds on same issue category â†’ escalate
      action: "escalate_to_alex"
      message: "Layer 2 escalation triggered. Same category of issue failed {count} times. Returning to Alex for re-design."

  # ==================== Global Limits (Clear Semantics) ====================
  limits:
    description: "Total limits for entire Ralph Loop execution"

    # Iteration counting: Layer 1 retry = 1, Layer 2 round = 1
    total_iterations: 30  # Combined Layer 1 + Layer 2 count
    timeout_minutes: 120  # Global timeout
    per_iteration_timeout: 15  # NEW: Max time per single iteration (minutes)

    abort_conditions:
      - condition: "total_iterations >= 30"
        action: "abort"
        message: "Ralph Loop exceeded {limit} total iterations. Human intervention required."
      - condition: "timeout_minutes >= 120"
        action: "abort"
        message: "Ralph Loop exceeded {limit} minute timeout. Human intervention required."
      - condition: "layer1.circuit_breaker.triggered"
        action: "abort"
        message: "Layer 1 circuit breaker triggered. Human intervention required."
      - condition: "layer2.escalation.triggered"
        action: "escalate"
        message: "Design-level issue detected. Escalating to Alex."

  # ==================== State Persistence (NEW) ====================
  state_persistence:
    enabled: true
    description: "Persist loop state for crash recovery"

    state_file: ".tad/evidence/ralph-loops/{task_id}_state.yaml"
    checkpoint_frequency: "after_each_layer"  # Checkpoint after Layer 1 and Layer 2

    state_schema:
      current_iteration: 0
      layer1_retries: 0
      layer2_rounds: 0
      last_completed_layer: null  # "layer1" or "layer2"
      last_error_category: null
      consecutive_same_error: 0
      started_at: null
      last_checkpoint_at: null

    recovery:
      enabled: true
      on_resume: "continue_from_last_checkpoint"
      stale_threshold_minutes: 30  # If state older than 30 min, start fresh

  # ==================== Evidence and Logging ====================
  evidence:
    directory: ".tad/evidence/ralph-loops"

    files:
      state: "{task_id}_state.yaml"  # Current loop state
      summary: "{task_id}_summary.md"  # Aggregated summary (NEW)
      iterations: "{timestamp}_{task_id}_iter_{n}.md"  # Per-iteration log

    retention_days: 30

    # NEW: Summary file format
    summary_format: |
      # Ralph Loop Summary: {task_id}

      ## Execution Overview
      - Total Iterations: {total_iterations}
      - Layer 1 Retries: {layer1_retries}
      - Layer 2 Rounds: {layer2_rounds}
      - Final Status: {status}
      - Duration: {duration}

      ## Layer 1 Results
      | Iteration | Build | Test | Lint | TSC | Result |
      |-----------|-------|------|------|-----|--------|
      {layer1_table}

      ## Layer 2 Results
      | Round | code-reviewer | test-runner | security | performance | Result |
      |-------|---------------|-------------|----------|-------------|--------|
      {layer2_table}

      ## Evidence Files
      - Final code review: {code_review_link}
      - Final test report: {test_report_link}
      - [Additional files...]

  # ==================== Rollback Strategy (NEW) ====================
  rollback:
    enabled: true
    on_abort:
      action: "git stash push -m 'Ralph Loop aborted: {task_id} iteration {n}'"
      preserve_evidence: true
      notification: |
        Ralph Loop aborted at iteration {n}.
        Partial changes stashed: {stash_ref}
        Evidence preserved at: {evidence_path}
        Human action required: Review and decide next steps.
```

#### 4.2.2 Expert Pass Criteria (Updated - Machine Parseable)

**æ–‡ä»¶**: `.tad/ralph-config/expert-criteria.yaml`

```yaml
# Expert Agent Pass Criteria v1.1
# Updated with structured, machine-parseable definitions

$schema: ".tad/schemas/expert-criteria.schema.json"

expert_criteria:
  version: "1.1.0"

  code-reviewer:
    description: "Code quality and maintainability check"

    # Machine-parseable pass condition
    pass_condition:
      type: "severity_count"
      rules:
        - severity: "P0"
          max_count: 0
          blocking: true
        - severity: "P1"
          max_count: 0
          blocking: true
        - severity: "P2"
          max_count: 10  # Allow up to 10
          blocking: false
        - severity: "P3"
          max_count: -1  # Unlimited
          blocking: false

    severity_definitions:
      P0:
        name: "Critical"
        description: "Security vulnerability, data loss, crash"
        examples:
          - "SQL injection vulnerability"
          - "Unhandled exception that crashes app"
          - "Data corruption possible"
      P1:
        name: "High"
        description: "Logic errors, race conditions, broken features"
        examples:
          - "Logic error causing wrong calculation"
          - "Race condition in async code"
          - "Feature doesn't work as specified"
      P2:
        name: "Medium"
        description: "Style, naming, minor improvements"
        examples:
          - "Inconsistent naming convention"
          - "Could use more descriptive variable name"
          - "Minor code duplication"
      P3:
        name: "Low"
        description: "Suggestions, nice-to-haves"
        examples:
          - "Could add more comments"
          - "Alternative approach might be cleaner"

  test-runner:
    description: "Test execution and coverage check"

    pass_condition:
      type: "metrics"
      rules:
        - metric: "test_pass_rate"
          operator: "=="
          value: 100
          unit: "percent"
        - metric: "coverage"
          operator: ">="
          value: 70
          unit: "percent"
          configurable: true  # Per-project override

    # Environment-specific overrides
    environment_overrides:
      production:
        coverage: 80
      prototype:
        coverage: 0  # Skip during prototyping

  security-auditor:
    description: "Security vulnerability check"

    pass_condition:
      type: "severity_count"
      rules:
        - severity: "critical"
          max_count: 0
          blocking: true
        - severity: "high"
          max_count: 0
          blocking: true
        - severity: "medium"
          max_count: 5
          blocking: false
        - severity: "low"
          max_count: -1
          blocking: false

  performance-optimizer:
    description: "Performance and efficiency check"

    pass_condition:
      type: "pattern_match"
      rules:
        - category: "algorithm_complexity"
          blocking_patterns:
            - "O(nÂ³) without justification"
            - "O(nÂ²) in hot path without justification"
            - "Unbounded recursion"
          warning_patterns:
            - "O(nÂ²) with justification"
            - "Inefficient data structure choice"
        - category: "memory"
          blocking_patterns:
            - "Obvious memory leak"
            - "Unbounded growth"
          warning_patterns:
            - "Large allocation in loop"
```

#### 4.2.3 Gate Responsibility Matrix (NEW - Resolves P0-3)

**æ¸…æ™°çš„ Gate 3/4 èŒè´£åˆ’åˆ†**ï¼š

| Expert | Gate 3 (Blake) | Gate 4 (Alex) | Notes |
|--------|---------------|---------------|-------|
| test-runner | âœ… Required (Layer 2) | âŒ N/A | Already verified by Blake |
| code-reviewer | âœ… Required (Layer 2) | âšª Optional (second opinion) | Alex can re-run if concerned |
| security-auditor | âœ… Conditional (Layer 2) | âšª Optional (verification) | Alex reviews evidence only |
| performance-optimizer | âœ… Conditional (Layer 2) | âšª Optional (verification) | Alex reviews evidence only |
| ux-expert-reviewer | âŒ N/A | âšª Optional (if UI involved) | Business/UX focus |
| product-expert | âŒ N/A | âšª Optional (business logic) | Business focus |

**åŸåˆ™**ï¼š
- Gate 3 (Blake): æŠ€æœ¯è´¨é‡éªŒè¯ - **å¼ºåˆ¶**è¿è¡ŒæŠ€æœ¯ä¸“å®¶
- Gate 4 (Alex): ä¸šåŠ¡ä»·å€¼éªŒæ”¶ - **å¯é€‰**è¿è¡Œä¸šåŠ¡ä¸“å®¶ï¼ŒæŠ€æœ¯ä¸“å®¶ä»…å®¡æŸ¥è¯æ®

#### 4.2.4 Gate 3 Expanded Checklist (Updated)

**æ›´æ–°æ–‡ä»¶**: `.tad/config.yaml` çš„ `quality_gates` éƒ¨åˆ†

```yaml
# Gate 3 Redefinition (Expanded) v1.1
gate3_implementation_integration:
  name: "Implementation & Integration Quality"
  owner: "Blake"
  description: "All technical quality checks - Ralph Loop + original Gate 3 + Gate 4 Part A"

  # Ralph Loop Evidence (Required)
  ralph_loop_evidence:
    required: true
    checks:
      - "Ralph Loop completed successfully (no abort/escalation)"
      - "State file shows clean completion"
      - "Summary file generated"
    evidence_required:
      - ".tad/evidence/ralph-loops/{task_id}_state.yaml"
      - ".tad/evidence/ralph-loops/{task_id}_summary.md"

  # Expert Evidence (Required)
  expert_evidence:
    required: true
    files:
      - type: "code-review"
        pattern: ".tad/evidence/reviews/{date}-code-review-{task}-final.md"
        required: true
      - type: "testing-review"
        pattern: ".tad/evidence/reviews/{date}-testing-review-{task}-final.md"
        required: true
      - type: "security-review"
        pattern: ".tad/evidence/reviews/{date}-security-review-{task}-*.md"
        required: false  # Only if triggered
      - type: "performance-review"
        pattern: ".tad/evidence/reviews/{date}-performance-review-{task}-*.md"
        required: false  # Only if triggered

  # Original Gate 3 Checks
  implementation_quality:
    checks:
      - "Code compiles without errors"
      - "All functions referenced in handoff exist"
      - "Type checking passes"
      - "No linting errors"

  # Moved from Gate 4 Part A
  integration_verification:
    checks:
      - "All tests pass (unit + integration)"
      - "Coverage meets threshold"
      - "No regression in existing functionality"

  # Knowledge Assessment (MANDATORY)
  knowledge_assessment:
    required: true
    questions:
      - "New discoveries during implementation?"
      - "Category (if yes)"
      - "Brief summary"
    output_location: ".tad/project-knowledge/{category}.md"

  human_trigger:
    command: "/gate 3"
    description: "Blake completes Ralph Loop, Human triggers Gate 3 to confirm"
```

#### 4.2.5 Gate 4 Simplified Checklist (Updated)

```yaml
# Gate 4 Redefinition (Simplified) v1.1
gate4_acceptance_archive:
  name: "Acceptance & Archive"
  owner: "Alex"
  description: "Pure business validation - technical quality already verified by Gate 3"

  # Pre-condition
  prerequisite:
    - "Gate 3 passed"
    - "Blake's completion report received"

  # Business Acceptance (Focus)
  acceptance:
    checks:
      - "Business value delivered matches handoff intent"
      - "User requirements satisfied"
      - "No unexpected side effects on user experience"

    # Review evidence only - no re-run needed
    evidence_review:
      description: "Review Blake's Gate 3 evidence (not re-execute)"
      files:
        - "{task_id}_summary.md"
        - "Final code-review report"
        - "Final testing-review report"

    # Optional subagent calls (business focus)
    optional_experts:
      - name: "ux-expert-reviewer"
        when: "UI/UX changes involved"
      - name: "product-expert"
        when: "Complex business logic"

  # Archive
  archive:
    actions:
      - "Move handoff to .tad/archive/by_task/"
      - "Move evidence to .tad/archive/evidence/"
      - "Update NEXT.md with completion status"

  # Knowledge Assessment (MANDATORY)
  knowledge_assessment:
    required: true
    questions:
      - "New discoveries during acceptance?"
      - "Category (if yes)"
      - "Brief summary"
    output_location: ".tad/project-knowledge/{category}.md"

  human_trigger:
    command: "/gate 4"
```

### 4.3 Blake Command Updates (Updated with State Persistence)

**æ›´æ–°æ–‡ä»¶**: `.claude/commands/tad-blake.md`

```markdown
## *develop Command (Updated for Ralph Loop v1.1)

When Blake executes `*develop`:

1. **Pre-flight Check**
   - Verify handoff exists and is readable
   - Verify project has required scripts (build, test, lint)
   - Load ralph-config

2. **Check for Resumable State**
   ```
   state_file = ".tad/evidence/ralph-loops/{task_id}_state.yaml"
   if state_file.exists() and state_file.age < 30_minutes:
       resume_from_checkpoint(state_file)
   else:
       initialize_new_state()
   ```

3. **Enter Ralph Loop**
   ```
   while not (limits_exceeded or escalation_triggered or all_pass):

       # Save checkpoint
       save_state()

       # Layer 1: Self-Check
       layer1_results = run_layer1_checks()

       if layer1_results.has_same_error_as_last(3):
           trigger_circuit_breaker()
           break

       if not layer1_results.all_pass:
           fix_issues(layer1_results.failures)
           increment_layer1_retries()
           continue

       # Layer 2: Expert Review (Priority Groups)

       # Group 1: code-reviewer (blocking)
       code_review = run_expert("code-reviewer", timeout=5_minutes)
       if not code_review.pass:
           track_failure_category(code_review.issues)
           if same_category_failures >= 3:
               trigger_escalation_to_alex()
               break
           fix_issues(code_review.issues)
           increment_layer2_rounds()
           continue

       # Group 2: Other experts (parallel)
       experts = get_group2_experts()  # test-runner + conditional
       group2_results = parallel_run(experts, timeout=5_minutes_each)

       if group2_results.all_pass:
           all_pass = true
           break
       else:
           fix_issues(group2_results.failures)
           increment_layer2_rounds()

   # Save final state
   save_final_state()
   ```

4. **Generate Evidence**
   - Create summary file at `.tad/evidence/ralph-loops/{task_id}_summary.md`
   - Copy final expert reviews to `.tad/evidence/reviews/`
   - Clean up intermediate iteration files (optional)

5. **Prepare for Gate 3**
   - Compile completion report
   - List all evidence files
   - Prepare Knowledge Assessment answers
   - Output: "Ralph Loop complete. Please trigger /gate 3"
```

### 4.4 Data Flow (Updated)

```mermaid
graph TD
    A[Blake receives Handoff] --> A1{Resume from state?}
    A1 -->|Yes| A2[Load checkpoint]
    A1 -->|No| A3[Initialize state]
    A2 --> B[Enter Ralph Loop]
    A3 --> B
    B --> C{Layer 1: Self-Check}
    C -->|Pass| D[Save checkpoint]
    C -->|Fail| C1{Circuit breaker?}
    C1 -->|Yes| ABORT[Abort - Human required]
    C1 -->|No| E[Fix Issues]
    E --> C
    D --> F{Layer 2 Group 1: code-reviewer}
    F -->|Pass| G{Layer 2 Group 2: Parallel experts}
    F -->|Fail| F1{Escalation threshold?}
    F1 -->|Yes| ESC[Escalate to Alex]
    F1 -->|No| H[Fix Issues]
    H --> C
    G -->|All Pass| I[Exit Ralph Loop]
    G -->|Any Fail| J[Fix Issues]
    J --> C
    I --> K[Generate Summary]
    K --> L[Prepare Gate 3]
    L --> M[Output: Ready for Gate 3]
    M --> N[Human triggers /gate 3]
    N --> O[Blake executes Gate 3]
    O --> P[Output: Ready for Alex]
    P --> Q[Human notifies Alex]
    Q --> R[Alex reviews in Terminal 1]
    R --> S[Human triggers /gate 4]
    S --> T[Alex executes Gate 4]
    T --> U[Archive & Complete]
```

---

## 5. Implementation Stepsï¼ˆåˆ† Phaseï¼‰

### Phase 1: Ralph Config Files + Schemasï¼ˆé¢„è®¡ 3 å°æ—¶ï¼‰

#### äº¤ä»˜ç‰©
- [ ] `.tad/ralph-config/loop-config.yaml` åˆ›å»º (v1.1 with all P0 fixes)
- [ ] `.tad/ralph-config/expert-criteria.yaml` åˆ›å»º (machine-parseable)
- [ ] `.tad/schemas/loop-config.schema.json` åˆ›å»º
- [ ] `.tad/schemas/expert-criteria.schema.json` åˆ›å»º
- [ ] `.tad/evidence/ralph-loops/` ç›®å½•åˆ›å»º
- [ ] `.tad/evidence/reviews/` ç›®å½•åˆ›å»º

#### å®æ–½æ­¥éª¤
1. åˆ›å»º `.tad/ralph-config/` ç›®å½•
2. åˆ›å»º `loop-config.yaml` (åŒ…å«æ–­è·¯å™¨ã€çŠ¶æ€æŒä¹…åŒ–ã€ä¼˜å…ˆçº§ç»„)
3. åˆ›å»º `expert-criteria.yaml` (æœºå™¨å¯è§£æçš„é€šè¿‡æ ‡å‡†)
4. åˆ›å»º JSON Schema æ–‡ä»¶ç”¨äºé…ç½®éªŒè¯
5. åˆ›å»ºè¯æ®å­˜å‚¨ç›®å½•ç»“æ„

#### éªŒè¯æ–¹æ³•
- YAML è¯­æ³•éªŒè¯é€šè¿‡
- JSON Schema éªŒè¯é…ç½®æ–‡ä»¶
- ç›®å½•ç»“æ„æ­£ç¡®åˆ›å»º

#### Phase 1 å®Œæˆè¯æ®
- [ ] **ç›®å½•ç»“æ„æˆªå›¾**ï¼š`.tad/ralph-config/` å’Œ `.tad/evidence/`
- [ ] **é…ç½®æ–‡ä»¶å†…å®¹**ï¼šå±•ç¤ºå…³é”®é…ç½®ï¼ˆæ–­è·¯å™¨ã€çŠ¶æ€æŒä¹…åŒ–ã€ä¼˜å…ˆçº§ç»„ï¼‰
- [ ] **Schema éªŒè¯ç»“æœ**ï¼šå±•ç¤ºé…ç½®é€šè¿‡ schema éªŒè¯

---

### Phase 2: Config.yaml Gate Updatesï¼ˆé¢„è®¡ 2 å°æ—¶ï¼‰

#### äº¤ä»˜ç‰©
- [ ] `config.yaml` ä¸­ Gate 3 æ‰©å±•å®šä¹‰ï¼ˆåŒ…å«èŒè´£çŸ©é˜µï¼‰
- [ ] `config.yaml` ä¸­ Gate 4 ç®€åŒ–å®šä¹‰
- [ ] `config.yaml` ä¸­æ–°å¢ `ralph_loop` å¼•ç”¨éƒ¨åˆ†
- [ ] `version_history` æ·»åŠ  v2.0.0 è®°å½•

#### å®æ–½æ­¥éª¤
1. å¤‡ä»½ç°æœ‰ `config.yaml`
2. æ·»åŠ  `ralph_loop` é…ç½®å¼•ç”¨
3. æ›´æ–° `quality_gates.gate3` ä¸ºæ‰©å±•ç‰ˆæœ¬
4. æ›´æ–° `quality_gates.gate4` ä¸ºç®€åŒ–ç‰ˆæœ¬
5. æ·»åŠ  Gate èŒè´£çŸ©é˜µè¯´æ˜
6. æ›´æ–° `version_history` æ·»åŠ  v2.0.0 è®°å½•

#### éªŒè¯æ–¹æ³•
- YAML è¯­æ³•éªŒè¯é€šè¿‡
- é…ç½®åŠ è½½æµ‹è¯•

#### Phase 2 å®Œæˆè¯æ®
- [ ] **Git diff**ï¼šå±•ç¤º config.yaml çš„å˜æ›´
- [ ] **èŒè´£çŸ©é˜µ**ï¼šå±•ç¤º Gate 3/4 ä¸“å®¶èŒè´£åˆ’åˆ†
- [ ] **ç‰ˆæœ¬è®°å½•**ï¼šæ–°å¢çš„ v2.0.0 æ¡ç›®

---

### Phase 3: Blake Command Updatesï¼ˆé¢„è®¡ 3 å°æ—¶ï¼‰

#### äº¤ä»˜ç‰©
- [ ] `/blake` å‘½ä»¤æ›´æ–°æ”¯æŒ Ralph Loop v1.1
- [ ] `/gate 3` å‘½ä»¤æ›´æ–°ä¸ºæ‰©å±•ç‰ˆæœ¬
- [ ] æ–°å¢çŠ¶æ€æŒä¹…åŒ–å’Œæ–­è·¯å™¨é€»è¾‘
- [ ] æ–°å¢ä¼˜å…ˆçº§ç»„æ‰§è¡Œé€»è¾‘

#### å®æ–½æ­¥éª¤
1. æ›´æ–° `.claude/commands/tad-blake.md`
2. æ·»åŠ çŠ¶æ€æŒä¹…åŒ–é€»è¾‘ï¼ˆcheckpoint/resumeï¼‰
3. æ·»åŠ æ–­è·¯å™¨é€»è¾‘ï¼ˆconsecutive same error detectionï¼‰
4. æ·»åŠ ä¼˜å…ˆçº§ç»„æ‰§è¡Œé€»è¾‘ï¼ˆGroup 1 â†’ Group 2ï¼‰
5. æ·»åŠ å‡çº§é˜ˆå€¼é€»è¾‘ï¼ˆescalate to Alexï¼‰
6. æ›´æ–° `/gate 3` æ£€æŸ¥é¡¹

#### éªŒè¯æ–¹æ³•
- å‘½ä»¤è¯­æ³•æ­£ç¡®
- æµç¨‹é€»è¾‘å®Œæ•´
- çŠ¶æ€æ–‡ä»¶æ ¼å¼æ­£ç¡®

#### Phase 3 å®Œæˆè¯æ®
- [ ] **å‘½ä»¤æ–‡ä»¶ diff**ï¼šå±•ç¤ºå˜æ›´å†…å®¹
- [ ] **çŠ¶æ€æ–‡ä»¶ç¤ºä¾‹**ï¼šå±•ç¤º `{task}_state.yaml` æ ¼å¼
- [ ] **æµç¨‹å›¾æ›´æ–°**ï¼šå±•ç¤ºæ–°çš„æ‰§è¡Œæµç¨‹ï¼ˆå«æ–­è·¯å™¨å’Œå‡çº§ï¼‰

---

### Phase 4: Alex Command Updatesï¼ˆé¢„è®¡ 2 å°æ—¶ï¼‰

#### äº¤ä»˜ç‰©
- [ ] `/alex` å‘½ä»¤æ›´æ–° Gate 4 éƒ¨åˆ†
- [ ] `/gate 4` å‘½ä»¤æ›´æ–°ä¸ºç®€åŒ–ç‰ˆæœ¬
- [ ] éªŒæ”¶æµç¨‹æ–‡æ¡£æ›´æ–°

#### å®æ–½æ­¥éª¤
1. æ›´æ–° `.claude/commands/tad-alex.md`
2. æ›´æ–° `/gate 4` æ£€æŸ¥é¡¹ï¼ˆç§»é™¤æŠ€æœ¯æ£€æŸ¥ï¼Œä¿ç•™ä¸šåŠ¡éªŒæ”¶ï¼‰
3. æ›´æ–°éªŒæ”¶æµç¨‹æè¿°
4. æ·»åŠ è¯æ®å®¡æŸ¥æŒ‡å—ï¼ˆè€Œéé‡æ–°æ‰§è¡Œï¼‰

#### éªŒè¯æ–¹æ³•
- å‘½ä»¤è¯­æ³•æ­£ç¡®
- Gate 4 æ£€æŸ¥é¡¹ä¸è®¾è®¡ä¸€è‡´

#### Phase 4 å®Œæˆè¯æ®
- [ ] **å‘½ä»¤æ–‡ä»¶ diff**ï¼šå±•ç¤ºå˜æ›´å†…å®¹
- [ ] **Gate 4 checklist**ï¼šå±•ç¤ºç®€åŒ–åçš„æ£€æŸ¥é¡¹

---

### Phase 5: Documentation & Migrationï¼ˆé¢„è®¡ 2 å°æ—¶ï¼‰

#### äº¤ä»˜ç‰©
- [ ] CLAUDE.md æ›´æ–°ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] README.md æ›´æ–° TAD v2.0 è¯´æ˜
- [ ] è¿ç§»æŒ‡å—æ–‡æ¡£
- [ ] Ralph Loop ä½¿ç”¨ç¤ºä¾‹

#### å®æ–½æ­¥éª¤
1. æ£€æŸ¥ CLAUDE.md æ˜¯å¦éœ€è¦æ›´æ–°
2. æ›´æ–° README.md ä¸­çš„ç‰ˆæœ¬ä¿¡æ¯
3. åˆ›å»º `.tad/docs/migration-v1.8-to-v2.0.md`
4. åˆ›å»º Ralph Loop ä½¿ç”¨ç¤ºä¾‹

#### éªŒè¯æ–¹æ³•
- æ–‡æ¡£é˜…è¯»æµç•…
- è¿ç§»æ­¥éª¤æ¸…æ™°

#### Phase 5 å®Œæˆè¯æ®
- [ ] **æ–‡æ¡£æ›´æ–° diff**ï¼šå±•ç¤ºæ–‡æ¡£å˜æ›´
- [ ] **è¿ç§»æŒ‡å—**ï¼šå±•ç¤ºä» v1.8 åˆ° v2.0 çš„æ­¥éª¤

---

## 6. File Structure

### 6.1 Files to Create

```
.tad/ralph-config/
â”œâ”€â”€ loop-config.yaml       # Ralph Loop ä¸»é…ç½® (v1.1)
â””â”€â”€ expert-criteria.yaml   # ä¸“å®¶é€šè¿‡æ ‡å‡†å®šä¹‰ (machine-parseable)

.tad/schemas/
â”œâ”€â”€ loop-config.schema.json    # é…ç½®éªŒè¯ Schema (NEW)
â””â”€â”€ expert-criteria.schema.json # ä¸“å®¶æ ‡å‡† Schema (NEW)

.tad/evidence/
â”œâ”€â”€ ralph-loops/           # Ralph Loop è¿­ä»£è®°å½•
â”‚   â””â”€â”€ .gitkeep
â””â”€â”€ reviews/               # ä¸“å®¶å®¡æ ¸è¯æ®
    â”œâ”€â”€ .gitkeep
    â””â”€â”€ _iterations/       # å†å²è¿­ä»£å®¡æ ¸ (NEW)

.tad/docs/
â””â”€â”€ migration-v1.8-to-v2.0.md  # è¿ç§»æŒ‡å— (NEW)
```

### 6.2 Files to Modify

```
.tad/config.yaml              # æ·»åŠ  ralph_loop å¼•ç”¨ï¼Œæ›´æ–° Gate 3/4
.claude/commands/tad-blake.md # æ›´æ–° Blake å‘½ä»¤æ”¯æŒ Ralph Loop v1.1
.claude/commands/tad-alex.md  # æ›´æ–° Alex Gate 4 æµç¨‹
.claude/skills/tad-gate/SKILL.md  # æ›´æ–° Gate 3/4 å®šä¹‰
CLAUDE.md                     # å¦‚éœ€è¦ï¼Œæ›´æ–°è§„åˆ™
README.md                     # æ›´æ–°ç‰ˆæœ¬è¯´æ˜
```

---

## 7. Testing Requirements

### 7.1 Smoke Tests

- æ–°é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®ï¼ˆYAML lintï¼‰
- JSON Schema æ–‡ä»¶æœ‰æ•ˆ
- ç›®å½•ç»“æ„æ­£ç¡®åˆ›å»º
- å‘½ä»¤æ–‡ä»¶æ ¼å¼æ­£ç¡®

### 7.2 Integration Tests

- `/blake` å‘½ä»¤èƒ½æ­£ç¡®åŠ è½½ ralph-config
- çŠ¶æ€æŒä¹…åŒ–å·¥ä½œæ­£å¸¸ï¼ˆcheckpoint/resumeï¼‰
- æ–­è·¯å™¨æ­£ç¡®è§¦å‘
- ä¼˜å…ˆçº§ç»„æ­£ç¡®æ‰§è¡Œ
- `/gate 3` èƒ½æ­£ç¡®æ‰§è¡Œæ‰©å±•æ£€æŸ¥
- `/gate 4` èƒ½æ­£ç¡®æ‰§è¡Œç®€åŒ–æ£€æŸ¥

### 7.3 Edge Cases

- é¡¹ç›®æ²¡æœ‰ `npm test` å‘½ä»¤æ—¶çš„å¤„ç†
- ä¸“å®¶å®¡æ ¸è¶…æ—¶çš„å¤„ç†
- è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°çš„å¤„ç†
- è¿›ç¨‹å´©æºƒåçš„æ¢å¤
- åŒä¸€é”™è¯¯è¿ç»­å‡ºç°çš„æ–­è·¯å™¨è§¦å‘
- Layer 2 å‡çº§åˆ° Alex çš„å¤„ç†

---

## 8. Acceptance Criteria

Blakeçš„å®ç°è¢«è®¤ä¸ºå®Œæˆï¼Œå½“ä¸”ä»…å½“ï¼š
- [ ] æ‰€æœ‰é…ç½®æ–‡ä»¶åˆ›å»ºå®Œæˆï¼ˆåŒ…å« P0 ä¿®å¤ï¼‰
- [ ] JSON Schema éªŒè¯é€šè¿‡
- [ ] config.yaml æ­£ç¡®æ›´æ–°
- [ ] Blake å‘½ä»¤æ”¯æŒ Ralph Loop v1.1
- [ ] çŠ¶æ€æŒä¹…åŒ–å’Œæ–­è·¯å™¨å·¥ä½œæ­£å¸¸
- [ ] Alex Gate 4 ç®€åŒ–å®Œæˆ
- [ ] æ–‡æ¡£æ›´æ–°å®Œæˆ
- [ ] æ‰€æœ‰ Phase è¯æ®æä¾›

---

## 9. Important Notes

### 9.1 Critical Warnings

- âš ï¸ **ä¿æŒå‘åå…¼å®¹**ï¼šç°æœ‰ TAD å·¥ä½œæµä¸å—å½±å“
- âš ï¸ **Terminal éš”ç¦»ä»æœ‰æ•ˆ**ï¼šAlex å’Œ Blake ä»åœ¨ä¸åŒ Terminal
- âš ï¸ **Human æ§åˆ¶æƒä¸å˜**ï¼šGate 3/4 ä»éœ€ Human è§¦å‘
- âš ï¸ **æ–­è·¯å™¨é‡è¦**ï¼šé˜²æ­¢æ— é™å¾ªç¯æµªè´¹èµ„æº

### 9.2 Known Constraints

- Ralph Loop ä¾èµ–é¡¹ç›®æœ‰ build/test/lint è„šæœ¬
- ä¸“å®¶å®¡æ ¸éœ€è¦æ¶ˆè€— API quota
- æ¡ä»¶è§¦å‘ä¸“å®¶çš„æ­£åˆ™è¡¨è¾¾å¼å¯èƒ½éœ€è¦è°ƒä¼˜
- çŠ¶æ€æ–‡ä»¶ 30 åˆ†é’Ÿè¿‡æœŸéœ€è¦é‡æ–°å¼€å§‹

### 9.3 Sub-Agent ä½¿ç”¨å»ºè®®

Blake åº”è¯¥è€ƒè™‘ä½¿ç”¨ï¼š
- [ ] **code-reviewer** - Phase å®Œæˆåå®¡æŸ¥é…ç½®æ–‡ä»¶
- [ ] **test-runner** - å¦‚æœæœ‰å¯æ‰§è¡Œæµ‹è¯•

---

## 10. Learning Content

### 10.1 Decision Rationale: Ralph Loop vs Traditional Sequential

**é€‰æ‹©çš„æ–¹æ¡ˆ**ï¼šRalph Loop with Expert Exit Condition + Circuit Breaker

**è€ƒè™‘çš„æ›¿ä»£æ–¹æ¡ˆ**ï¼š

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | ä¸ºä»€ä¹ˆæ²¡é€‰ |
|------|------|------|-----------|
| Ralph Loop + Circuit Breakerï¼ˆé€‰ä¸­ï¼‰| è‡ªåŠ¨è¿­ä»£ + é˜²æ­¢èµ„æºæµªè´¹ | é…ç½®è¾ƒå¤æ‚ | âœ… é€‰ä¸­ |
| åŸç‰ˆ Ralph (æ— æ–­è·¯å™¨) | ç®€å• | å¯èƒ½æ— é™å¾ªç¯ | æµªè´¹èµ„æº |
| ä¼ ç»Ÿé¡ºåºæ‰§è¡Œ | ç®€å•ç›´æ¥ | AI è‡ªåˆ¤æ–­ä¸å¯é  | æ— æ³•è§£å†³æ ¸å¿ƒé—®é¢˜ |
| çº¯ Human å®¡æ ¸ | è´¨é‡å¯æ§ | Human è´Ÿæ‹…å¤ªé‡ | æ•ˆç‡å¤ªä½ |

**æƒè¡¡åˆ†æ**ï¼š
- æ ¸å¿ƒæƒè¡¡ï¼šè‡ªåŠ¨åŒ–ç¨‹åº¦ vs äººå·¥å‚ä¸åº¦ vs èµ„æºæ¶ˆè€—
- æ–­è·¯å™¨è§£å†³äº†åŸç‰ˆ Ralph çš„æ— é™å¾ªç¯é£é™©
- ä¼˜å…ˆçº§ç»„å‡å°‘äº† Layer 2 çš„èµ„æºæµªè´¹
- çŠ¶æ€æŒä¹…åŒ–æé«˜äº†é²æ£’æ€§

**ğŸ’¡ Humanå­¦ä¹ ç‚¹**ï¼š
1. AI çš„ã€Œè‡ªæˆ‘åˆ¤æ–­ã€å¾€å¾€ä¸å¯é ï¼Œéœ€è¦å®¢è§‚çš„å¤–éƒ¨æ£€æŸ¥
2. è‡ªåŠ¨åŒ–å¾ªç¯éœ€è¦æ–­è·¯å™¨é˜²æ­¢å¤±æ§
3. çŠ¶æ€æŒä¹…åŒ–æ˜¯ç”Ÿäº§ç³»ç»Ÿçš„åŸºæœ¬è¦æ±‚

---

## 11. Expert Review Integration Log

### code-reviewer åé¦ˆå¤„ç†

| P0 Issue | å¤„ç†æ–¹å¼ |
|----------|----------|
| P0-1: Layer 2 loop back æ— å‡çº§é˜ˆå€¼ | âœ… æ·»åŠ  `layer2.escalation` é…ç½® |
| P0-2: `max_rounds` å’Œ `total_iterations` å…³ç³»ä¸æ¸… | âœ… é‡æ–°å®šä¹‰è¯­ä¹‰ï¼Œåˆ†å±‚è®¡æ•° |
| P0-3: Gate 3/4 èŒè´£é‡å  | âœ… æ·»åŠ èŒè´£çŸ©é˜µï¼Œæ˜ç¡®åˆ’åˆ† |

### backend-architect åé¦ˆå¤„ç†

| P0 Issue | å¤„ç†æ–¹å¼ |
|----------|----------|
| Loop state not persisted | âœ… æ·»åŠ  `state_persistence` é…ç½® |
| No JSON Schema validation | âœ… æ·»åŠ  `.tad/schemas/` ç›®å½• |
| No per-expert timeout | âœ… åˆ†å±‚è¶…æ—¶é…ç½®ï¼šcode-reviewer/test-runner æ”¯æŒæ™ºèƒ½åˆ†å±‚ï¼ˆ3-15åˆ†é’Ÿï¼‰ï¼Œsecurity/performance ä¿æŒ5åˆ†é’Ÿ |
| No circuit breaker | âœ… æ·»åŠ  `layer1.circuit_breaker` é…ç½® |

---

**Handoff Created By**: Alex (Agent A)
**Date**: 2026-01-26
**Version**: 1.2.0 (Expert Timeout Optimized)
