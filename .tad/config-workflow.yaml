# TAD Config Module: Workflow & Document Management
# Part of TAD config.yaml modular split (v2.2)
# Contains: document_management, tad_maintain, requirement_elicitation,
#           socratic_inquiry_protocol, scenarios
# Consumers: tad-alex.md, tad-maintain.md, tad-handoff.md, tad-scenario.md, tad-elicit.md
# ==================== æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ ====================
document_management:
  manifest_file: .tad/manifest.yaml
  naming_convention:
    format: "{timestamp}_{version}_{task_id}_{type}_{status}.md"
    example: "20250128_1430_v1.2_TASK001_design_draft.md"

  structure:
    active:           # å½“å‰æ´»è·ƒä»»åŠ¡
      - tasks         # ä»»åŠ¡è¿½è¸ª
      - designs       # è®¾è®¡æ–‡æ¡£
      - handoffs      # äº¤æ¥æ–‡æ¡£
      - epics         # Epic å¤šé˜¶æ®µä»»åŠ¡è¿½è¸ª
      - playground    # Frontend Design Playground é¢„è§ˆ
    archive:          # å·²å®Œæˆå½’æ¡£
      - by_date       # æŒ‰æ—¥æœŸ
      - by_task       # æŒ‰ä»»åŠ¡
      - by_version    # æŒ‰ç‰ˆæœ¬
      - epics         # å·²å®Œæˆçš„ Epic
      - playground    # å·²å½’æ¡£çš„ Playground æ–‡ä»¶
    context: "é¡¹ç›®é•¿æœŸä¿¡æ¯"
    working: "å·¥ä½œä¸­æ–‡æ¡£"

  version_control:
    enabled: true
    auto_increment: true
    hash_verification: true
    change_tracking: true

  mandatory_sections:
    header:
      - task_id: "TASK-{YYYY}{MM}{DD}-{seq}"
      - version: "v{major}.{minor}.{patch}"
      - status: "draft|review|approved|implemented|archived"
      - owner: "{agent_name}"
      - created: "{timestamp}"
      - modified: "{timestamp}"
      - previous_version: "{link_to_previous}"

    metadata:
      - hash: "{file_hash}"
      - modified_by: "{agent_name}"
      - change_summary: "{summary}"

  # Handoff ç”Ÿå‘½å‘¨æœŸç®¡ç† (æ£€æµ‹è·¨ slug æ›¿ä»£å’Œè¿‡æœŸ handoff)
  handoff_lifecycle:
    stale_age_days: 7                    # Active handoff è¶…è¿‡æ­¤å¤©æ•°æœªå®Œæˆ â†’ æ ‡è®° POTENTIALLY_STALE
    cross_reference_window_days: 30      # æ‰«æ archive ä¸­è¿‘ N å¤©çš„ handoff è¿›è¡Œä¸»é¢˜åŒ¹é…
    topic_match_threshold: 2             # æ ‡é¢˜/æ‘˜è¦ä¸­è‡³å°‘ N ä¸ªå…³é”®è¯é‡å æ‰åˆ¤å®šä¸ºä¸»é¢˜æ›¿ä»£
    common_words_exclude:                # ä¸»é¢˜åŒ¹é…æ—¶æ’é™¤çš„é€šç”¨è¯
      - "tad"
      - "implementation"
      - "design"
      - "handoff"
      - "update"
      - "fix"
      - "feature"

  # NEXT.md ç»´æŠ¤è§„åˆ™ (é˜²æ­¢æ–‡æ¡£æ— é™å¢é•¿)
  next_md_maintenance:
    description: "NEXT.md æ˜¯é¡¹ç›®ä»»åŠ¡è¿½è¸ªæ–‡ä»¶ï¼Œéœ€è¦å®šæœŸæ¸…ç†ä»¥ä¿æŒå¯è¯»æ€§"

    size_limits:
      max_lines: 500
      max_tokens: 20000  # ä¿æŒåœ¨ Claude å¯ä¸€æ¬¡è¯»å–çš„èŒƒå›´å†…
      warning_threshold: 400  # è¶…è¿‡æ­¤è¡Œæ•°æ—¶æé†’æ¸…ç†

    archive_rules:
      # å½’æ¡£è§¦å‘æ¡ä»¶ï¼ˆæ»¡è¶³ä»»ä¸€å³è§¦å‘ï¼‰
      triggers:
        - "æ–‡ä»¶è¶…è¿‡ 500 è¡Œ"
        - "è¯»å–æ—¶å‡ºç° token è¶…é™é”™è¯¯"
        - "å¼€å§‹æ–°çš„å·¥ä½œå‘¨"
        - "ç”¨æˆ·æ˜ç¡®è¦æ±‚"

      # å½’æ¡£ç›®æ ‡
      destinations:
        completed_tasks: "docs/HISTORY.md"      # å·²å®Œæˆä»»åŠ¡çš„å†å²è®°å½•
        milestones: "CHANGELOG.md"              # é‡å¤§é‡Œç¨‹ç¢‘
        technical_details: "docs/"              # è¯¦ç»†æŠ€æœ¯è¯´æ˜

      # ä¿ç•™å†…å®¹
      keep_in_next_md:
        - "å½“å‰è¿›è¡Œä¸­çš„ä»»åŠ¡"
        - "æœ¬å‘¨å¾…åŠä»»åŠ¡"
        - "Blocked ä»»åŠ¡"
        - "æœ€è¿‘ 3 å¤©çš„é‡è¦æ›´æ–°"

    history_md_format: |
      # Project History

      ## Week of YYYY-MM-DD
      ### Completed
      - [x] Task 1 (date)
      - [x] Task 2 (date)

      ### Key Decisions
      - Decision 1: reason

      ### Lessons Learned
      - Learning 1

    cleanup_steps:
      - step: 1
        action: "è¯†åˆ«è¶…è¿‡ 7 å¤©çš„å·²å®Œæˆä»»åŠ¡"
      - step: 2
        action: "å°†å†å²å†…å®¹ç§»åŠ¨åˆ° docs/HISTORY.md"
      - step: 3
        action: "ä¿ç•™å½“å‰è¿›è¡Œä¸­å’Œæœ¬å‘¨å¾…åŠä»»åŠ¡"
      - step: 4
        action: "æ›´æ–° NEXT.md å¤´éƒ¨çš„æ—¥æœŸå’ŒçŠ¶æ€"
      - step: 5
        action: "éªŒè¯æ–‡ä»¶è¡Œæ•°åœ¨ 500 è¡Œä»¥å†…"

    agent_responsibility:
      alex: "å‘ç° NEXT.md è¿‡å¤§æ—¶ï¼Œè§„åˆ’æ¸…ç†æ–¹æ¡ˆ"
      blake: "æ‰§è¡Œæ¸…ç†ï¼Œç§»åŠ¨å†…å®¹åˆ°å½’æ¡£æ–‡ä»¶"

  # Epic ç”Ÿå‘½å‘¨æœŸç®¡ç† (å¤šé˜¶æ®µä»»åŠ¡è¿½è¸ª)
  epic_lifecycle:
    enabled: true
    version: "1.0"
    description: "Epic is a container above handoffs for tracking multi-phase tasks"

    locations:
      active: ".tad/active/epics/"
      archive: ".tad/archive/epics/"
      template: ".tad/templates/epic-template.md"

    naming_convention:
      format: "EPIC-{YYYYMMDD}-{slug}.md"
      example: "EPIC-20260201-auth-system.md"

    constraints:
      max_active_epics: 3                    # Maximum concurrent active Epics
      sequential_constraint: true            # Only 1 Active phase per Epic at a time
      stale_age_days: 7                      # Active phase stuck for >N days triggers warning

    phase_statuses:
      planned: "â¬š Planned"
      active: "ğŸ”„ Active"
      done: "âœ… Done"

    derived_status:
      planning: "All phases are â¬š Planned"
      in_progress: "Any phase is ğŸ”„ Active or âœ… Done"
      complete: "All phases are âœ… Done"

    phase_adjustment:
      add_phase: "Alex appends new row to Phase Map (â¬š Planned), notes reason"
      remove_phase: "Only â¬š Planned phases can be removed, notes reason"
      reorder_phase: "Only â¬š Planned phases can be reordered"

    error_handling:
      epic_file_missing: "WARNING, continue *accept (don't block handoff archive)"
      epic_format_invalid: "WARNING, skip update, remind user to fix"
      handoff_ref_mismatch: "WARNING, prompt user to confirm correct phase"
      concurrent_active_violation: "BLOCK, don't activate new phase"

    health_checks:
      - "STALE: All phases done but Epic not archived"
      - "ORPHAN: No linked handoffs and older than stale_age_days"
      - "DANGLING_REF: Phase Map references non-existent handoff"
      - "BACK_REF_MISMATCH: Handoff references Epic but Epic doesn't list it"
      - "STUCK: Active phase exceeds stale_age_days"
      - "OVER_ACTIVE: Multiple Active phases in same Epic"

# ==================== Document Maintenance Command ====================
tad_maintain:
  description: "Document health check and synchronization"
  command_file: ".claude/commands/tad-maintain.md"
  modes:
    check:
      description: "Read-only health scan"
      triggers: ["agent_activation", "exit_command"]
    sync:
      description: "Scoped write operations"
      triggers: ["accept_command"]
    full:
      description: "Comprehensive check + sync"
      triggers: ["manual"]
  auto_archive_criteria:
    - "matching_completion_report"
    - "superseded_by_newer_version"
    - "epic_all_phases_complete"
  safety:
    write_strategy: "copy-then-delete"
    idempotent: true
    name_conflict_resolution: "append-timestamp-suffix"

# ==================== é…å¯¹æµ‹è¯•åè®® ====================
pair_testing:
  description: "Cross-tool E2E pair testing protocol (TAD CLI â†’ Claude Desktop Cowork)"
  ownership: "Alex generates brief, human decides, Claude Desktop executes with human"

  # All pair testing files live in .tad/pair-testing/
  base_dir: ".tad/pair-testing/"

  brief:
    template: ".tad/templates/test-brief-template.md"
    output: ".tad/pair-testing/TEST_BRIEF.md"
    trigger: "Gate 4 pass (Alex evaluates, recommends to human, human decides)"
    sections:
      alex_fills: [1, 2, 3, 4, 5, 8]  # all content sections
      template_default: [6, 7]          # collaboration guide & output format

    skip_criteria:
      - "Backend-only changes (no UI impact)"
      - "Configuration/environment changes"
      - "Documentation-only updates"
      - "Internal refactoring with no user-facing behavior change"
      - "Dependency updates with no feature change"

  report:
    template: ".tad/templates/pair-test-report-template.md"
    expected_pattern: ".tad/pair-testing/PAIR_TEST_REPORT*.md"
    location: ".tad/pair-testing/"
    archive_to: ".tad/evidence/pair-tests/"
    auto_detect_on_alex_start: true
    issue_routing:
      P0: "Create immediate handoff"
      P1: "Create handoff"
      P2: "Add to NEXT.md"

  screenshot:
    output_dir: ".tad/pair-testing/screenshots/"
    naming: "R{N}-{NN}-{description}.gif"

# ==================== Frontend Design Playground v2 ====================
playground:
  enabled: true
  version: "2.0"
  description: "Independent /playground command â€” generates complete Landing Pages for visual direction exploration"
  ownership: "Independent Design Explorer agent. Alex references outputs, Blake implements from spec."

  # Command definition
  command: ".claude/commands/playground.md"

  # Core resources
  resources:
    style_library: ".tad/references/design-styles.yaml"
    gallery_template: ".tad/templates/gallery-template.html"
    design_tokens_template: ".tad/templates/design-tokens-template.md"

  # Directory structure
  directories:
    active: ".tad/active/playground/"
    archive: ".tad/archive/playground/"
    naming: "PLAYGROUND-{YYYYMMDD}-{project-slug}/"

  # Workflow
  workflow:
    steps: ["understand", "discover", "generate", "feedback", "iterate", "finalize"]
    versions_per_round: 3
    max_versions: 30
    feedback_mode: "mixed"  # structured + open discussion

  # Style library
  style_library:
    total_styles: 32
    categories: 7
    category_list: ["classic", "modern_ui", "minimal", "retro", "expressive", "trending", "futuristic"]

  # Output
  output:
    design_spec: "DESIGN-SPEC.md"
    persist_to: ".tad/project-knowledge/frontend-design.md"

  # State management
  state:
    file: "playground-state.json"
    backup: "playground-state.backup.json"
    atomic_writes: true

  # Cleanup
  cleanup:
    archive_on_accept: true
    keep_spec: true
    delete_html_after_archive: false

  # Legacy (archived)
  legacy_v1:
    archive_location: ".tad/archive/playground/legacy-v1/"
    archived_files:
      - "design-curations.yaml"
      - "playground-template.html"
      - "playground-guide.md"

# ==================== æ·±åº¦éœ€æ±‚æŒ–æ˜æµç¨‹ï¼ˆå€Ÿé‰´BMADçš„elicitï¼‰ ====================
requirement_elicitation:
  # å¼ºåˆ¶å¤šè½®ç¡®è®¤æœºåˆ¶
  mandatory_rounds:
    minimum: 3
    maximum: 5

  round1_understanding:
    agent_action:
      - "å¤è¿°ç”¨æˆ·éœ€æ±‚"
      - "è¯†åˆ«å…³é”®ä»·å€¼ç‚¹"
      - "åˆ—å‡ºåˆæ­¥å‡è®¾"
    user_interaction:
      format: "1-9é€‰é¡¹æ ¼å¼"
      options:
        1: "ç»§ç»­ä¸‹ä¸€æ­¥"
        2: "æ¾„æ¸…éœ€æ±‚"
        3: "æä¾›æ›´å¤šèƒŒæ™¯"
        4: "çº æ­£ç†è§£åå·®"
        5: "æ·»åŠ çº¦æŸæ¡ä»¶"
        6: "æ˜ç¡®ä¼˜å…ˆçº§"
        7: "æä¾›ç¤ºä¾‹"
        8: "è®¨è®ºæ›¿ä»£æ–¹æ¡ˆ"
        9: "é‡æ–°å¼€å§‹"

  round2_exploration:
    agent_action:
      - "å±•ç¤ºç†è§£çš„éœ€æ±‚"
      - "æå‡ºclarifying questions"
      - "è¯†åˆ«æ½œåœ¨é£é™©"
    must_check:
      - "å†å²ä»£ç æ˜¯å¦å­˜åœ¨"
      - "ç±»ä¼¼åŠŸèƒ½æ˜¯å¦å®ç°è¿‡"
      - "æ˜¯å¦æœ‰å¯å¤ç”¨ç»„ä»¶"

  round3_confirmation:
    agent_action:
      - "å±•ç¤ºå®Œæ•´éœ€æ±‚ç†è§£"
      - "åˆ—å‡ºå…³é”®å†³ç­–ç‚¹"
      - "ç¡®è®¤éªŒæ”¶æ ‡å‡†"
    final_check:
      format: "å¿…é¡»è·å¾—æ˜ç¡®ç¡®è®¤"
      options:
        - "âœ… ç¡®è®¤ï¼Œå¼€å§‹è®¾è®¡"
        - "ğŸ”„ éœ€è¦è°ƒæ•´"
        - "âŒ é‡æ–°åˆ†æ"

  # ==================== Research Phase (v1.4 æ–°å¢) ====================
  # è®¾è®¡åŸåˆ™ï¼šèå…¥ç°æœ‰ Roundï¼ŒæŒ‰éœ€æœç´¢ + æœ€ç»ˆæŠ€æœ¯å›é¡¾
  research_phase:
    enabled: true
    version: "1.4"
    description: "ä¸»åŠ¨æŠ€æœ¯è°ƒç ”ï¼Œç¡®ä¿æŠ€æœ¯é€‰å‹åŸºäºæœ€æ–°ä¿¡æ¯"

    # è¿‡ç¨‹ä¸­æŒ‰éœ€æœç´¢ï¼ˆèå…¥ Round 1-3ï¼‰
    inline_research:
      trigger: "Round ä¸­å‡ºç°æŠ€æœ¯å†³ç­–ç‚¹"
      action: "ç«‹å³è§¦å‘ MQ6 æœç´¢"
      examples:
        - "ç”¨æˆ·æåˆ°æƒ³ç”¨æŸä¸ªæ¡†æ¶ â†’ æœç´¢è¯¥æ¡†æ¶æœ€æ–°ç‰ˆæœ¬å’Œæœ€ä½³å®è·µ"
        - "è®¨è®ºåˆ°çŠ¶æ€ç®¡ç† â†’ æœç´¢å½“å‰ä¸»æµæ–¹æ¡ˆå¯¹æ¯”"
        - "æ¶‰åŠ UI ç»„ä»¶åº“ â†’ æœç´¢æœ€æ–°æ¨è"

    # æœ€ç»ˆæŠ€æœ¯å›é¡¾ï¼ˆRound 3 ä¹‹åï¼Œè®¾è®¡ä¹‹å‰ï¼‰
    final_tech_review:
      timing: "Round 3 ç¡®è®¤åï¼Œæ­£å¼è®¾è®¡å‰"
      name: "æŠ€æœ¯æ ˆæœ€ç»ˆç¡®è®¤"
      mandatory: true

      checklist:
        - item: "æ ¸å¿ƒæ¡†æ¶ç‰ˆæœ¬ç¡®è®¤"
          action: "æœç´¢ç¡®è®¤ä½¿ç”¨çš„æ˜¯æœ€æ–°ç¨³å®šç‰ˆ"
          evidence: "ç‰ˆæœ¬å· + å‘å¸ƒæ—¥æœŸ"

        - item: "å…³é”®ä¾èµ–åº“ç¡®è®¤"
          action: "æœç´¢æ¯ä¸ªå…³é”®åº“çš„æœ€æ–°ç‰ˆæœ¬å’Œæ›¿ä»£æ–¹æ¡ˆ"
          evidence: "åº“å | ç‰ˆæœ¬ | æ›¿ä»£æ–¹æ¡ˆ | é€‰æ‹©ç†ç”±"

        - item: "æ¶æ„æ¨¡å¼ç¡®è®¤"
          action: "æœç´¢å½“å‰æ¨èçš„æ¶æ„æ¨¡å¼"
          evidence: "æ¨¡å¼å | é€‚ç”¨åœºæ™¯ | å‚è€ƒé¡¹ç›®"

        - item: "æ½œåœ¨é—®é¢˜é¢„è­¦"
          action: "æœç´¢è¯¥æŠ€æœ¯æ ˆçš„å¸¸è§å‘ç‚¹"
          evidence: "é—®é¢˜ | è§£å†³æ–¹æ¡ˆ | æ¥æº"

      output_format: |
        ## æŠ€æœ¯æ ˆæœ€ç»ˆç¡®è®¤æŠ¥å‘Š

        ### 1. æ ¸å¿ƒæ¡†æ¶
        | æ¡†æ¶ | ç‰ˆæœ¬ | æœ€æ–°ç‰ˆæœ¬ | æ˜¯å¦éœ€è¦å‡çº§ |
        |-----|------|---------|-------------|

        ### 2. å…³é”®ä¾èµ–
        | åº“å | é€‰æ‹©ç‰ˆæœ¬ | æ›¿ä»£æ–¹æ¡ˆ | é€‰æ‹©ç†ç”± |
        |-----|---------|---------|---------|

        ### 3. æ¶æ„æ¨¡å¼
        | æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | å‚è€ƒé¡¹ç›®/æ–‡ç«  |
        |-----|---------|--------------|

        ### 4. å·²çŸ¥å‘ç‚¹
        | é—®é¢˜ | è§£å†³æ–¹æ¡ˆ | æ¥æº |
        |-----|---------|-----|

        ### 5. è°ƒç ”æ€»ç»“
        - æ€»å…±æœç´¢äº† X ä¸ªæŠ€æœ¯ç‚¹
        - å‘ç° Y ä¸ªéœ€è¦æ³¨æ„çš„é—®é¢˜
        - å»ºè®®ï¼š...

      human_checkpoint:
        question: "æŠ€æœ¯æ ˆç¡®è®¤æŠ¥å‘Šçœ‹èµ·æ¥å®Œæ•´å—ï¼Ÿ"
        options:
          - "âœ… ç¡®è®¤ï¼Œå¼€å§‹è®¾è®¡"
          - "ğŸ”„ éœ€è¦è¡¥å……è°ƒç ”"
          - "â“ æœ‰ç–‘é—®æƒ³è®¨è®º"

  # æµ…å±‚å“åº”æ£€æµ‹
  shallow_response_detection:
    indicators:
      - "ç«‹å³ç”ŸæˆæŠ€æœ¯æ–¹æ¡ˆ"
      - "è·³è¿‡ä»·å€¼ç¡®è®¤"
      - "æ²¡æœ‰æå‡ºé—®é¢˜"
      - "å°‘äº3è½®äº¤äº’"
    action: "å¼ºåˆ¶é‡æ–°è¿›å…¥éœ€æ±‚æŒ–æ˜æµç¨‹"

# ==================== è‹æ ¼æ‹‰åº•å¼æé—®åè®® (v1.8 æ–°å¢) ====================
socratic_inquiry_protocol:
  enabled: true
  version: "1.0"
  description: "å†™ handoff ä¹‹å‰å¿…é¡»ç”¨ AskUserQuestion å·¥å…·è¿›è¡Œè‹æ ¼æ‹‰åº•å¼æé—®"
  blocking: true
  violation: "ä¸è°ƒç”¨ AskUserQuestion ç›´æ¥å†™ handoff = VIOLATION"

  # ç›®æ ‡
  goals:
    - "å‘ç°éœ€æ±‚ç›²ç‚¹"
    - "éªŒè¯å®Œæ•´æ€§"
    - "å¸®åŠ©ç”¨æˆ·åšå‡ºæ›´å¥½å†³ç­–"

  # å¤æ‚åº¦åˆ¤æ–­
  complexity_detection:
    small:
      criteria:
        - "å•æ–‡ä»¶ä¿®æ”¹"
        - "é…ç½®è°ƒæ•´"
        - "ç®€å• UI å˜æ›´"
      question_count: "2-3"
      example: "ä¿®æ”¹æŒ‰é’®é¢œè‰²ã€æ›´æ–°é…ç½®æ–‡ä»¶"

    medium:
      criteria:
        - "å¤šæ–‡ä»¶ä¿®æ”¹"
        - "æ–°åŠŸèƒ½"
        - "API å˜æ›´"
      question_count: "4-5"
      example: "æ·»åŠ æ–°çš„ API ç«¯ç‚¹ã€å®ç°è¡¨å•éªŒè¯"

    large:
      criteria:
        - "æ¶æ„å˜æ›´"
        - "å¤æ‚åŠŸèƒ½"
        - "è·¨æ¨¡å—é‡æ„"
      question_count: "6-8"
      example: "é‡æ„è®¤è¯ç³»ç»Ÿã€æ·»åŠ æ–°çš„æ•°æ®æµ"

  # é—®é¢˜ç»´åº¦
  question_dimensions:
    value_validation:
      description: "éªŒè¯ä»·å€¼"
      example_questions:
        - "è¿™ä¸ªåŠŸèƒ½è§£å†³çš„æ ¸å¿ƒç—›ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"
        - "å¦‚æœä¸åšè¿™ä¸ªåŠŸèƒ½ï¼Œç”¨æˆ·ä¼šæ€æ ·ï¼Ÿ"
        - "è¿™ä¸ªåŠŸèƒ½çš„æˆåŠŸæ ‡å‡†æ˜¯ä»€ä¹ˆï¼Ÿ"

    boundary_clarification:
      description: "è¾¹ç•Œæ¾„æ¸…"
      example_questions:
        - "å“ªäº›åœºæ™¯æ˜ç¡®ä¸éœ€è¦æ”¯æŒï¼Ÿ"
        - "æœ‰ä»€ä¹ˆçº¦æŸæ¡ä»¶æˆ‘åº”è¯¥çŸ¥é“ï¼Ÿ"
        - "æœ€å°å¯è¡Œç‰ˆæœ¬åº”è¯¥åŒ…å«ä»€ä¹ˆï¼Ÿ"

    risk_foresight:
      description: "é£é™©é¢„è§"
      example_questions:
        - "å¦‚æœè¿™ä¸ªåŠŸèƒ½å‡ºé—®é¢˜ï¼Œæœ€åæƒ…å†µæ˜¯ä»€ä¹ˆï¼Ÿ"
        - "æœ‰ä»€ä¹ˆä¾èµ–å¯èƒ½ä¼šå¤±è´¥ï¼Ÿ"
        - "ç”¨æˆ·å¯èƒ½ä¼šæ€ä¹ˆè¯¯ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Ÿ"

    acceptance_criteria:
      description: "éªŒæ”¶æ ‡å‡†"
      example_questions:
        - "æ€æ ·ç®—åšå®Œäº†ï¼Ÿ"
        - "ä½ ä¼šæ€ä¹ˆæµ‹è¯•è¿™ä¸ªåŠŸèƒ½ï¼Ÿ"
        - "ä»€ä¹ˆæƒ…å†µä¸‹ä½ ä¼šè¯´'è¿™ä¸æ˜¯æˆ‘è¦çš„'ï¼Ÿ"

    user_scenarios:
      description: "ç”¨æˆ·åœºæ™¯"
      example_questions:
        - "å…¸å‹ç”¨æˆ·ä¼šæ€ä¹ˆä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Ÿ"
        - "æœ‰æ²¡æœ‰è¾¹ç¼˜ç”¨æˆ·ç¾¤éœ€è¦è€ƒè™‘ï¼Ÿ"
        - "ç”¨æˆ·çš„ä½¿ç”¨é¢‘ç‡å¦‚ä½•ï¼Ÿ"

    technical_constraints:
      description: "æŠ€æœ¯çº¦æŸ"
      example_questions:
        - "æœ‰å“ªäº›ç°æœ‰ç³»ç»Ÿçš„é™åˆ¶éœ€è¦è€ƒè™‘ï¼Ÿ"
        - "æ€§èƒ½è¦æ±‚æ˜¯ä»€ä¹ˆï¼Ÿ"
        - "éœ€è¦å…¼å®¹å“ªäº›å¹³å°/æµè§ˆå™¨ï¼Ÿ"

  # æ‰§è¡Œæµç¨‹
  execution_flow:
    step_1:
      name: "å¤æ‚åº¦è¯„ä¼°"
      action: "æ ¹æ®ä»»åŠ¡æè¿°åˆ¤æ–­å¤æ‚åº¦çº§åˆ«"
      output: "small/medium/large"

    step_2:
      name: "ç»´åº¦é€‰æ‹©"
      action: "æ ¹æ®ä»»åŠ¡ç±»å‹é€‰æ‹© 2-4 ä¸ªæœ€ç›¸å…³çš„é—®é¢˜ç»´åº¦"
      guideline: "ä¼˜å…ˆé€‰æ‹©ï¼švalue_validation, acceptance_criteria"

    step_3:
      name: "é—®é¢˜ç»„ç»‡"
      action: "ä»é€‰ä¸­ç»´åº¦æŒ‘é€‰æœ€ç›¸å…³çš„é—®é¢˜"
      format: "ä½¿ç”¨ AskUserQuestion å·¥å…·"

    step_4:
      name: "ç”¨æˆ·å›ç­”"
      action: "æ”¶é›†ç”¨æˆ·ç­”æ¡ˆ"
      follow_up: "å¯ä»¥è¿›è¡Œè‡ªç”±è®¨è®ºè¡¥å……"

    step_5:
      name: "æ€»ç»“è¾“å‡º"
      action: "ç”Ÿæˆ Inquiry Summary"
      format: |
        ## Socratic Inquiry Summary

        **Task**: {ä»»åŠ¡æè¿°}
        **Complexity**: {small/medium/large}
        **Questions Asked**: {é—®é¢˜æ•°é‡}

        ### Key Insights
        - {æ´å¯Ÿ 1}
        - {æ´å¯Ÿ 2}
        ...

        ### Clarified Requirements
        - {æ¾„æ¸…çš„éœ€æ±‚ 1}
        - {æ¾„æ¸…çš„éœ€æ±‚ 2}
        ...

        ### Risks Identified
        - {è¯†åˆ«çš„é£é™© 1}
        ...

        ### Acceptance Criteria
        - [ ] {éªŒæ”¶æ ‡å‡† 1}
        - [ ] {éªŒæ”¶æ ‡å‡† 2}
        ...

  # ç¦æ­¢è¡Œä¸º
  forbidden_actions:
    - "ä¸ç”¨ AskUserQuestion ç›´æ¥å†™ handoff"
    - "é—®å®Œé—®é¢˜ä¸ç­‰ç”¨æˆ·å›ç­”å°±å¼€å§‹å†™"
    - "è·³è¿‡å¤æ‚åº¦è¯„ä¼°ï¼Œé—®é¢˜æ•°é‡ä¸ä»»åŠ¡ä¸åŒ¹é…"
    - "åªé—®ä¸€ä¸ªç»´åº¦çš„é—®é¢˜"

  # ä¸ handoff çš„é›†æˆ
  handoff_integration:
    prerequisite: "å¿…é¡»å…ˆå®Œæˆ Socratic Inquiry"
    include_in_handoff: "åœ¨ handoff ä¸­åŒ…å« Inquiry Summary"
    verification: "Gate 2 æ£€æŸ¥æ˜¯å¦æœ‰ Inquiry Summary"

# ==================== åœºæ™¯å·¥ä½œæµï¼ˆå¢å¼ºç‰ˆï¼‰ ====================
scenarios:
  # æ¯ä¸ªåœºæ™¯éƒ½æœ‰å¼ºåˆ¶è¦æ±‚
  new_project:
    trigger: "æ²¡æœ‰ä»»ä½•ä»£ç ï¼Œä»é›¶å¼€å§‹"

    agent_a_workflow:
      phase1_requirements:
        mandatory_subagents: ["product-expert"]
        minimum_time: "30 minutes"
        deliverable: ".tad/active/requirements_v{n}.md"
        user_confirmation: required

      phase2_architecture:
        mandatory_subagents: ["backend-architect", "api-designer"]
        deliverable: ".tad/active/architecture_v{n}.md"
        review_required: true

      phase3_handoff:
        content:
          - "å®Œæ•´éœ€æ±‚æ–‡æ¡£"
          - "æ¶æ„è®¾è®¡å›¾"
          - "å®æ–½æ­¥éª¤"
          - "éªŒæ”¶æ ‡å‡†"
        format: ".tad/active/handoffs/project_init_{timestamp}.md"

    agent_b_workflow:
      phase1_validation:
        check: "éªŒè¯handoffå®Œæ•´æ€§"
        missing_info_action: "è¿”å›Agent Aè¡¥å……"

      phase2_execution:
        mandatory_subagents: ["parallel-coordinator", "devops-engineer"]
        parallel_tasks:
          - "é¡¹ç›®ç»“æ„åˆ›å»º"
          - "åŸºç¡€é…ç½®è®¾ç½®"
          - "å¼€å‘ç¯å¢ƒæ­å»º"

      phase3_testing:
        mandatory_subagents: ["test-runner"]
        coverage_requirement: ">80%"

  bug_fix:
    trigger: "å‘ç°é—®é¢˜éœ€è¦ä¿®å¤"

    agent_a_workflow:
      phase1_analysis:
        mandatory_subagents: ["bug-hunter"]
        deliverable: ".tad/active/tasks/bug_analysis_{id}.md"
        must_include:
          - "é—®é¢˜é‡ç°æ­¥éª¤"
          - "æ ¹å› åˆ†æ"
          - "å½±å“èŒƒå›´"
          - "ä¿®å¤æ–¹æ¡ˆ"

    agent_b_workflow:
      phase1_reproduce:
        action: "å¿…é¡»å…ˆé‡ç°é—®é¢˜"
        failure_action: "è¿”å›Agent Aé‡æ–°åˆ†æ"

      phase2_fix:
        mandatory_subagents: ["bug-hunter", "test-runner"]
        regression_test: required

